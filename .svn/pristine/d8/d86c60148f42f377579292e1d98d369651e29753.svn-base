<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="GSM_0003_0001_list_of_dates">
    <![CDATA[ -- GSM_0003_0001_list_of_dates
with
    set [Даты]
    as 'filter
        (
            [Период__День].[Период__День].[День].Members,
            not IsEmpty([Measures].[Цена])
        )'
    member [Measures].[Дата]
    as '[Период__День].[Период__День].CurrentMember.UniqueName'
select
    [Measures].[Дата] on columns,
    [Даты] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        {
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-80],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-92],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-95],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Дизельное топливо]
        },
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ]
    )
    ]]>
  </query>

  <query id="GSM_0003_0001_list_of_oil">
    <![CDATA[ -- GSM_0003_0001_list_of_oil
with
    set [Виды ГСМ]
    as '{
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-80],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-92],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-93],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-95],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Бензин марки АИ-98],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Дизельное топливо],
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[Газ сжиженный углеводородный для заправки автотранспортных средств]
        }'
    member [Период__День].[Период__День].[Дата]
    as 'tail(filter
        (
            [Период__День].[Период__День].[День].Members,
            not IsEmpty([Measures].[Цена])
        )).Item(0)'

select
    [Measures].[Цена] on columns,
    non empty [Виды ГСМ] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        [Период__День].[Период__День].[Дата],
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ]
    )
    ]]>
  </query>
  
  <query id="GSM_0003_0001_dates">
    <![CDATA[ -- GSM_0003_0001_dates
with
    member [Measures].[Текущий год]
    as 'Ancestor
        (
            <%period_cur_date%>,
            [Период__День].[Период__День].[Год]
        ).UniqueName'
    member [Measures].[Предыдущая дата]
    as 'tail
        (
            filter
            (
                [Период__День].[Период__День].[Данные всех периодов].[1998].[Полугодие 1].[Квартал 1].[Январь].[1]: <%period_cur_date%> - <%period_cur_date%>,
                not IsEmpty([Measures].[Цена])
            )
        ).Item(0).UniqueName'
    member [Measures].[Начало года]
    as 'head
        (
            filter
            (
                descendants
                (
                    StrToMember([Measures].[Текущий год]),
                    [Период__День].[Период__День].[День],
                    SELF
                ),
                not IsEmpty([Measures].[Цена])
            )
        ).Item(0).UniqueName'
select
    {
        [Measures].[Предыдущая дата],
        [Measures].[Начало года]
    } on columns
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы],
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ]
    )
    ]]>
  </query>

  <query id = "GSM_0003_0001_grid">
    <![CDATA[ -- GSM_0003_0001_grid
with
    set [МР]
    as 'filter
        (
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[ГП СП ВТГФЗ],
                SELF_AND_BEFORE
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and not IsEmpty
            (
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                    [Measures].[Средняя розничная цена на текущую дату]
                )
            ) and
            (
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                    [Measures].[МР]
                ) or
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                    [Measures].[ГП СП]
                )
            )
        )'
    set [ГО]
    as 'filter
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ].[Город Ханты-Мансийск] +
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[ГП СП ВТГФЗ],
                SELF_AND_BEFORE
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and not IsEmpty
            (
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                    [Measures].[Средняя розничная цена на текущую дату]
                )
            ) and
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Город]
            )
        )'
    set [Территории]
    as '[ГО] + [МР]'
    set [Организации]
    as '[Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children'
    member [Measures].[Город]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[МР]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count > 0,
            true,
            false
        )'
    member [Measures].[ГП СП]
    as 'iif
        (
            [Measures].[Уровень] = "ГП СП ВТГФЗ" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[Средняя розничная цена_Город]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена_МР]
    as 'avg
        (
            [Организации],
            [Measures].[Средняя по организации]
        )'
    member [Measures].[Средняя по организации]
    as 'avg
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children,
            ( [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember, [Measures].[Цена] )
        )'
    member [Measures].[Средняя розничная цена_ГП СП]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена]
    as 'iif
        (
            [Measures].[Город],
            [Measures].[Средняя розничная цена_Город],
            iif
            (
                [Measures].[МР],
                [Measures].[Средняя розничная цена_МР],
                iif
                (
                    [Measures].[ГП СП],
                    [Measures].[Средняя розничная цена_ГП СП],
                    null
                )
            )
        )'
    member [Measures].[Средняя розничная цена на текущую дату]
    as '
        (
            <%period_cur_date%>,
            [Measures].[Средняя розничная цена]
        )'
    member [Measures].[Средняя розничная цена на предыдущую дату]
    as '
        (
            <%period_last_date%>,
            [Measures].[Средняя розничная цена]
        )'
    member [Measures].[Абсолютное отклонение к предыдущему периоду]
    as 'iif(not IsEmpty([Measures].[Средняя розничная цена на текущую дату]) and not IsEmpty([Measures].[Средняя розничная цена на предыдущую дату]),
    [Measures].[Средняя розничная цена на текущую дату] - [Measures].[Средняя розничная цена на предыдущую дату],
    null)'
    member [Measures].[Темп прироста к предыдущему периоду]
    as 'iif(not IsEmpty([Measures].[Средняя розничная цена на текущую дату]) and not IsEmpty([Measures].[Средняя розничная цена на предыдущую дату]) and
    [Measures].[Средняя розничная цена на предыдущую дату] > 0,
    [Measures].[Средняя розничная цена на текущую дату] / [Measures].[Средняя розничная цена на предыдущую дату] - 1,
    null)'
    member [Measures].[Средняя розничная цена на начало года]
    as '
        (
            <%period_year%>,
            [Measures].[Средняя розничная цена]
        )'
    member [Measures].[Абсолютное отклонение к началу года]
    as 'iif(not IsEmpty([Measures].[Средняя розничная цена на текущую дату]) and not IsEmpty([Measures].[Средняя розничная цена на начало года]),
    [Measures].[Средняя розничная цена на текущую дату] - [Measures].[Средняя розничная цена на начало года],
    null)'
    member [Measures].[Темп прироста к началу года]
    as 'iif(not IsEmpty([Measures].[Средняя розничная цена на текущую дату]) and not IsEmpty([Measures].[Средняя розничная цена на предыдущую дату]) and
    [Measures].[Средняя розничная цена на начало года] > 0,
    [Measures].[Средняя розничная цена на текущую дату] / [Measures].[Средняя розничная цена на начало года] - 1,
    null)'
    member [Measures].[Уровень]
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name'
    set [Территории для ранга]
    as 'filter
        (
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[МР ГО],
                SELF
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and
            not IsEmpty([Measures].[Средняя розничная цена на текущую дату])
        )'
    member [Measures].[Прямой ранг]
    as 'Rank([Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember, [Территории для ранга], [Measures].[Средняя розничная цена на текущую дату])'
    member [Measures].[Худший ранг]
    as 'Max([Территории для ранга], [Measures].[Прямой ранг])'
    member [Measures].[Обратный ранг]
    as '[Measures].[Худший ранг] - [Measures].[Прямой ранг] + 1'
    member [Measures].[Ранг]
    as 'iif([Measures].[Город] or [Measures].[МР], [Measures].[Обратный ранг], null)'
select
    {
        [Measures].[Средняя розничная цена на текущую дату],
        [Measures].[Средняя розничная цена на предыдущую дату],
        [Measures].[Средняя розничная цена на начало года],
        [Measures].[Ранг],
        [Measures].[Абсолютное отклонение к предыдущему периоду],
        [Measures].[Темп прироста к предыдущему периоду],
        [Measures].[Абсолютное отклонение к началу года],
        [Measures].[Темп прироста к началу года],
        [Measures].[Худший ранг]
    } on columns,
    [Территории] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
    )
    ]]>
  </query>

  <query id="GSM_0003_0001_grid_hmao_old">
    <![CDATA[ -- GSM_0003_0001_grid_hmao
with
    set [Территории]
    as 'filter
        (
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[ГП СП ВТГФЗ],
                LEAVES
            ),
            not IsEmpty ([Measures].[Цена])
        )'
    set [Организации]
    as 'filter
        (
            [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children,
            not IsEmpty
            (
                [Measures].[Средняя по организации]
            )
        )'
    member [Период__День].[Период__День].[Текущая дата]
    as '<%period_cur_date%>'
    member [Период__День].[Период__День].[Предыдущая дата]
    as '<%period_last_date%>'
    member [Период__День].[Период__День].[Начало года]
    as '<%period_year%>'
    member [Measures].[Средняя по организации]
    as 'avg
        (
            [Территории],
            ( [Measures].[Цена ] )
        )'
    member [Measures].[Средняя цена ]
    as 'GeoMean
        (
            SetToArray
            (
                filter
                (
                    [Организации],
                    not IsEmpty
                    (
                        [Measures].[Средняя по организации]
                    )
                ),
                [Measures].[Средняя по организации]
            )
        )'
    member [Measures].[Ранг]
    as 'null'
    member [Measures].[Средняя цена текущая дата]
    as '
        (
            [Период__День].[Период__День].[Текущая дата],
            [Measures].[Средняя цена ]
        )'
    member [Measures].[Средняя цена предыдущая дата]
    as '
        (
            [Период__День].[Период__День].[Предыдущая дата],
            [Measures].[Средняя цена ]
        )'
    member [Measures].[Средняя цена начало года]
    as '
        (
            [Период__День].[Период__День].[Начало года],
            [Measures].[Средняя цена ]
        )'
    member [Measures].[АО предыдущая дата]
    as 'iif
        (
            not IsEmpty
            (
                [Measures].[Средняя цена текущая дата]
            ) and not IsEmpty
            (
                [Measures].[Средняя цена предыдущая дата]
            ),
            [Measures].[Средняя цена текущая дата] - [Measures].[Средняя цена предыдущая дата],
            null
        )'
    member [Measures].[АО начало года]
    as 'iif
        (
            not IsEmpty
            (
                [Measures].[Средняя цена текущая дата]
            ) and not IsEmpty
            (
                [Measures].[Средняя цена начало года]
            ),
            [Measures].[Средняя цена текущая дата] - [Measures].[Средняя цена начало года],
            null
        )'
    member [Measures].[ТП предыдущая дата]
    as 'iif
        (
            not IsEmpty
            (
                [Measures].[Средняя цена текущая дата]
            ) and not IsEmpty
            (
                [Measures].[Средняя цена предыдущая дата]
            ) and not
            (
                [Measures].[Средняя цена предыдущая дата] = 0
            ),
            [Measures].[Средняя цена текущая дата] / [Measures].[Средняя цена предыдущая дата] - 1,
            null
        )'
    member [Measures].[ТП начало года]
    as 'iif
        (
            not IsEmpty
            (
                [Measures].[Средняя цена текущая дата]
            ) and not IsEmpty
            (
                [Measures].[Средняя цена начало года]
            ) and not
            (
                [Measures].[Средняя цена начало года] = 0
            ),
            [Measures].[Средняя цена текущая дата] / [Measures].[Средняя цена начало года] - 1,
            null
        )'
    member [Measures].[Цена ]
    as '
        (
            [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
            [Measures].[Цена],
            [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
            [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember,
            [Период__День].[Период__День].CurrentMember,
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.DataMember,
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
        )'
    set [Данные]
    as '
        {
            [Measures].[Средняя цена текущая дата],
            [Measures].[Средняя цена предыдущая дата],
            [Measures].[Средняя цена начало года],
            [Measures].[Ранг],
            [Measures].[АО предыдущая дата],
            [Measures].[ТП предыдущая дата],
            [Measures].[АО начало года],
            [Measures].[ТП начало года]
        }'
select
    { [Данные] } on columns
from [ОРГАНИЗАЦИИ_Цены и тарифы]
    ]]>
  </query>

  <query id="GSM_0003_0001_grid_hmao">
    <![CDATA[ -- GSM_0003_0001_grid_hmao
with
    set [Территории]
    as 'filter
        (
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[ГП СП ВТГФЗ],
                LEAVES
            ),
            not IsEmpty ([Measures].[Цена])
        )'
    set [Организации]
    as 'filter
        (
            [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children,
            not IsEmpty
            (
                [Measures].[Средняя по организации]
            )
        )'
    set [Даты]
    as '
        {
            <%period_cur_date%>,
            <%period_last_date%>,
            <%period_year%>
        }'
    member [Measures].[Средняя по организации]
    as 'avg
        (
            [Территории],
            ( [Measures].[Цена ] )
        )'
    member [Measures].[Цена ]
    as '
        (
            [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
            [Measures].[Цена],
            [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
            [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember,
            [Период__День].[Период__День].CurrentMember,
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
            [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
        )'
select
    [Даты] on columns,
    [Организации] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Measures].[Средняя по организации]
    )
    ]]>
  </query>

  <query id = "GSM_0003_0001_chart1">
    <![CDATA[ -- GSM_0003_0001_chart1
with
    set [Территории]
    as 'order
        (
            filter
            (
                Descendants
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[МР ГО],
                    SELF
                ),
                not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and
                not IsEmpty(([Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember, [Measures].[Средняя розничная цена на текущую дату]))
            ),
            [Measures].[Средняя розничная цена на текущую дату]
        )'
    set [Организации]
    as '[Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children'
    member [Measures].[Город]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[МР]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count > 0,
            true,
            false
        )'
    member [Measures].[ГП СП]
    as 'iif
        (
            [Measures].[Уровень] = "ГП СП ВТГФЗ" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[Средняя розничная цена_Город]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена_МР]
    as 'avg
        (
            [Организации],
            [Measures].[Средняя по организации]
        )'
    member [Measures].[Средняя по организации]
    as 'avg
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children,
            ( [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember, [Measures].[Цена] )
        )'
    member [Measures].[Средняя розничная цена_ГП СП]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена]
    as 'iif
        (
            [Measures].[Город],
            [Measures].[Средняя розничная цена_Город],
            iif
            (
                [Measures].[МР],
                [Measures].[Средняя розничная цена_МР],
                iif
                (
                    [Measures].[ГП СП],
                    [Measures].[Средняя розничная цена_ГП СП],
                    null
                )
            )
        )'
    member [Measures].[Средняя розничная цена на текущую дату]
    as '
        (
            <%period_cur_date%>,
            [Measures].[Средняя розничная цена]
        )'
    member [Measures].[Уровень]
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name'
select
    {
        [Measures].[Средняя розничная цена на текущую дату]
    } on columns,
    [Территории] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
    )   
    ]]>
  </query>

  <query id = "GSM_0003_0001_map">
    <![CDATA[ -- GSM_0003_0001_map
with
    set [Территории]
    as 'order
        (
            filter
            (
                Descendants
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[МР ГО],
                    SELF
                ),
                not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and
                not IsEmpty(([Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember, [Measures].[Средняя розничная цена на текущую дату]))
            ),
            [Measures].[Средняя розничная цена на текущую дату]
        )'
    set [Организации]
    as '[Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children'
    member [Measures].[Город]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[МР]
    as 'iif
        (
            [Measures].[Уровень] = "МР ГО" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count > 0,
            true,
            false
        )'
    member [Measures].[ГП СП]
    as 'iif
        (
            [Measures].[Уровень] = "ГП СП ВТГФЗ" and [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children.Count = 0,
            true,
            false
        )'
    member [Measures].[Средняя розничная цена_Город]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена_МР]
    as 'avg
        (
            [Организации],
            [Measures].[Средняя по организации]
        )'
    member [Measures].[Средняя по организации]
    as 'avg
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Children,
            ( [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember, [Measures].[Цена] )
        )'
    member [Measures].[Средняя розничная цена_ГП СП]
    as 'avg
        (
            [Организации],
            [Measures].[Цена]
        )'
    member [Measures].[Средняя розничная цена]
    as 'iif
        (
            [Measures].[Город],
            [Measures].[Средняя розничная цена_Город],
            iif
            (
                [Measures].[МР],
                [Measures].[Средняя розничная цена_МР],
                iif
                (
                    [Measures].[ГП СП],
                    [Measures].[Средняя розничная цена_ГП СП],
                    null
                )
            )
        )'
    member [Measures].[Средняя розничная цена на текущую дату]
    as '
        (
            <%period_cur_date%>,
            [Measures].[Средняя розничная цена]
        )'
    member [Measures].[Уровень]
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name'
    set [Территории для ранга]
    as 'filter
        (
            Descendants
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[МР ГО],
                SELF
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember is [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Parent.DataMember and
            not IsEmpty([Measures].[Средняя розничная цена на текущую дату])
        )'
    member [Measures].[Прямой ранг]
    as 'Rank([Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember, [Территории для ранга], [Measures].[Средняя розничная цена на текущую дату])'
    member [Measures].[Худший ранг]
    as 'Max([Территории для ранга], [Measures].[Прямой ранг])'
    member [Measures].[Обратный ранг]
    as '[Measures].[Худший ранг] - [Measures].[Прямой ранг] + 1'
    member [Measures].[Ранг]
    as 'iif([Measures].[Город] or [Measures].[МР], [Measures].[Обратный ранг], null)'
select
    {
        [Measures].[Средняя розничная цена на текущую дату],
        [Measures].[Ранг]
    } on columns,
    [Территории] on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[СТАТ Отчетность - ДЭ Еженедельная (поселения)],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
    )   
    ]]>
  </query>

</root>