<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FO_0021_0003_date">
    <![CDATA[
-- FO_0021_0003_date
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                Descendants
                (
                    [Период].[Период].[Данные всех периодов],
                    [Период].[Период].[Квартал],
                    SELF
                ),
                not IsEmpty
                (
                    (
                        [Показатели].[ФПКУ_Сопоставимый].[Все показатели]
                    )
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Квартал 1"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Остатки на начало года"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Данные квартала"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Данные полугодия"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Данные месяца"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Данные года"
                ) and
                (
                   [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
                )
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_ФПКУ_Показатели]
]]>
  </query>

  <query id="FO_0021_0003_grid">
    <![CDATA[
-- FO_0021_0003_grid
with 
    set [Список районов] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы].[Сопоставимый].[Все районы],
                [Районы].[Сопоставимый].[Уровень 04],
                SELF 
            ),
            not 
            (
                [Районы].[Сопоставимый].CurrentMember is  [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or  [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" 
            ) 
        )' 

    member [Период].[Период].[Отклонение]
    as 'IIF 
        (
            IsEmpty 
            (
                [Период].[Период].[Данные всех периодов].<%selected_prev_period%>
            ) or IsEmpty 
            (
                [Период].[Период].[Данные всех периодов].<%selected_prev_period%>
            ),
            null,
            [Период].[Период].[Данные всех периодов].<%selected_period%> - [Период].[Период].[Данные всех периодов].<%selected_prev_period%>
        )' 
    set [Периоды] 
    as ' 
        {
            [Период].[Период].[Данные всех периодов].<%selected_prev_period%>,
            [Период].[Период].[Данные всех периодов].<%selected_period%>
        }' 
        
    member [Районы].[Сопоставимый].[Аггрегироавнные районы]           
    as 'Aggregate({[Список районов]})'         
     
    set [Список показателей до Итого]        
    as 'Filter        
        (
            Descendants           
            (
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели],
                [Показатели].[ФПКУ_Сопоставимый].[Показатели],
                SELF           
            ),
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "Несопоставленные данные"       
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "V34"       
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "V35"       
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "V36"       
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "Итоговая оценка"
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "Рейтинг"       
            ) and        
            (
                [Показатели].[ФПКУ_Сопоставимый].CurrentMember.Name <> "Средняя оценка"       
            ) and <%direction_filter%> = true     
        )'         
    set [Список общих показателей]       
    as 'Filter       
        (
            {
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[Итоговая оценка],
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[Рейтинг],
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[Средняя оценка]      
            },
            Measures.[Выбран удельный вес] = true    
        )' 
        
    set [Список показателей корректировки итоговой оценки]    
    as 'Filter      
        (
            {
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[V34],
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[V35],
                [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[V36]     
            },
            <%direction_filter%> = true      
        )'      
    member Measures.[Учитывать квартальный]       
    as '[Показатели].[ФПКУ_Сопоставимый].CurrentMember.Properties("Содержание") = "Ежеквартально"'  
    
    member Measures.[Выбран удельный вес]
    as '"<%selected_measure%>" = "Взвешенное значение"'
    
    member Measures.[Выбран год]
    as '"<%direction_filter%>" = "true"'
    
    member [Показатели].[ФПКУ_Сопоставимый].[Итого баллов] 
    as 'Aggregate
        (
            [Список показателей до Итого]
        )' 
select
    {
        Filter
        (
              {
                [Список показателей до Итого] +  
                Filter
                (
                  {[Показатели].[ФПКУ_Сопоставимый].[Итого баллов]},
                   Measures.[Выбран удельный вес] = true and Measures.[Выбран год] = true   
                ) + 
                [Список показателей корректировки итоговой оценки] + 
                [Список общих показателей]
              },
              not 
              (
                  IsEmpty   
                  (
                      ([Районы].[Сопоставимый].[Аггрегироавнные районы], [Период].[Период].[Данные всех периодов].<%selected_period%>)   
                  ) and
                  IsEmpty   
                  (
                      ([Районы].[Сопоставимый].[Аггрегироавнные районы], [Период].[Период].[Данные всех периодов].<%selected_prev_period%>)   
                  )
              )
        )
        * 
        {
            [Периоды] + 
            {
                [Период].[Период].[Отклонение]
            }
        } 
    } on columns,
    non empty
    {
        Order 
        (
            [Список районов],
            [Показатели].[ФПКУ_Сопоставимый].[Все показатели].[Рейтинг],
            BASC 
        ) 
    } on rows 
from  [ФО_ФПКУ_Показатели] 
where 
    (
         [Measures].[<%selected_measure%>] 
    )  
    ]]>
  </query>

  <query id="FO_0021_0003_indicatorDescription">
    <![CDATA[
-- FO_0021_0003_indicatorDescription
With
    set [Список показателей]
    as '
        {
            Descendants
                (
                   [Показатели].[ФПКУ_Сопоставимый].[Все показатели],
                   [Показатели].[ФПКУ_Сопоставимый].[Показатели],
                    SELF
                ) -
                {
                    [Показатели].[ФПКУ_Сопоставимый].[Несопоставленные данные],
                    [Показатели].[ФПКУ_Сопоставимый].[Рейтинг],
                    [Показатели].[ФПКУ_Сопоставимый].[Средняя оценка]
                }
        }'

    member [Measures].[Наименование]
    as '[Показатели].[ФПКУ_Сопоставимый].CurrentMember.Properties("Наименование")'
Select
    {
       [Measures].[Наименование]
    } on columns,
    { [Список показателей] } on rows
From [ФО_ФПКУ_Показатели]
  ]]>
  </query>

</root>