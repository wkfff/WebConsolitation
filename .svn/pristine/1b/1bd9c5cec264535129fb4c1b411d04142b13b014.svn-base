<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="GetRegionBuYear">
    <![CDATA[with
    set [region]
    as '
    Filter([Территории__РФ].[Территории__РФ].members,
[Территории__РФ].[Территории__РФ].parent is <%RegionBaseDimension%>
and not [Территории__РФ].[Территории__РФ].currentmember.is_datamember)'


    member [UniqueName]
    as '[Территории__РФ].[Территории__РФ].currentmember.unique_name'
    member [LevelNumber]
    as '[Территории__РФ].[Территории__РФ].currentmember.LEVEL_NUMBER - 5'
SELECT
    non empty
    {
    filter(
[region],
[ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3]> 0)
    }on rows,
    {
    [LevelNumber],
[UniqueName]
    }  on columns
FROM   [ФСТ_ЖКХ по МО_Форма П3]--[ФСТ_ЖКХ по МО_Форма 1 БухБаланс]
where
(
<%ChosenCurPeriod%>
)
]]>
  </query>  
  <query id="Grid">
    <![CDATA[
    --Grid
    with  
    member [Measures].[ИНН] 
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].currentmember.Properties("ИНН")' 
    member [Measures].[КПП] 
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].currentmember.Properties("КПП")'    
    
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q1]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 1].[Квартал 1].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q2]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 1].[Квартал 2].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q3]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 2].[Квартал 3].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q4]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].datamember'
    
SELECT
    non empty  
    {
        [Measures].[ИНН],
        [Measures].[КПП] 
    }  on columns,
    {
    filter(
        Except
        (
            [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].members ,
            {
                [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Все организации].[Значение не указано],[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Все организации]
            }
        ) ,
        [Measures].[Всего] > 0)
    }on rows 
FROM    [ФСТ_ЖКХ по МО_Форма П3]
 where 
    (
        <%ChosenRegionGrid%>,
        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[<%ChosenCurQnum%>]
    ) 
]]>
  </query>
  <query id="Grid2">
    <![CDATA[with 
    member [Measures].[ИНН] 
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].currentmember.Properties("ИНН")' 
    member [Measures].[КПП] 
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].currentmember.Properties("КПП")' 
    
    member [Measures].[level]
    as '[ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].currentmember.Properties("Код")'
    member [Measures].[First]
    as '[Measures].[Всего]'
    member [Measures].[Last]
    as '[Measures].[Просроченная задолженность]'
    
    set [curorg]
    as '
    {[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[<%SelectCPP%>]}
    /*filter
        (
            Except
            (
                [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].members ,
                {
                    [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Все организации].[Значение не указано],
                    [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Все организации]
                }
            ),
                    [Measures].[КПП] = "<%SelectCPP%>"                                        
                    and
                    [Measures].[ИНН] = <%SelectIIN%>
        )*/'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q1]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 1].[Квартал 1].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q2]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 1].[Квартал 2].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q3]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].[Полугодие 2].[Квартал 3].datamember'
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[q4]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%ChosenYear%>].datamember'
SELECT
    non empty 
    {
    filter(
    Except(
       [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].Members,
        {[ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[(All)].[Все показатели],
        [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[(All)].[Все показатели].[Значение не указано]} ),
       not [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].currentmember.is_datamember)
    } on rows  ,
    non empty{
    Crossjoin(
[curorg],
{[Measures].[First],
 [Measures].[Last],
 [Measures].[level]})
    }on columns
FROM    [ФСТ_ЖКХ по МО_Форма П3]--[ФСТ_ЖКХ по МО_Форма 1 БухБаланс] 
where 
    (
        --[Источники данных].[Источники данных].[Источник].[ФСТ ЖКХ по МО - ЕИАС_ФормаП3] ,
        <%ChosenRegionGrid%>,
        --<%ChosenCurPeriod%>
        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[<%ChosenCurQnum%>]
    ) 
]]>
  </query>


  <query id="ComboRegion">
    <![CDATA[with
    set [region]
    as '
    Filter([Территории__РФ].[Территории__РФ].members,
([Территории__РФ].[Территории__РФ].parent is <%RegionBaseDimension%>
or
[Территории__РФ].[Территории__РФ].parent.parent is <%RegionBaseDimension%>)
and not [Территории__РФ].[Территории__РФ].currentmember.is_datamember)'


    member [UniqueName]
    as '[Территории__РФ].[Территории__РФ].currentmember.unique_name'
    member [LevelNumber]
    as '[Территории__РФ].[Территории__РФ].currentmember.LEVEL_NUMBER - 5'
SELECT
    non empty
    {
    filter(
[region],
[ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3]> 0)
    }on rows,
    {
    [LevelNumber],
[UniqueName]
    }  on columns
FROM   [ФСТ_ЖКХ по МО_Форма П3]--[ФСТ_ЖКХ по МО_Форма 1 БухБаланс]
]]>
  </query>
  <query id="ComboYear">
    <![CDATA[    with
    member [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[UniqueName]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.UniqueName'
    member [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[LevelNumber]
    as '1'
    member [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[Year]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.parent.parent.name'
SELECT
    non empty
    {
        [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[UniqueName],
        [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[LevelNumber],
        [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[Year]
    }on columns  ,
    non empty
    {
    filter(
    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год].members,
    not isempty(    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.datamember)
    ),
    
        Filter
        (
            [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Квартал].members,
            [ФСТ__Показатели Формы П3].[ФСТ__Показатели Формы П3].[(All)].[Все показатели] > 0
        )
    }on rows
FROM [ФСТ_ЖКХ по МО_Форма П3]
where
(
<%RegionBaseDimension%>
)
  
]]>
  </query>
</root>