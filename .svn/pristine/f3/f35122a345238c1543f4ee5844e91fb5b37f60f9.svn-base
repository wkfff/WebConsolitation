<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="Grid">
    <![CDATA[
    with
   <%IsHmao%>member [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета] as 'null'
    set [region]
    as '
    {<%RegionBaseDimension%>}
    +
    Filter
        (
            [Территории__РФ].[Территории__РФ].members,
            (
                (
                    
                        [Территории__РФ].[Территории__РФ].currentmember.parent is <%RegionBaseDimension%> or
                    
                    [Территории__РФ].[Территории__РФ].currentmember.children.count = 0
                )
                and
             not [Территории__РФ].[Территории__РФ].currentmember.is_datamember
            )
        )'
        member [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[_avg]
    as 'Aggregate
        (
            filter 
            (
                [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Вид благоустройства].members,
                [Measures].[Тариф]+
                [Measures].[Норматив]>0
            ),
            [Measures].[Тариф]
        )/ filter
        (
            [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Вид благоустройства].members,
            [Measures].[Тариф]+
            [Measures].[Норматив]>0
        ).count'
        
    set [Услуги]
    as '
    <%ChosenYslyg%>
    --[ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[_avg]
    '
    set [Виды Благоустройства]
    as '
    <%ChosenBlago%>
    '
    set [Организа]
    as '
        {
            [ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[(All)].[Все организации]
        }'
    member [Measures].[Тариф ]
    as 'iif
        (
            [Территории__РФ].[Территории__РФ].currentmember.children.count > 0,
            [Measures].[Средний тариф по МО],
            [Measures].[Средний тариф по МО]
        )'
    member [Measures].[Норматив ]
    as 'iif
        (
            [Территории__РФ].[Территории__РФ].currentmember.children.count > 0,

            [Measures].[Норматив по МО]
            ,
            [Measures].[Норматив по МО]
        )'
    member [Measures].[ParentRegion]
    as '[Территории__РФ].[Территории__РФ].currentmember.parent.name'
       member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[empty]
    as 'null'
<%IsHmao%>member [ФСТ__Детали учета].[ФСТ__Детали учета].[по приборам учета] as 'null'

member [ФСТ__Детали учета].[ФСТ__Детали учета].[при отсутствии приборов учёта ]
    as '[ФСТ__Детали учета].[ФСТ__Детали учета].[при отсутствии приборов учёта]+[ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[Не определено]'

SELECT
    non empty     
    {
        filter( Crossjoin 
        (
            [region],
            Crossjoin 
            (
                [Услуги],
                Crossjoin 
                (
                    [Виды Благоустройства],
                    [Организа] 
                ) 
            ) 
        )  
        ,
                        [Measures].[Тариф ]+
                        [Measures].[Норматив ])
    }on rows  ,
--    non empty
    {
    Crossjoin
        (
            {
                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов]
            },
            {

                Crossjoin
                (
                    {
                        [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета]
                    },
                    {
                     [Measures].[ParentRegion]
                    }
                )
            }
        ),
        Crossjoin
        (
            {
                
                <%ChosenCurPeriod%>,
                <%ChosenPrevPeriod%>
            },
            {Crossjoin
            (
                {
                
                    [ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета].[при наличии приборов учёта]
                },
                {[Measures].[Тариф ]}
            ),
            Crossjoin
            (
                {
                    [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета],
                    [ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета].[при отсутствии приборов учёта ]
                },
                {
                    [Measures].[Тариф ],[Measures].[Норматив ]
                }
            )}
        )
    }  on columns 
FROM   [ФСТ_ЖКХ по МО_Тарифы и нормативы] 
 
]]>
  </query>
  <query id="ComboRegion">
    <![CDATA[with
    <%IsHmao%> member [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета] as 'null'
    member [DisplayName]
    as 'iif([ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].currentmember is [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Все виды благоустройств],[ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].currentmember.name,[ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].currentmember.name)'
    member [UniqueName]
    as '[ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].currentmember.unique_name'
    member [UniqueName_]
    as '[ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].currentmember.unique_name'
    member [LevelNumber]
    as 'iif([ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].currentmember is [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Все виды благоустройств],0,1)'
    member [ФСТ__Детали учета].[ФСТ__Детали учета].[AllDe]
    as 'Aggregate({[ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета]})'
    member [EdIzm]
    as '[ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].CurrentMember.Properties("Единица измерения")'
    
SELECT
    non empty
    {
        filter
        (
            Crossjoin
            (
                Except
                (
                    [ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].members,
                    [ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].[(All)].[Все услуги]
                ),
                   [ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].members

            ),
            [Measures].[Тариф]> 0
            and
            [LevelNumber] = 0
        )
    }on rows,
    {
        [LevelNumber],
        [UniqueName],
        [UniqueName_],
        [DisplayName],
        [EdIzm]
    }  on columns
FROM  [ФСТ_ЖКХ по МО_Тарифы и нормативы]
where
(
[ФСТ__Детали учета].[ФСТ__Детали учета].[AllDe],
 <%RegionBaseDimension%> 
)
]]>
  </query>
  <query id="ComboYear">
    <![CDATA[with
    <%IsHmao%> member [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета] as 'null'
    set [Услуги]
    as '[ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].[Услуга].members'
    set [Виды Благоустройства]
    as '[ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Вид благоустройства].members'
    set [Организа]
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Организация].members'
    member [first-tar]
    as '
        (
            [Measures].[Тариф],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[при наличии приборов учета]
        )'
    member [next-tar]
    as '
        (
            [Measures].[Тариф],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[при отсутствии приборов учета]
        )'
    member [next-norm]
    as '
        (
            [Measures].[Норматив],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[при отсутствии приборов учета]
        )'

    member [LevelNumber]
    as '[Территории__РФ].[Территории__РФ].currentmember.LEVEL_NUMBER - 4'
    member [year]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.parent.parent.parent.name'
    member [mounth]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.name'
    member [uname]
    as '[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].currentmember.uniquename'
SELECT
    non empty
    {
        filter
        (
            [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Месяц].members,
            [Measures].[Тариф]> 0
        )
    }on rows,
    {

        [year],
        [mounth],
        [uname]
    }  on columns
FROM  [ФСТ_ЖКХ по МО_Тарифы и нормативы]
where
    (
         <%RegionBaseDimension%>
    )
]]>
  </query>
  <query id="RegionLevel">
    <![CDATA[with
    <%IsHmao%> member [ФСТ__Детали учета].[ФСТ__Детали учета].[Все детали учета].[по приборам учета] as 'null'
    set [region]     
    as '
    Filter([Территории__РФ].[Территории__РФ].members,
[Территории__РФ].[Территории__РФ].parent is <%RegionBaseDimension%>
or
[Территории__РФ].[Территории__РФ].parent.parent is <%RegionBaseDimension%> )'
    set [Услуги] 
    as '[ФСТ__Услуги ЖКХ].[ФСТ__Услуги ЖКХ].[Услуга].members'  
    set [Виды Благоустройства] 
    as '[ФСТ__Виды благоустройств].[ФСТ__Виды благоустройств].[Вид благоустройства].members'  
    set [Организа] 
    as '[ФСТ__Организации ЖКХ].[ФСТ__Организации ЖКХ].[Организация].members'  
    member [first-tar] 
    as '  
        (
            [Measures].[Тариф],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета].[при наличии приборов учета]
        )' 
    member [next-tar] 
    as '
        (
            [Measures].[Тариф],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета].[при отсутствии приборов учёта]
        )'  
    member [next-norm] 
    as '
        (
            [Measures].[Норматив],
            [ФСТ__Детали учета].[ФСТ__Детали учета].[Деталь учета].[при отсутствии приборов учёта]
         )'
    member [UniqueName]
    as '[Территории__РФ].[Территории__РФ].currentmember.unique_name'
    member [LevelNumber]
    as '[Территории__РФ].[Территории__РФ].currentmember.LEVEL_NUMBER - 5'
SELECT
    non empty
    {
    filter(
[region],
[Measures].[Тариф]> 0)
    }on rows,
    {
    [LevelNumber],
[UniqueName]
    }  on columns 
FROM  [ФСТ_ЖКХ по МО_Тарифы и нормативы]
 
]]>
  </query>

  
</root>