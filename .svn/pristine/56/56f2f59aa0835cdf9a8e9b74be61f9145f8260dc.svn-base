<?xml version="1.0" encoding="Windows-1251"?>
<root>
 <query id="FK_0001_0018_date">
    <![CDATA[
-- FK_0001_0004_detail_date
-- <#[ФК_МесОтч_Доходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Источники финансирования]
  ]]>
  </query>

<query id="FK_0001_0018_grid">
    <![CDATA[
WITH
  member Measures.[Код]
  as '[КИФ].[Сопоставимый].CurrentMember.Properties("Код")'
  
  member [Measures].[Исполнено млн]
  as '[Measures].[Исполнено]/1000000'
  
  member [Measures].[Назначено млн]
  as '[Measures].[Назначено]/1000000'
  
  member [Measures].[Исполнено прошлый год млн]
  as '[Measures].[Исполнено прошлый год]/1000000'
  
  member [Measures].[Назначено прошлый год млн]
  as '[Measures].[Назначено прошлый год]/1000000'
  
  member [Measures].[Исполнено_%]
  as ' IIF
        ( 
          IsEmpty
           (
             [Measures].[Назначено млн]
           ) or [Measures].[Назначено млн] = 0,
           null,
          [Measures].[Исполнено млн]/[Measures].[Назначено млн]
        )'
        
  member [Measures].[Исполнено прошлый год_%]
  as 'IIF
      ( 
         IsEmpty
         (
           [Measures].[Назначено прошлый год млн]
         ) or [Measures].[Назначено прошлый год млн] = 0,
         null,
        [Measures].[Исполнено прошлый год млн]/[Measures].[Назначено прошлый год млн]
      )'
      
  member [Measures].[Уровень]
  as '[КИФ].[Сопоставимый].CurrentMember.Level.Name'    
  
  SET [NonFilterColumnSet] AS '
    { [Measures].[Код],
      [Measures].[Исполнено млн],
      [Measures].[Исполнено прошлый год млн],
      [Measures].[Темп роста к аналогичному периоду предыдущего года_Исполнено],
      [Measures].[Назначено млн],
      [Measures].[Назначено прошлый год млн],
      [Measures].[Темп роста к аналогичному периоду предыдущего года_Назначено],
      [Measures].[Исполнено_%],
      [Measures].[Исполнено прошлый год_%],
      [Measures].[Уровень]     
    }'
    
    -- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
 
SELECT
  [NonFilterColumnSet] ON COLUMNS,
  {
     Filter(  
                Descendants 
                (
                    [КИФ].[Сопоставимый].[Все источники финансирования],
                    [КИФ].[Сопоставимый].[Статья],
                    SELF_AND_BEFORE 
                )
               - 
                {[КИФ].[Сопоставимый].[Все источники финансирования],
                [КИФ].[Сопоставимый].[Все источники финансирования].[Несопоставленные данные],
                [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов],
                 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Увеличение остатков средств],
                 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Выдача бюджетных кредитов другим бюджетам бюджетной системы Российской Федерации],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Уменьшение остатков средств],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Погашение бюджетных кредитов, выданных другим бюджетам бюджетной системы Российской Федерации],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[увеличение внутренних заимствований (КОСГУ 710)],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[уменьшение внутренних заимствований (КОСГУ 810)]},
                not (
                      [КИФ].[Сопоставимый].CurrentMember is
                      [КИФ].[Сопоставимый].CurrentMember.Parent.DataMember
                    ) and
               not IsEmpty(Measures.[Исполнено млн])  
                
            )    
              +
                {[КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов],
                 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Увеличение остатков средств],
                 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Выдача бюджетных кредитов другим бюджетам бюджетной системы Российской Федерации],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Уменьшение остатков средств],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[Погашение бюджетных кредитов, выданных другим бюджетам бюджетной системы Российской Федерации],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[увеличение внутренних заимствований (КОСГУ 710)],
				 [КИФ].[Сопоставимый].[Все источники финансирования].[Итого внутренних оборотов].[уменьшение внутренних заимствований (КОСГУ 810)]
                }
    } ON ROWS
FROM [ФК_МесОтч_Источники финансирования]
WHERE
  (
    [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
    [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>],
    [Уровни бюджета].[СКИФ].[<%skif_level%>]
  )
  ]]>
  </query>
  
</root>