<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FO_0039_0004_date">
    <![CDATA[
-- FO_0039_0004_date
-- <#[ФО_Оценка качества ОиОБП_Показатели]#>
with    
    member [Measures].[ДанныеНа]    
    as '[Период].[Период].CurrentMember.UniqueName'    
    set [NonEmptySet]    
    as 'Tail    
        (
            Filter    
            (
                Descendants   
                (
                    [Период].[Период].[Данные всех периодов],
                    [Период].[Период].[Квартал],
                    SELF   
                ),
                not IsEmpty    
                (
                    (
                        [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р2]    
                    )    
                ) and   
                (
                    [Период].[Период].CurrentMember.Name <> "Остатки на начало года"  
                ) and  
                (
                    [Период].[Период].CurrentMember.Name <> "Данные квартала" 
                ) and  
                (
                    [Период].[Период].CurrentMember.Name <> "Данные полугодия" 
                ) and 
                (
                    [Период].[Период].CurrentMember.Name <> "Данные месяца"
                ) and 
                (
                    [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
                ) 
            ),
            1    
        )'    
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows    
from [ФО_Оценка качества ОиОБП_Показатели]   
]]>
  </query>

  <query id="FO_0039_0004_chart">
    <![CDATA[
-- FO_0039_0004_chart
with     
    set [Список МР]     
    as 'Filter     
        (
            Descendants     
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF     
            ),
            not     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember     
            ) and     
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"    
            )     
        )'  
    set [Список ГО]     
    as 'Filter     
        (
            Descendants     
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF     
            ),
            not     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember     
            ) and     
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"     
            )     
        )'  
    set [Список МО]     
    as ' [Список ГО] + [Список МР] '
    set [Список показателей]     
    as '     
        {
            Filter     
            (
                Descendants     
                (
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Показатели],
                    SELF     
                ) -     
                {
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Несопоставленные данные],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Группа МО],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Итоговая оценка уровня качества ОиОБП],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Рейтинг МО],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Средняя оценка уровня качества ОиОБП],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Степень качества ОиОБП],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р15_Здравоохранение],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р15_Культура],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р15_Молодежная политика],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р15_Образование]
                },
                IIF
                (
                    [Период].[Период].[Данные всех периодов].<%selected_period%>.Level is [Период].[Период].[Квартал],
                    [Показатели].[Оценка качества ОиОБП_Сопоставимый].CurrentMember.Properties("Периодичность расчета показателя") = "квартал",
                    true
                )
            )     
        }'   
    member [Measures].[Число показателей, оценка которых равна 1 (максимальный балл)] 
    as 'Count  
        (
            Filter  
            (
                [Список показателей],
                not IsEmpty([Measures].[Значение]) and [Measures].[Оценка показателя] = 1  
            )  
        )' 
    member [Measures].[Показатели, оценка которых равна 1] 
    as 'Generate
        (
            Filter 
            (
                [Список показателей],
                not IsEmpty([Measures].[Значение]) and [Measures].[Оценка показателя] = 1 
            ) ,
            [Показатели].[Оценка качества ОиОБП_Сопоставимый].CurrentMember.Name,
            ", br"
        )' 
    member [Measures].[Число показателей, оценка которых равна 0 (минимальный балл)]
    as 'Count  
        (
            Filter  
            (
                [Список показателей],
                not IsEmpty([Measures].[Значение]) and [Measures].[Оценка показателя] = 0  
            )  
        )'  
    member [Measures].[Показатели, оценка которых равна 0]
    as 'Generate
        (
            Filter
            (
                [Список показателей],
                not IsEmpty([Measures].[Значение]) and [Measures].[Оценка показателя] = 0
            ) ,
            [Показатели].[Оценка качества ОиОБП_Сопоставимый].CurrentMember.Name,
            ", br"
        )'
    member Measures.[Выводим пустоту]    
    as '[Период].[Период].[Данные всех периодов].<%selected_period%>.Level is [Период].[Период].[Год] and 
        IsEmpty
        (
            (
                [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Р4],
                [Период].[Период].[Данные всех периодов].<%selected_period%>.DataMember,
                [Measures].[Оценка показателя]
            )   
        ) '        
select
    {
        [Measures].[Число показателей, оценка которых равна 1 (максимальный балл)],
        [Measures].[Число показателей, оценка которых равна 0 (минимальный балл)],
        [Measures].[Показатели, оценка которых равна 1],
        [Measures].[Показатели, оценка которых равна 0]
    } on columns,
non empty   
{
    Order   
    (
        Filter  
        (
            [Список МО],
            not (Measures.[Выводим пустоту]) and not   
            (
                [Measures].[Число показателей, оценка которых равна 1 (максимальный балл)] = 0 and [Measures].[Число показателей, оценка которых равна 0 (минимальный балл)] = 0  
            )
        ),
        (
            [Показатели].[Оценка качества ОиОБП_Сопоставимый].[Все показатели].[Рейтинг МО],
            [Measures].[Оценка показателя]  
        ),
        BASC   
    )   
} on rows   
from  [ФО_Оценка качества ОиОБП_Показатели]     
where     
    (
        [Период].[Период].[Данные всех периодов].<%selected_period%>
    )      
  ]]>
      </query>

</root>