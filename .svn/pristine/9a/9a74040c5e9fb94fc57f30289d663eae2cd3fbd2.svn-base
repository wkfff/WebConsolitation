<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0002_0035_03_date">
    <![CDATA[
-- FO_0002_0035_03_date
with
    member Measures.[ДанныеНа]
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName'
select
    {Measures.[ДанныеНа]} on columns,
    Tail
    (
        NonEmptyCrossjoin
        (
            Filter
            (
                Descendants
                (
                   [Период__Период].[Период__Период].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
                   [Период__Период].[Период__Период].[День],
                   SELF
                ),
                [Период__Период].[Период__Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период__Период].[Период__Период].CurrentMember.Name <> "Данные квартала" and
                [Период__Период].[Период__Период].CurrentMember.Name <> "Данные полугодия" and
                [Период__Период].[Период__Период].CurrentMember.Name <> "Данные года"
            )
        )
    ) on rows
from  [ФО_АС Бюджет_КазнИсп_Факт расхода]
  ]]>
  </query>

  <query id="FO_0002_0035_03_grid">
    <![CDATA[
-- FO_0002_0035_03_grid
with            
    set [Мероприятия]            
    as 'Filter
        (
            Descendants            
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Все мероприятия].[Ремонт автомобильных дорог и дорожных сооружений общего пользования],
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Мероприятия уровень 3],
                SELF_AND_BEFORE            
            ),
            not 
            ( 
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Parent.DataMember
            )
        )
        '     
    set [Мероприятия по районам]            
    as 'Filter
        (
            [Мероприятия],
            Measures.[Мероприятие по району]
        )
        '            
    set [Прочие мероприятия]      
    as 'Filter  
        (
            [Мероприятия],
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name = "Кредиторская задолженность"
            ) or 
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name = "Прочие затраты"
            ) 
        )'       

    set [Районы]            
    as 'Filter            
        (
            Descendants            
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы].[Новосибирская область (Консолидированный)],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 04],
                SELF            
            ), 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            ) and not            
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember            
            )            
        )'            
    member Measures.[План ]            
    as 'IIF   
        (
            [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[ИТОГО по ремонту] ,
            Sum   
            (
                {
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам]   
                } + [Прочие мероприятия],
                Measures.[План ]   
            ),
            IIF   
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам],
                Sum          
                (
                    [Мероприятия по районам],
                    Measures.[План ]         
                ),
                IIF          
                (
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района],
                    Sum            
                    (
                        Filter      
                        (
                            [Мероприятия по районам],
                            InStr   
                            (
                                Measures.[Район мероприятия],
                                Measures.[Район]
                            ) > 0       
                        ),
                        Measures.[План ]            
                    ),
                    (
                        [Measures].[Ассигнования],
                        [Роспись Уведомления].[Уточненный план].[Утвержденный план],
                        [Роспись Кассовый план].[Роспись Кассовый план].[Все].[Роспись],
                        [Период__Дата принятия].[Период__Дата принятия].[Данные всех периодов].[<%period_year%>],
                        [Период__Период].[Период__Период].[Данные всех периодов].[<%period_year%>],
                        [Районы__Сопоставимый].[Районы__Сопоставимый].DefaultMember            
                    ) / 1000            
                )         
            )  
        )'   
    member [Measures].[Непустой факт ]
    as 'IIF
        (
            IsEmpty([Measures].[Факт ]),
            0,
            [Measures].[Факт ]
        )'        
    member [Measures].[Факт ]            
    as 'IIF      
        (
            [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[ИТОГО по ремонту] ,
            Sum     
            (
                {
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам]     
                } + [Прочие мероприятия],
                [Measures].[Факт ]     
            ),
            IIF      
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам],
                Sum            
                (
                    [Мероприятия по районам],
                    Measures.[Факт ]            
                ),
                IIF            
                (
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района],
                    Sum            
                    (
                        Filter      
                        (
                            [Мероприятия по районам],
                            InStr   
                            (
                                Measures.[Район мероприятия],
                                Measures.[Район]
                            ) > 0      
                        ),
                        Measures.[Факт ]            
                    ),
                    LookupCube            
                    (
                        "[ФО_АС Бюджет_КазнИсп_Факт расхода]",
                        "            
                        (
                            [Measures].[Расход с возвратом нараст итог],
                            [Период__Период].[Период__Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
                            " + MemberToStr            
                            (
                                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember            
                            ) + ",
                            " + MemberToStr 
                            (
                                [Тип средств__АС Бюджет].[Тип средств__АС Бюджет].CurrentMember 
                            ) + "             
                        )"            
                    ) / 1000 
                )           
            )      
        )'      
    member [Measures].[% исполнения ]            
    as 'IIF            
        (
            IsEmpty(Measures.[План ]) or (Measures.[План ]) = 0,
            null,
            Measures.[Факт ] / Measures.[План ]            
        ) '            
    member [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района]       
    as '[Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Все мероприятия].[Ремонт автомобильных дорог и дорожных сооружений общего пользования]'            
    member [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам]            
    as '[Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Все мероприятия].[Ремонт автомобильных дорог и дорожных сооружений общего пользования]'             
    member [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[ИТОГО по ремонту]       
    as '[Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Все мероприятия].[Ремонт автомобильных дорог и дорожных сооружений общего пользования]'       
    member Measures.[Наименование] 
    as 'IIF 
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
            [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
            IIF 
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района],
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Name,
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name
                --Measures.[Мероприятие без района]
            ) 
        )'          
    member Measures.[Уровень]            
    as 'IIF            
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы] or
            [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember is [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района],
            0,
            1            
        )'      
    set [Мероприятия c районами]      
    as 'Generate      
        (
            [Районы],
            {
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember      
            }      
            *      
            {
                {
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Итого по мероприятиям района]      
                } + Filter      
                (
                    [Мероприятия],
                    InStr   
                    (
                        Measures.[Район мероприятия],
                        Measures.[Район]
                    ) > 0       
                )      
            }      
        ) '  
    member Measures.[Район] 
    as ' Mid 
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Name,
            0,
            InStr
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Name,
                " " 
            ) - 3
        )'  
    member Measures.[Район мероприятия]
    as 'IIF
        (
          InStr
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
                ","
            ) > 0,
            Mid
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
                InStr
                (
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
                    ","
                ) + 1
            ),
            ""
         ) '      
    member Measures.[Мероприятие без района]
    as 'Mid
        (
            [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
            0,
            InStr
            (
                [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].CurrentMember.Name,
                ","
            ) - 1
        )'     
    member Measures.[Мероприятие по району]
    as 'InStr
        (
           Measures.[Район мероприятия],
           "район"
        ) > 0 or
        InStr
        (
           Measures.[Район мероприятия],
           "р-он"
        ) > 0'           
select
    {
        Measures.[Наименование],
        Measures.[План ],
        Measures.[Непустой факт ],
        Measures.[% исполнения ],
        Measures.[Уровень]
    } on columns,
    Filter            
    (
        [Мероприятия c районами] +      
        {
            {
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы] 
            }        
            *        
            {
                {
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[Всего по районам]     
                } + [Прочие мероприятия] +      
                {
                    [Мероприятия__Сопоставимый].[Мероприятия__Сопоставимый].[ИТОГО по ремонту]     
                }      
            }       
        } ,
        not            
        (
            IsEmpty(Measures.[План ])         
        )            
    ) on rows            
from [ФО_АС Бюджет_План расходов]            
  ]]>
  </query>

</root>