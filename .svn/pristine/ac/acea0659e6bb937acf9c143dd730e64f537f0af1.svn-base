CALCULATE;



CREATE MEMBER CURRENTCUBE.Measures.[Итого] AS
 [Measures].[Прогноз] + [Measures].[Реструктуризация] + [Measures].[Недоимка] + [Measures].[Доначисление],
FORMAT_STRING = "Currency";


SCOPE(Descendants([Период__Период].[Период__Период].[Данные всех периодов])); 


this = IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом],

IIF(not IsEmpty(CalculationPassValue(([Measures].[Прогноз нарастающим итогом], 
[Период__Период].[Период__Период].CurrentMember), 1)) and CalculationPassValue(([Measures].[Прогноз нарастающим итогом],
 [Период__Период].[Период__Период].CurrentMember), 1) <> 0, 
([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember),

Sum({OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год])):
[Период__Период].[Период__Период].CurrentMember}, [Measures].[Прогноз])),
/*
IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом], 

IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember) and 
[Период__Период].[Период__Период].CurrentMember.Name <> "Данные года", 

IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "(All)" or 
[Период__Период].[Период__Период].CurrentMember.Level.Name = "Год" or 
([Период__Период].[Период__Период].CurrentMember 
Is OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год]))),

([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember), 

 Sum({OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год])):
[Период__Период].[Период__Период].CurrentMember}, [Measures].[Прогноз])),

[Период__Период].[Период__Период].Currentmember),
*/
([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember));


/*
SCOPE(Descendants([Период__Период].[Период__Период].[Данные всех периодов]));
 this = 
IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом] and not IsLeaf([Период__Период].[Период__Период].CurrentMember) and [Период__Период].[Период__Период].CurrentMember.Name <> "Данные года",

IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "(All)" or 
[Период__Период].[Период__Период].CurrentMember.Level.Name = "Год" or 
([Период__Период].[Период__Период].CurrentMember Is OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год]))),

([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember), 

Sum({OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год])):
[Период__Период].[Период__Период].CurrentMember}, [Measures].[Прогноз])),

IIF([Период__Период].[Период__Период].CurrentMember is [Период__Период].[Период__Период].[Данные всех периодов],
Sum([Период__Период].[Период__Период].CurrentMember, [Measures].[Прогноз нарастающим итогом]),
([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember)));
END SCOPE;
*/
/*
SCOPE([Период__Период].[Период__Период].[Год]);
 this = 
IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом],
IIF(not IsEmpty(([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом])) and ([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом]) <>0, 
([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом]), ([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом])),
([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember));
END SCOPE;
*/
END SCOPE;














/*
SCOPE(Descendants([Период__Период].[Период__Период].[Данные всех периодов])); 

this = /*IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом], */

IIF(not IsEmpty(CalculationPassValue(([Measures].[Прогноз нарастающим итогом], 
[Период__Период].[Период__Период].CurrentMember), 0)) and CalculationPassValue(([Measures].[Прогноз нарастающим итогом],
 [Период__Период].[Период__Период].CurrentMember), 0) <> 0, 
([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember),

IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом], 

IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember) and 
[Период__Период].[Период__Период].CurrentMember.Name <> "Данные года", 

IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "(All)" or 
[Период__Период].[Период__Период].CurrentMember.Level.Name = "Год" or 
([Период__Период].[Период__Период].CurrentMember 
Is OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год]))),

([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember), 

 Sum({OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год])):
[Период__Период].[Период__Период].CurrentMember}, [Measures].[Прогноз])),

[Период__Период].[Период__Период].Currentmember),

([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember)));


/*
SCOPE(Descendants([Период__Период].[Период__Период].[Данные всех периодов]));
 this = 
IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом] and not IsLeaf([Период__Период].[Период__Период].CurrentMember) and [Период__Период].[Период__Период].CurrentMember.Name <> "Данные года",

IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "(All)" or 
[Период__Период].[Период__Период].CurrentMember.Level.Name = "Год" or 
([Период__Период].[Период__Период].CurrentMember Is OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год]))),

([Measures].[Прогноз нарастающим итогом], [Период__Период].[Период__Период].CurrentMember), 

Sum({OpeningPeriod([Период__Период].[Период__Период].CurrentMember.Level, 
Ancestor([Период__Период].[Период__Период].CurrentMember, [Период__Период].[Период__Период].[Год])):
[Период__Период].[Период__Период].CurrentMember}, [Measures].[Прогноз])),

IIF([Период__Период].[Период__Период].CurrentMember is [Период__Период].[Период__Период].[Данные всех периодов],
Sum([Период__Период].[Период__Период].CurrentMember, [Measures].[Прогноз нарастающим итогом]),
([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember)));
END SCOPE;
*/

SCOPE([Период__Период].[Период__Период].[Год]);
 this = 
IIF([Measures].CurrentMember is [Measures].[Прогноз нарастающим итогом],
IIF(not IsEmpty(([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом])) and ([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом]) <>0, 
([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом]), ([Период__Период].[Период__Период].Currentmember.FirstChild, [Measures].[Прогноз нарастающим итогом])),
([Measures].CurrentMember,[Период__Период].[Период__Период].Currentmember));
END SCOPE;

END SCOPE;
*/


SCOPE({[Measures].[План]});
    this = IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember),
IIF([Период__Период].[Период__Период].CurrentMember is [Период__Период].[Период__Период].[Данные всех периодов], 
Sum([Период__Период].[Период__Период].[Данные всех периодов].Children),
Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not 
(IsEmpty([Measures].CurrentMember))), 1).Item(0)), [Период__Период].[Период__Период].CurrentMember);
END SCOPE;



SCOPE({[Measures].[Оценка нарастающим итогом]});
    this = IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember),
IIF([Период__Период].[Период__Период].CurrentMember is [Период__Период].[Период__Период].[Данные всех периодов], 
Sum([Период__Период].[Период__Период].[Данные всех периодов].Children),
Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not 
(IsEmpty([Measures].CurrentMember))), 1).Item(0)), [Период__Период].[Период__Период].CurrentMember);
END SCOPE;

SCOPE({[Measures].[Прогноз нарастающим итогом]});
    this = IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember),
IIF([Период__Период].[Период__Период].CurrentMember is [Период__Период].[Период__Период].[Данные всех периодов], 
Sum([Период__Период].[Период__Период].[Данные всех периодов].Children),
Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not 
(IsEmpty([Measures].CurrentMember))), 1).Item(0)), [Период__Период].[Период__Период].CurrentMember);
END SCOPE;

