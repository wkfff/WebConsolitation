<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="PM_0001_0004_date">
    <![CDATA[ -- PM_0001_0004_date
      select
	      distinct t.RefPublicDate as Date
      from
	      dv.DV_OOS_Tenders t
      where t.RefPublicDate > 0
    ]]>
  </query>

  <query id="PM_0001_0004_purch_type">
    <![CDATA[
      select
	      ID, Name
      from
	      dv.FV_OOS_PurchTyp
      where
	      id in (1, 3, 4, 6, 8)
    ]]>
  </query>

  <query id="PM_0001_0004_grid">
    <![CDATA[ -- PM_0001_0004_grid
      select
	      t1.Name, t1.NotificationNum,
        Customer = case (t1.RefCustomer)
        when -1 then
          '-'
        else
          c.Name
        end,
	      GiveDate = case (t1.RefGiveDate)
	      when -1 then
		      '-'
	      else
		      Substring(cast(t1.RefGiveDate as varchar(8)), 7, 2) + '.' +
		      Substring(cast(t1.RefGiveDate as varchar(8)), 5, 2) + '.' +
		      Substring(cast(t1.RefGiveDate as varchar(8)), 1, 4)
	      end,
	      ConsiderDate = case (t1.RefConsiderDate)
	      when -1 then
		      '-'
	      else
		      Substring(cast(t1.RefConsiderDate as varchar(8)), 7, 2) + '.' +
		      Substring(cast(t1.RefConsiderDate as varchar(8)), 5, 2) + '.' +
		      Substring(cast(t1.RefConsiderDate as varchar(8)), 1, 4)
	      end,
	      ResultDate = case (t1.RefResultDate)
	      when -1 then
		      '-'
	      else
		      Substring(cast(t1.RefResultDate as varchar(8)), 7, 2) + '.' +
		      Substring(cast(t1.RefResultDate as varchar(8)), 5, 2) + '.' +
		      Substring(cast(t1.RefResultDate as varchar(8)), 1, 4)
	      end,
	      MatchDate = case (t1.RefMatchDate)
	      when -1 then
		      '-'
	      else
		      Substring(cast(t1.RefMatchDate as varchar(8)), 7, 2) + '.' +
		      Substring(cast(t1.RefMatchDate as varchar(8)), 5, 2) + '.' +
		      Substring(cast(t1.RefMatchDate as varchar(8)), 1, 4)
	      end,
	      t1.Link
      from
	      dv.DV_OOS_Tenders t1,
	      (select p.NotificationNum, max(p.DataSourceName) as DataSource from dv.DV_OOS_Tenders p group by p.NotificationNum) t2,
	      dv.DV_OOS_Customers c
      where
	      t1.RefPublicDate = <%selected_date%> and t1.RefPurchTyp = <%ref_purch_type%> and
        t1.NotificationNum = t2.NotificationNum and t1.DataSourceName = t2.DataSource and c.ID = t1.RefCustomer
    ]]>
  </query>

</root>