<?xml version="1.0" encoding="windows-1251"?>
<root>
  <query id="FO_0002_0005_HMAO_date">
    <![CDATA[
-- FO_0002_0005_HMAO_allocation_date
-- <#[ФО_МесОтч_Доходы]#>
with
    member [Measures].[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                <%period_dimension%>.Members,
                not IsEmpty([Measures].[Факт])
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from  [ФО_МесОтч_Доходы]
  ]]>
</query>

<query id="FO_0002_0005_HMAO_chart">
<![CDATA[
-- FO_0002_0005_HMAO_allocation_chart
with
    member Measures.[Численность постоянного населения по МО]   
    as 'IIF            
        (
            [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%>,
            Sum            
            (
                [Города и районы],
                Measures.[Численность постоянного населения по МО]   
            ),
            LookupCube            
            (
                "[ФО_Показатели для планирования]",
                "            
                (
                    [Measures].[Факт],
                    <%population_measure%>,
                    " + MemberToStr            
                    (
                        [Районы].[Сопоставимый].CurrentMember            
                    ) + ",
                    " + MemberToStr     
                    (
                        [Период].[Период].CurrentMember     
                    ) + "     
                ) / 1000"            
            )            
        )'             
    member Measures.[Численность постоянного населения]
    as '0'      
    
    member Measures.[Доходы]
    as '
        (
            [Measures].[Факт],
            <%incomes_total%>
        )'
    member Measures.[Среднедушевые доходы]
    as ' Measures.[Доходы] / 1000 '
        
    member Measures.[Дотации]
    as '
        (
            [Measures].[Факт],
            <%incomes_kd_all_level%>.[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований].[Дотации на выравнивание бюджетной обеспеченности]
        )  '
        
    member Measures.[Среднедушевые доходы без дотаций]
    as ' Measures.[Доходы] / 1000 - Measures.[Дотации] / 1000 '
    
    member [ТипДокумента].[СКИФ].[Тип документа] 
    as '<%region_document_skif_type%>'  
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ] 
    as '<%region_budget_skif_level%>'     
    set [Города и районы]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" or
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            )
        )'
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )'         
select
    {
        Measures.[Численность постоянного населения],
        Measures.[Среднедушевые доходы],
        Measures.[Среднедушевые доходы без дотаций]
    } on columns,
    [Города и районы] on rows
from [ФО_МесОтч_Доходы]
where
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [ТипДокумента].[СКИФ].[Тип документа],
        [Уровни бюджета].[СКИФ].[Уровень бюджета ]
    )
  ]]>
  </query>

<query id="FO_0002_0005_HMAO_avg">
    <![CDATA[
-- FO_0002_0005_HMAO_allocation_avg
with  
    member Measures.[Численность постоянного населения]
    as '<%population_total%>'      
    member Measures.[Доходы]
    as '
        (
            [Measures].[Факт],
            <%incomes_total%>
        ) / 1000'
        
    member Measures.[Дотации]    
    as '    
        (
            [Measures].[Факт],
            <%incomes_kd_all_level%>.[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований].[Дотации на выравнивание бюджетной обеспеченности]    
        ) / 1000'  
        
    member Measures.[Доходы всего]    
    as 'Sum    
        (
            [Города и районы],
            Measures.[Доходы]    
        )'    
        
    member Measures.[Доходы без дотаций всего]    
    as 'Sum    
        (
            [Города и районы],
            Measures.[Доходы] - Measures.[Дотации]  
        )'    
 
    member Measures.[Доходы среднее]    
    as '  
        (
            Measures.[Доходы всего] / Measures.[Численность постоянного населения]    
        )'    
        
    member Measures.[Доходы без дотаций среднее]    
    as '    
        (
            Measures.[Доходы без дотаций всего] / Measures.[Численность постоянного населения]    
        )'  
        
    member [ТипДокумента].[СКИФ].[Тип документа] 
    as '<%region_document_skif_type%>'  
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ] 
    as '<%region_budget_skif_level%>'         
    
    set [Города и районы]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" or
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            )
        )' 
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )'         
select
    {
        Measures.[Доходы среднее],
        Measures.[Доходы без дотаций среднее]    
    } on columns
from [ФО_МесОтч_Доходы]    
where        
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [ТипДокумента].[СКИФ].[Тип документа],
        [Уровни бюджета].[СКИФ].[Уровень бюджета ]
    )     
  ]]>
  </query>

  <query id="FO_0002_0005_HMAO_allcation_population">
    <![CDATA[
-- FO_0002_0005_HMAO_allcation_population 
with   
    member Measures.[Численность постоянного населения по МО] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все МО],
            Sum 
            (
                [Города и районы],
                Measures.[Численность постоянного населения по МО]
            ),
            Measures.[За период] / 1000
        )  '  
    member Measures.[Численность постоянного населения] 
    as 'IIF 
        (
            not IsEmpty 
            (
                (
                    Measures.[Численность постоянного населения по МО],
                    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                ) 
            ),
            (
                Measures.[Численность постоянного населения по МО],
                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
            ),
            (
                Tail 
                (
                    Filter 
                    (
                        {
                            [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[2000] : [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.PrevMember
                        },
                        not IsEmpty 
                        (
                            Measures.[Численность постоянного населения по МО] 
                        ) 
                    ) 
                ).Item(0),
                Measures.[Численность постоянного населения по МО] 
            ) 
        )' 
        
    set [Города]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            )
        )'
    set [Районы]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            )
        )'
    set [Города и районы]
    as '[Города] + [Районы]'    

    member [Районы].[Сопоставимый].[Все МО] 
    as '[Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы]'

select
    {
        Measures.[Численность постоянного населения]
    } on columns,
    {
        { [Районы].[Сопоставимый].[Все МО] } + [Города и районы]
    } on rows 
from [СТАТ_Население_Численность и состав] 
where 
    (
        [Население__Численность и состав].[Население__Численность и состав].[Все показатели].[Численность населения на начало года],
        [Группировки__Население_Численность и состав].[Группировки__Население_Численность и состав].[Все группировки].[По городам и районам],
        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов].[<%period_year%>]
    ) 
  ]]>
  </query>
</root>