<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="EO_0001_0005_grid">
    <![CDATA[
-- EO_0001_0005_grid
with
    set [Объекты строительства]
    as '[Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].[Все объекты].Children'
    member [Measures].[Целевая программа]
    as 'nonEmpty
        (
            [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].[Все программы].Children,
            (
                [Measures].[Значение],
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember
            )
        ).Item(0).Name'
    member [Measures].[Территория]
    as 'nonEmpty
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра].Children,
            (
                [Measures].[Значение],
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember
            )
        ).Item(0).Name'
    member [Measures].[Заказчик]
    as 'Generate
        (
            nonEmpty
            (
                [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].[Данные всех источников].Children,
                (
                    [Measures].[Значение],
                    [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember
                )
            ),
            [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].CurrentMember.Name,
            ",
            "
        )'
    member [Measures].[Сроки строительства]
    as '[Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember.Properties("Начало строительства") + "-" + [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember.Properties("Завершение строительства")'
    member [Measures].[Статус]
    as 'nonEmpty
        (
            [Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].[Все статусы].Children,
            (
                [Measures].[Значение],
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember
            )
        ).Item(0).Name'
    member [Measures].[Стоимость объекта]
    as '
        (
            [Исполнение расходов__Показатели АИП].[Исполнение расходов__Показатели АИП].[Все показатели].[Стоимость в текущих ценах по контракту],
            [Measures].[Значение]
        )'
    member [Measures].[Профинансировано с начала строительства]
    as '
        (
            [Исполнение расходов__Показатели АИП].[Исполнение расходов__Показатели АИП].[Все показатели].[Финансирование],
            [Исполнение расходов__Источники финансирования].[Исполнение расходов__Источники финансирования].[Все источники финансирования],
            [Measures].[Значение]
        )'
    member [Measures].[Освоено с начала строительства]
    as '
        (
            [Исполнение расходов__Показатели АИП].[Исполнение расходов__Показатели АИП].[Все показатели].[Освоено в текущих ценах],
            [Measures].[Значение]
        )'
    member [Measures].[Процент финансирования]
    as 'IIF
        (
            IsEmpty([Measures].[Стоимость объекта]) or [Measures].[Стоимость объекта] = 0,
            nul,
            [Measures].[Профинансировано с начала строительства] / [Measures].[Стоимость объекта]
        )'
    member [Measures].[Процент освоения от стоимости объекта]
    as 'IIF
        (
            IsEmpty([Measures].[Стоимость объекта]) or [Measures].[Стоимость объекта] = 0,
            nul,
            [Measures].[Освоено с начала строительства] / [Measures].[Стоимость объекта]
        )'
    member [Measures].[Процент освоения от финансирования]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Профинансировано с начала строительства]
            ) or [Measures].[Профинансировано с начала строительства] = 0,
            nul,
            [Measures].[Освоено с начала строительства] / [Measures].[Профинансировано с начала строительства]
        )'
    member [Measures].[Общая информация]
    as '[Measures].[Целевая программа] + ";"+ [Measures].[Территория] + ";"+ [Measures].[Заказчик] + ";"+ [Measures].[Сроки строительства] + ";"+ [Measures].[Статус]'

    member [Measures].[Финансирование]
    as 'Str([Measures].[Профинансировано с начала строительства]) + ";"+ Str([Measures].[Процент финансирования])'

    member [Measures].[Освоение]
    as 'Str([Measures].[Освоено с начала строительства]) + ";"+ Str([Measures].[Процент освоения от стоимости объекта]) + ";"+ Str([Measures].[Процент освоения от финансирования]) '
select
    {
        [Measures].[Общая информация],
        [Measures].[Стоимость объекта],
        [Measures].[Финансирование],
        [Measures].[Освоение]
    } on columns,
    Filter
    (
        [Объекты строительства],
        not IsEmpty 
        ( 
           (
              [Measures].[Стоимость объекта],
              <%selected_program%>,
              <%selected_region%>,
              <%selected_customer%>,
              <%selected_status%>
           )
        )      
    ) on rows
from [ЭО_Сбор исполнения расходов_АИП]
  ]]>
  </query>

  <query id="EO_0001_0005_programDigest">
    <![CDATA[
-- EO_0001_0005_programDigest
with
    set [Программы]  
    as ' 
        {
            [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].[Все программы] 
        } + Filter  
        (
            [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].AllMembers,
            not [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember.is_dataMember and
            [Measures].[Число объектов] <> 0
        )'   
    member [Measures].[Число объектов]  
    as 'Count 
        (
            Filter 
            (
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].[Все объекты].Children,
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].CurrentMember.Properties("REFLISTPRG") = [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember.Properties("PKID")
            ) 
        )'          
    member [Measures].[Число объектов1] 
    as 'Count
        (
            nonEmpty 
            (
                [Исполнение расходов__Объекты строительства].[Исполнение расходов__Объекты строительства].[Все объекты].Children,
                (
                    [Measures].[Значение],
                    [Исполнение расходов__Показатели АИП].[Исполнение расходов__Показатели АИП].[Все показатели].[Стоимость в текущих ценах по контракту],
                    [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember 
                ) 
            )
        )'  
    member [Measures].[Имя]
    as '[Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember.Name '
    member [Measures].[Уникальное имя]
    as '[Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember.UniqueName'
    member [Measures].[Уровень]
    as 'IIF
        (
            [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember is [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].[Все программы], 
            0,
            IIF
            (
                [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].CurrentMember.Level is [Исполнение расходов__Реестр программ].[Исполнение расходов__Реестр программ].[Программа],
                1,
                2
            )
        )'
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень]
    } on columns,
    { [Программы] } on rows
from [ЭО_Сбор исполнения расходов_АИП]
  ]]>
  </query>

  <query id="EO_0001_0005_regionDigest">
    <![CDATA[
-- EO_0001_0005_regionDigest
with 
    set [Территории] 
    as '{[Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра]} +
        Filter
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра].Children,
            not ([Территории__РФ].[Территории__РФ].CurrentMember.is_DataMember)
        )' 
    member [Measures].[Имя] 
    as 'IIF 
        (
            [Территории__РФ].[Территории__РФ].CurrentMember is [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра],
            "Все территории",
            [Территории__РФ].[Территории__РФ].CurrentMember.Name 
        )'      
    member [Measures].[Уникальное имя] 
    as '[Территории__РФ].[Территории__РФ].CurrentMember.UniqueName'
    member [Measures].[Уровень] 
    as 'IIF 
        (
            [Территории__РФ].[Территории__РФ].CurrentMember is [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра],
            0,
            1 
        )'
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень] 
    } on columns,
    { [Территории] } on rows
from [ЭО_Сбор исполнения расходов_АИП]   
  ]]>
  </query>

  <query id="EO_0001_0005_customerDigest">
    <![CDATA[
-- EO_0001_0005_customerDigest
with 
    set [Заказчики]
    as '{[Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].[Данные всех источников]} + 
        [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].[Данные всех источников].Children'
    member [Measures].[Имя] 
    as 'IIF 
        (
            [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].CurrentMember is [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].[Данные всех источников],
            "Все заказчики",
            [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].CurrentMember.Name 
        )'     
    member [Measures].[Уникальное имя] 
    as '[Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].CurrentMember.UniqueName'
    member [Measures].[Уровень]    
    as 'IIF 
        (
            [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].CurrentMember is [Исполнение расходов__Заказчики объектов].[Исполнение расходов__Заказчики объектов].[Данные всех источников],
            0,
            1 
        )' 
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень] 
    } on columns,
    { [Заказчики] } on rows
from [ЭО_Сбор исполнения расходов_АИП]   
  ]]>
  </query>

  <query id="EO_0001_0005_statusDigest">
    <![CDATA[
-- EO_0001_0005_statusDigest
with    
    set [Статусы]   
    as '  
        {
            [Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].[Все статусы]  
        } + [Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].[Все статусы].Children'   
    member [Measures].[Имя]    
    as '[Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].CurrentMember.Name'   
    member [Measures].[Уникальное имя]    
    as '[Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].CurrentMember.UniqueName'   
    member [Measures].[Уровень]    
    as 'IIF 
        (
            [Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].CurrentMember is [Исполнение расходов__Статус объекта].[Исполнение расходов__Статус объекта].[Все статусы],
            0,
            1 
        )'  
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень]    
    } on columns,
    { [Статусы] } on rows   
from [ЭО_Сбор исполнения расходов_АИП]     
  ]]>
  </query>

</root>