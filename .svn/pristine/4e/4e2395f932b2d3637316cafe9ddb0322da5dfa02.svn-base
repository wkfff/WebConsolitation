<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FK_0001_0004_Vologda_date">
    <![CDATA[
-- FK_0001_0004_Vologda_detail_date
-- <#[ФК_МесОтч_Доходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Доходы]
  ]]>
  </query>

  <query id="FK_0001_0004_Vologda_grid">
    <![CDATA[
-- FK_0001_0004_Vologda_detail_grid
-- <#[ФК_МесОтч_Доходы]#>
with 
    member [КД].[Сопоставимый].[Доходы итого] 
    as '[КД].[Сопоставимый].[Все коды доходов].[Доходы - всего в том числе:]' 
    member Measures.[Темп роста] 
    as '[Measures].[Темп роста к аналогичному периоду предыдущего года_Исполнено]' 
    member Measures.[Доля] 
    as ' 
        (
            [КД].[Сопоставимый].CurrentMember,
            [Measures].[Исполнено] 
        )/ 
        (
            [КД].[Сопоставимый].[Доходы итого],
            [Measures].[Исполнено] 
        )' 
    member Measures.[Доля прошлый год] 
    as ' 
        (
            [КД].[Сопоставимый].CurrentMember,
            [Measures].[Исполнено прошлый год] 
        )/ 
        (
            [КД].[Сопоставимый].[Доходы итого],
            [Measures].[Исполнено прошлый год] 
        )' 
    member Measures.[Исполнено млн] 
    as 'Measures.[Исполнено] / 1000000' 
    member Measures.[Исполнено прошлый год млн] 
    as 'Measures.[Исполнено прошлый год] / 1000000' 
    member Measures.[Назначено млн] 
    as 'Measures.[Назначено] / 1000000' 
    member Measures.[Назначено прошлый год млн] 
    as 'Measures.[Назначено прошлый год] / 1000000' 
    member Measures.[Процент выполнения прошлый год] 
    as 'IIF 
        (
            IsEmpty 
            (
                [Measures].[Назначено прошлый год] 
            ) or [Measures].[Назначено прошлый год] = 0,
            null,
            [Measures].[Исполнено прошлый год] / [Measures].[Назначено прошлый год] 
        )' 
    member Measures.[Уровень] 
    as '[КД].[Сопоставимый].CurrentMember.Level.Name' 
    member Measures.[Код]
    as '[КД].[Сопоставимый].CurrentMember.Properties("Код")'
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
    
     member [Measures].[% наполнения бюджета]        
    as '
    IIF( (
                 [Период].[Период].[Данные всех периодов].[<%period_last_year%>].[Полугодие 2].[Квартал 4].[Декабрь],
                [Measures].[Исполнено]  
            ) = 0, null,
        (
            (
                 [Период].[Период].[Данные всех периодов].[<%period_last_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
                [Measures].[Исполнено] 
            ) /  
            (
                 [Период].[Период].[Данные всех периодов].[<%period_last_year%>].[Полугодие 2].[Квартал 4].[Декабрь],
                [Measures].[Исполнено]  
            )  
        ))'
--    
select
    {
        Measures.[Код],
        Measures.[Исполнено млн],
        Measures.[Исполнено прошлый год млн],
        Measures.[Темп роста],
        Measures.[Доля],
        Measures.[Доля прошлый год],
        Measures.[Назначено млн],
        Measures.[Процент выполнения назначений],
        [Measures].[% наполнения бюджета], 
        Measures.[Уровень] 
    } on columns,
    non empty Filter 
    (
        Descendants([КД].[Сопоставимый].[Все коды доходов], [КД].[Сопоставимый].[Подстатья], Self_and_before) - {[КД].[Сопоставимый].[Все коды доходов]},
        not ([КД].[Сопоставимый].CurrentMember is [КД].[Сопоставимый].CurrentMember.Parent.DataMember) and
        (
           Measures.[Исполнено млн] + Measures.[Исполнено прошлый год млн] + Measures.[Назначено млн] + Measures.[Назначено прошлый год млн]
        ) <> 0
    ) on rows
from [ФК_МесОтч_Доходы] 
where 
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>],
        [Уровни бюджета].[СКИФ].[<%skif_level%>]
    ) 
  ]]>
  </query>

</root>