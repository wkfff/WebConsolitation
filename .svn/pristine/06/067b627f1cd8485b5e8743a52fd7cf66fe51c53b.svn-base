<?xml version="1.0" encoding="Windows-1251"?>
<root>


  <query id="years">
    <![CDATA[
    --SEP_0003 years
with 
member [Measures].[Примечание]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")'
 member [Measures].[Индикатор]
    as ' IIF
        (
            Right
            (
                [Measures].[Примечание],
                1
            )<>"+" ,
            IIF
            ( 
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0  and  [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                  Round(  (
                        [Measures].[Значение]/
                        (
                            ParallelPeriod
                            ( 
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )
                    ),2)
                ,
                null
            )     ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0 and   [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                   Round( (
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )/[Measures].[Значение]
                    ),2)
                ,
                null
            )
        )  '
    set [Показатели социальной сферы] 
    as ' Filter 
        (
            Descendants 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF 
            ),
            Left 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1 
            )="1" and Len 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") 
            )=3 
        )  ' 
    set [Показатели экономической сферы] 
    as ' Filter 
        (
            Descendants 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF 
            ),
            Left 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1 
            )="2" and Len
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")
            )=3
        )  ' 
    set [Показатели финансовой сферы] 
    as ' Filter 
        (
            Descendants 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF 
            ),
            Left 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1 
            )="3" and Len 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") 
            )=3 
        )  ' 
    member [Measures].[Кол-во пустых показателей в соц] 
    as ' Count 
        (
            Filter 
            (
                [Показатели социальной сферы],
                isempty 
                (
                    (
                       [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember 
                    ) 
                ) 
            ) 
        ) ' 
    member [Measures].[Кол-во пустых показателей в фин] 
    as ' Count 
        (
            Filter 
            (
                [Показатели финансовой сферы]  ,
                isempty 
                (
                    (
                       [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember 
                    ) 
                ) 
            ) 
        ) ' 
    member [Measures].[Кол-во пустых показателей в экон] 
    as ' Count 
        (
            Filter 
            (
                [Показатели экономической сферы]   ,
                isempty 
                (
                    (
                        [Measures].[Индикатор]
                    ) 
                ) 
            ) 
        ) ' 
    set [Года] 
    as ' Filter 
        (
            [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год].members ,
            [Measures].[Кол-во пустых показателей в соц]<=3 and
            [Measures].[Кол-во пустых показателей в экон]<=3 and
            [Measures].[Кол-во пустых показателей в фин]<=3
        )   ' 
select
    non empty  
    {
      [Measures].[Значение]
    }on columns,
  --  NON EMPTY
    {
     [Года]

    } on rows  
from [ЭО_СЭР_МО Ленинградская область]  
where  
    (
       <%baseRegion%>
    )  
]]>
  </query>

  <query id="regions">
    <![CDATA[
    --SEP_0003 regions
select
    non empty
    {
     [Measures].[Значение]
    }on columns,
     NON EMPTY
    {
    filter (
    <%baseRegion%>.children,
    right([Территории__РФ].[Территории__РФ].currentmember.uniquename,10)<>"DATAMEMBER"
    )
    } on rows
from [ЭО_СЭР_МО Ленинградская область]

]]>
  </query>

  <query id="Chart2">
    <![CDATA[
    --SEP_0003 Chart2
    with member [Measures].[Значение1]
    as '
IIF(
[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.name="Ед"
,
[СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Единица измерения")
,
[Measures].[Значение]
)
    '
    member [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Ед]
    as '1'
select
    non empty
    {
    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Ед],
       [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год].members
    }on columns,
    NON EMPTY
    {
    filter (
     <%pokSelect%>,
     not isempty([Measures].[Значение])
     
     )

    } on rows
from [ЭО_СЭР_МО Ленинградская область]
where
    (
      <%baseRegion%>.[<%regionSelect%>]  ,
       [Measures].[Значение1],
        [Источники данных].[Источники данных].[Все источники данных].[ЭО СЭР]
    )
]]>
  </query>  
  
<query id="Chart3">
    <![CDATA[
    --SEP_0003 Chart3
    with
    member [Measures].[v]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")'
    member [Measures].[Отклонение]
    as '[Measures].[Значение] -
        (
            <%baseRegion%>.datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Отклонение по РФ]
    as '[Measures].[Значение] -
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Примечание]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")'
      member [Measures].[Индикатор]
    as ' IIF
        (
            Right
            (
                [Measures].[Примечание],
                1
            )<>"+" ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0  and  [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                  Round(  (
                        [Measures].[Значение]/
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )
                    ),2)
                ,
                null
            )     ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0 and   [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                   Round( (
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )/[Measures].[Значение]
                    ),2)
                ,
                null
            )
        )  '
    member [Measures].[Весовой коэффициент]
    as ' IIF
        (
            Right
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание"),
                1
            )="+",
            Mid
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание") ,
                0,
                Len
                (
                    [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
                ) - 1
            ) ,
            [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
        )    '
     set [Показатели социальной сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="1" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
    set [Показатели экономической сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="2" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
          set [Показатели финансовой сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="3" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы]
    as 'Sum
        (
            [Показатели социальной сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        )'
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы]
    as 'Sum
        (
            [Показатели экономической сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        )'
         member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]
    as 'Sum
        (
            [Показатели финансовой сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        )'
        
   member [Measures].[Значение1]
   as '[Measures].[Индикатор]
       * [Measures].[Весовой коэффициент]'
select
    non empty
    {
       [Measures].[Значение1]
    }on columns,
    NON EMPTY
    {
    <%areaSelect%>
           
    } on rows
from [ЭО_СЭР_МО Ленинградская область]
where
    (
      <%baseRegion%>.[<%regionSelect%>] ,
<%selectedPeriod%>,
 [Источники данных].[Источники данных].[Все источники данных].[ЭО СЭР]
    )
]]>
</query>
<query id="Chart">
    <![CDATA[
    --SEP_0003 Chart1
       with
    member [Measures].[v]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")'
    member [Measures].[Отклонение]
    as '[Measures].[Значение] -
        (
            <%baseRegion%>.datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Отклонение по РФ]
    as '[Measures].[Значение] -
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Примечание]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")'
       member [Measures].[Индикатор]
    as ' IIF
        (
            Right
            (
                [Measures].[Примечание],
                1
            )<>"+" ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0  and  [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                  Round(  (
                        [Measures].[Значение]/
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )
                    ),2)
                ,
                null
            )     ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0 and   [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                   Round( (
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )/[Measures].[Значение]
                    ),2)
                ,
                null
            )
        )  '
    member [Measures].[Весовой коэффициент]
    as ' IIF
        (
            Right
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание"),
                1
            )="+",
            Mid
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание") ,
                0,
                Len
                (
                    [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
                ) - 1
            ) ,
            [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
        )    '
     set [Показатели социальной сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="1" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
    set [Показатели экономической сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="2" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
        set [Показатели финансовой сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="3" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
        member [Measures].[Кол-во пустых показателей в соц]
    as ' Count
        (
            Filter
            (
                [Показатели социальной сферы],
                isempty
                (
                    (
                       [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
         member [Measures].[Кол-во пустых показателей в фин]
    as ' Count
        (
            Filter
            (
                [Показатели финансовой сферы]  ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
    member [Measures].[Кол-во пустых показателей в экон]
    as ' Count
        (
            Filter
            (
                [Показатели экономической сферы]   ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы]
    as '
IIF ([Measures].[Кол-во пустых показателей в соц]<=3,
    Sum
        (
            [Показатели социальной сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),
        null
        )'
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]
    as '
IIF([Measures].[Кол-во пустых показателей в фин]<=3
,
    Sum
        (
            [Показатели финансовой сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),
null)
        '
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы]
    as '
IIF( [Measures].[Кол-во пустых показателей в экон]<=3,
    Sum
        (
            [Показатели экономической сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),null)
        '
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки СЭР МО]
    as '
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы],
            [Measures].[Значение]
        )
        *
        [СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Социальная сфера].properties("Примечание")
        +
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы],
            [Measures].[Значение]
        )
        *[СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Экономическая сфера].properties("Примечание")
        +
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы],
            [Measures].[Значение]
        )
        *[СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Финансовая сфера].properties("Примечание")'

    set [Года]  
    as ' Filter 
        (
            [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год].members ,
            [Measures].[Кол-во пустых показателей в соц]<=3 and
            [Measures].[Кол-во пустых показателей в экон]<=3 and
            [Measures].[Кол-во пустых показателей в фин]<=3
        )   '         
select
    non empty        
    {
    [Года]
    }on columns,
   -- NON EMPTY    
    {
    [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки СЭР МО],
           [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы],
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы],
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]
 
    } on rows    
from [ЭО_СЭР_МО Ленинградская область]        
where        
    (
        <%baseRegion%>.[<%regionSelect%>] ,
        [Measures].[Значение] ,
        [Источники данных].[Источники данных].[Все источники данных].[ЭО СЭР]
    )         
]]>
</query>
  <query id="dynamicText">
    <![CDATA[
    --SEP_0003 dynamicText
         with
    member [Measures].[v]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")'
    member [Measures].[Отклонение]
    as '[Measures].[Значение] -
        (
            <%baseRegion%>.datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Отклонение по РФ]
    as '[Measures].[Значение] -
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].datamember,
            [Measures].[Значение]
        )'
    member [Measures].[Примечание]
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")'
       member [Measures].[Индикатор]
    as ' IIF
        (
            Right
            (
                [Measures].[Примечание],
                1
            )<>"+" ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0  and  [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                  Round(  (
                        [Measures].[Значение]/
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )
                    ),2)
                ,
                null
            )     ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0 and   [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                   Round( (
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )/[Measures].[Значение]
                    ),2)
                ,
                null
            )
        )  '
    member [Measures].[Весовой коэффициент]
    as ' IIF
        (
            Right
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание"),
                1
            )="+",
            Mid
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание") ,
                0,
                Len
                (
                    [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
                ) - 1
            ) ,
            [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")
        )    '
     set [Показатели социальной сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="1" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
    set [Показатели экономической сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="2" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
        set [Показатели финансовой сферы]
    as ' Filter
        (
            Descendants
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF
            ),
            Left
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1
            )="3" and Len([СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код"))=3
        )  '
        member [Measures].[Кол-во пустых показателей в соц]
    as ' Count
        (
            Filter
            (
                [Показатели социальной сферы],
                isempty
                (
                    (
                       [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
         member [Measures].[Кол-во пустых показателей в фин]
    as ' Count
        (
            Filter
            (
                [Показатели финансовой сферы]  ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
    member [Measures].[Кол-во пустых показателей в экон]
    as ' Count
        (
            Filter
            (
                [Показатели экономической сферы]   ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
        member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы]
    as '
IIF ([Measures].[Кол-во пустых показателей в соц]<=3,
   Round( Sum
        (
            [Показатели социальной сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),2),
        null
        )'
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]
    as '
IIF([Measures].[Кол-во пустых показателей в фин]<=3
,
   Round( Sum
        (
            [Показатели финансовой сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),2),
null)
        '
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы]
    as '
IIF( [Measures].[Кол-во пустых показателей в экон]<=3,
   Round( Sum
        (
            [Показатели экономической сферы],
            [Measures].[Индикатор]
            * [Measures].[Весовой коэффициент]
        ),2),null)
        '

    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки СЭР МО]
    as '
    IIF(
            [Measures].[Кол-во пустых показателей в соц]<=3 and
            [Measures].[Кол-во пустых показателей в экон]<=3 and
            [Measures].[Кол-во пустых показателей в фин]<=3
    ,
    Round(    (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы],
            [Measures].[Значение]
        )
        *
        [СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Социальная сфера].properties("Примечание")
        +
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы],
            [Measures].[Значение]
        )
        *[СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Экономическая сфера].properties("Примечание")
        +
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы],
            [Measures].[Значение]
        )
        *[СЭР__Показатели МО].[СЭР__Показатели МО].[Все показатели].[Финансовая сфера].properties("Примечание"),2)
        ,null
        )'
select
    non empty        
    {
      [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[1998]: <%selectedPeriod%>
    }on columns,
   -- NON EMPTY    
    {
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки СЭР МО],
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы],
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы],
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]
    } on rows    
from [ЭО_СЭР_МО Ленинградская область]        
where        
    (
        <%baseRegion%>.[<%regionSelect%>] ,
        [Measures].[Значение] ,
        [Источники данных].[Источники данных].[Все источники данных].[ЭО СЭР]
    )         
]]>
  </query>
<query id="Grid">
    <![CDATA[
--SEP_0003 Grid
with   
    member [Measures].[v]   
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")'   
    member [Measures].[Отклонение]  
    as '[Measures].[Значение] -  
        (
           <%baseRegion%>.datamember,
            [Measures].[Значение] 
        )'  
    member [Measures].[Отклонение по РФ] 
    as '[Measures].[Значение] - 
        (
            [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].datamember,
            [Measures].[Значение] 
        )' 
    member [Measures].[Примечание] 
    as ' [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")' 
        member [Measures].[Индикатор]
    as ' IIF
        (
            Right
            (
                [Measures].[Примечание],
                1
            )<>"+" ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0  and  [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                  Round(  (
                        [Measures].[Значение]/
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )
                    ),2)
                ,
                null
            )     ,
            IIF
            (
                (
                    ParallelPeriod
                    (
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                        1,
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    ),
                    [Measures].[Значение]
                )<>0 and   [Measures].[Значение]<>0 and not isempty([Measures].[Значение]),

                   Round( (
                        (
                            ParallelPeriod
                            (
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год],
                                1,
                                [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                            ),
                            [Measures].[Значение]
                        )/[Measures].[Значение]
                    ),2)
                ,
                null
            )
        )  '
            member [Measures].[Весовой коэффициент] 
    as ' IIF
        (
            Right
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание"),
                1
            )="+",
            [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание"),
            [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Примечание")+"+"  
        )    ' 
        member [Measures].[Код]
        as '[СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код")'
         member [Measures].[Ед]
        as '[СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Единица измерения")'
            set [Показатели социальной сферы]  
    as ' Filter  
        (
            Descendants  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF  
            ),
            Left  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1  
            )="1" and Len 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") 
            )=3  
        )  '  
    set [Показатели экономической сферы]  
    as ' Filter  
        (
            Descendants  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF  
            ),
            Left  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1  
            )="2" and Len 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") 
            )=3  
        )  '  
    set [Показатели финансовой сферы]  
    as ' Filter  
        (
            Descendants  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО],
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР],
                SELF  
            ),
            Left  
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") ,
                1  
            )="3" and Len 
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].CurrentMember.properties("Код") 
            )=3  
        )  '  
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы]  
    as 'Sum  
        (
            [Показатели социальной сферы],
            [Measures].[Индикатор]  
            * [Measures].[Весовой коэффициент]  
        )'  
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы]  
    as 'Sum  
        (
            [Показатели финансовой сферы],
            [Measures].[Индикатор]  
            * [Measures].[Весовой коэффициент]  
        )'  
    member [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы]  
    as 'Sum  
        (
            [Показатели экономической сферы],
            [Measures].[Индикатор]  
            * [Measures].[Весовой коэффициент]  
        )'  
    member [Measures].[Кол-во пустых показателей в соц]
    as ' Count
        (
            Filter
            (
                [Показатели социальной сферы],
                isempty
                (
                    (
                       [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
         member [Measures].[Кол-во пустых показателей в фин]
    as ' Count
        (
            Filter
            (
                [Показатели финансовой сферы]  ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
    member [Measures].[Кол-во пустых показателей в экон]
    as ' Count
        (
            Filter
            (
                [Показатели экономической сферы]   ,
                isempty
                (
                    (
                        [Measures].[Индикатор],
                        [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember
                    )
                )
            )
        ) '
    member [Measures].[Индикатор1]
    as ' IIF
        (
            [Measures].[v]="100" and [Measures].[Кол-во пустых показателей в соц]<=3,
            (
                [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки социальной сферы],
                [Measures].[Значение]
            ),
            IIF
            (
                [Measures].[v]="200" and [Measures].[Кол-во пустых показателей в экон]<=3,
                (
                    [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки экономической сферы],
                    [Measures].[Значение]
                ),
                IIF
                (
                    [Measures].[v]="300" and [Measures].[Кол-во пустых показателей в фин]<=3,
                    (
                        [СЭР__Показатели МО].[СЭР__Показатели МО].[Интегральный показатель оценки финансовой сферы],
                        [Measures].[Значение]
                    ),
                    [Measures].[Индикатор]
                )
            )
        )  '
select
    non empty  
    {
        [Measures].[Значение],
    --    [Measures].[Отклонение],
    --    [Measures].[Отклонение по РФ] ,
        [Measures].[Индикатор1],
        [Measures].[v],
         [Measures].[Весовой коэффициент],
         [Measures].[Ед]
        
    }on columns,
   -- NON EMPTY   
    {
          filter
        (
            [СЭР__Показатели МО].[СЭР__Показатели МО].[Показатель СЭР].members,

            (not isempty([Measures].[Значение])
            or [Measures].[v]="100" 
            or [Measures].[v]="200" 
            or [Measures].[v]="300" 
            
            )
            and Len([Measures].[v])=3
        )
    } on rows 
from [ЭО_СЭР_МО Ленинградская область]   
where   
    (
        <%baseRegion%>.[<%regionSelect%>] ,
        <%selectedPeriod%> ,
         [Источники данных].[Источники данных].[Все источники данных].[ЭО СЭР]
    )    
]]>
</query>
    
</root>
