<?xml version="1.0" encoding="Windows-1251"?>
<root>

    <query id="RG_0017_0005_last_period">
        <![CDATA[
-- RG_0017_0005_last_period
with 
    member [Measures].[ДанныеНа] 
    as 'tail 
        (
            filter 
            (
                descendants 
                (
                    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Данные всех периодов],
                    [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Месяц],
                    SELF 
                ),
                not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс доверия политикам],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Электоральные предпочтения],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс доверия институтам власти],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс восприятия уровня распространенности коррупции],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс доверия главам],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс доверия Думе],
                        [Measures].[Значение]
                    ) 
                ) and not isEmpty
                (
                    (
                        [СоцОпрос__Показатели].[СоцОпрос__Показатели].[Все показатели].[Индекс доверия председателю Думы],
                        [Measures].[Значение]
                    ) 
                ) 
            ),
            1 
        ).item(0).uniqueName'
select
    { [Measures].[ДанныеНа] } on columns 
from  [РЕГИОН_Данные опросов] 
where 
    (
        [Источники данных].[Источники данных].[Все источники данных].[РЕГИОН СоцОпросы],
        <%param_territory%>.DATAMEMBER        
    )  
    ]]>
    </query>
  
    <query id="RG_0017_0005_government">
        <![CDATA[
-- RG_0017_0005_government
with
    member [Measures].[Максимум общий]
    as '2 * max( [Measures].[Максимум <%param_negative%>], [Measures].[Максимум <%param_positive%>] )'
    member [Measures].[Максимум <%param_negative%>]
    as 'max
        (
            [Территории],
            [Measures].[<%param_negative%>]
        )'
    member [Measures].[Максимум <%param_positive%>]
    as 'max
        (
            [Территории],
            [Measures].[<%param_positive%>]
        )'
    
    member [Measures].[<%param_negative%>]
    as '
        (            
            [СоцОпрос__Варианты ответов].[СоцОпрос__Варианты ответов].[Все варианты].[<%param_negative%>],
            [Measures].[Значение]
        )'
    member [Measures].[<%param_positive%>]
    as '
        (            
            [СоцОпрос__Варианты ответов].[СоцОпрос__Варианты ответов].[Все варианты].[<%param_positive%>],
            [Measures].[Значение]
        )'
    member [Measures].[Индекс]
    as '
        (
            [СоцОпрос__Варианты ответов].[СоцОпрос__Варианты ответов].[Все варианты].[Индекс],
            [Measures].[Значение]
        )'
    member [Measures].[Затрудняюсь ответить]
    as '
        (
            [СоцОпрос__Варианты ответов].[СоцОпрос__Варианты ответов].[Все варианты].[Затрудняюсь ответить],
            [Measures].[Значение]
        )'
    set [Территории]
    as 'descendants
        (
            <%param_territory%>,
            [Территории__РФ].[Территории__РФ].[МР ГО],
            SELF
        )'
select
    {
        [Measures].[Максимум общий],
        [Measures].[Индекс],
        [Measures].[<%param_positive%>],
        [Measures].[<%param_negative%>],
        [Measures].[Затрудняюсь ответить]
    } on columns,
    { [Территории] } on rows
from  [РЕГИОН_Данные опросов]
where
    (
        <%param_period%>,
        <%param_mark%>,
        [Источники данных].[Источники данных].[Все источники данных].[РЕГИОН СоцОпросы]
    )
    ]]>
    </query>  
    
</root>
