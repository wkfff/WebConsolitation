<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="EO_0001_0003_lastDate">
    <![CDATA[ 
-- EO_0001_0003_lastDate
with
    member [Measures].[ДанныеНа] 
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName' 
    set [NonEmptySet] 
    as 'Tail 
        (
            Filter 
            (
                [Период__Период].[Период__Период].[Месяц].AllMembers,
                not IsEmpty( Measures.[Отчет] ) and Str
                (
                    [Период__Период].[Период__Период].CurrentMember.Properties("MEMBER_KEY")
                ) > 0 
            ),
            1 
        )' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from [ЭО_Мониторинг строительства_Объекты строительства]      
    ]]>
  </query>

  <query id="EO_0001_0003_addGrid">
    <![CDATA[ 
-- EO_0001_0003_addGrid
with       
    set [Заказчики]       
    as '[Строительство__Заказчики].[Строительство__Заказчики].[Все заказчики].Children'        
    set [Контракты]    
    as '[Строительство__Характеристика объектов].[Строительство__Характеристика объектов].[Все контракты].Children'    

   member [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет субъкта]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем незавершенного строительства в текущих ценах на 01.01.11 г.].[в том числе за счёт средств:].[окружного бюджета],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Освоено капитальных вложений в текущих ценах за отчетный период текущего года].[в том числе за счёт средств:].[окружного бюджета]  
            }  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет МО]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем незавершенного строительства в текущих ценах на 01.01.11 г.].[в том числе за счёт средств:].[бюджетов муниципальных образований],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Освоено капитальных вложений в текущих ценах за отчетный период текущего года].[в том числе за счёт средств:].[местного бюджета]  
            }  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Освоено прочие]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем незавершенного строительства в текущих ценах на 01.01.11 г.].[в том числе за счёт средств:].[прочих источников],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Освоено капитальных вложений в текущих ценах за отчетный период текущего года].[в том числе за счёт средств:].[прочих источников]  
            }  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем финансирования с начала строительства на 01.01.11 года].[в том числе за счёт средств].[окружного бюджета],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Финансирование за отчётный период текущего года].[в том числе за счёт средств].[всего окружной бюджет]  
            }  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем финансирования с начала строительства на 01.01.11 года].[в том числе за счёт средств].[бюджетов муниципальных образований],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Финансирование за отчётный период текущего года].[в том числе за счёт средств].[бюджетов муниципальных образований]  
            }  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие]  
    as 'Aggregate  
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем финансирования с начала строительства на 01.01.11 года].[в том числе за счёт средств].[прочих источников],
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Финансирование за отчётный период текущего года].[в том числе за счёт средств].[прочих источников]  
            }  
        )'   
    member [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность бюджет субъкта]
    as 'IIF
        (
           IsEmpty([Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта]),
           null,
           [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта] - [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет субъкта] 
        ) '     
    member [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность бюджет МО]
    as 'IIF
        (
           IsEmpty([Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО]),
           null,
           [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО] - [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет МО] 
        ) '    
    member [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность прочие]
    as 'IIF
        (
           IsEmpty([Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие]),
           null,
           [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие] - [Строительство__Ход работ].[Строительство__Ход работ].[Освоено прочие] 
        ) '            
    member [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта]  
    as 'IIF  
        (
            IsEmpty  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта]  
                )  
            ) or  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта]  
                )  
            ) = 0,
            null,
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет субъкта]  
            )/  
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта]  
            )  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО]  
    as 'IIF  
        (
            IsEmpty  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО]  
                )  
            ) or  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО]  
                )  
            ) = 0,
            null,
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет МО]  
            )/  
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО]  
            )  
        )'  
    member [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие]  
    as 'IIF  
        (
            IsEmpty  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие]  
                )  
            ) or  
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие]  
                )  
            ) = 0,
            null,
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено прочие]  
            )/  
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие]  
            )  
        )'      
    member [Строительство__Ход работ].[Строительство__Ход работ].[Начало строительства]    
    as '[Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Сроки строительства].[Начало]'    
    member [Строительство__Ход работ].[Строительство__Ход работ].[Заказчик]     
    as '[Строительство__Заказчики].[Строительство__Заказчики].CurrentMember.Name'       
    member [Строительство__Ход работ].[Строительство__Ход работ].[Объект]     
    as '[Строительство__Характеристика объектов].[Строительство__Характеристика объектов].CurrentMember.Name'    
    member [Строительство__Ход работ].[Строительство__Ход работ].[Ранг контракта]    
    as 'Rank
        (
            [Строительство__Характеристика объектов].[Строительство__Характеристика объектов].CurrentMember,
            Filter
            (
                [Контракты],
                (
                    not IsEmpty 
                    (
                        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта] 
                    ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта] < 0.5 
                ) or 
                (
                    not IsEmpty 
                    (
                        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО] 
                    ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО] < 0.5 
                ) or 
                (
                    not IsEmpty 
                    (
                        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие] 
                    ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие] < 0.5 
                ) 
            )    
        ) - 1'
        
    member [Строительство__Ход работ].[Строительство__Ход работ].[Код объекта]    
    as '[Строительство__Характеристика объектов].[Строительство__Характеристика объектов].CurrentMember.Properties("Код")'
select
    {
        [Строительство__Ход работ].[Строительство__Ход работ].[Заказчик],
        [Строительство__Ход работ].[Строительство__Ход работ].[Объект],
        [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет субъкта],
        [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет субъкта],
        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта],
        [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность бюджет субъкта],
        [Строительство__Ход работ].[Строительство__Ход работ].[Освоено бюджет МО],
        [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование бюджет МО],
        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО],
        [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность бюджет МО],
        [Строительство__Ход работ].[Строительство__Ход работ].[Освоено прочие],
        [Строительство__Ход работ].[Строительство__Ход работ].[Финансирование прочие],
        [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие],
        [Строительство__Ход работ].[Строительство__Ход работ].[Дебиторская задолженность прочие],
        [Строительство__Ход работ].[Строительство__Ход работ].[Начало строительства],
        [Строительство__Ход работ].[Строительство__Ход работ].[Ранг контракта],
        [Строительство__Ход работ].[Строительство__Ход работ].[Код объекта] 
    } on columns,
    Filter    
    (
        [Заказчики]    
        * [Контракты],
        (
            not IsEmpty 
            (
                [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта] 
            ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет субъкта] < 0.5 
        ) or 
        (
            not IsEmpty 
            (
                [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО] 
            ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения бюджет МО] < 0.5 
        ) or 
        (
            not IsEmpty 
            (
                [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие] 
            ) and [Строительство__Ход работ].[Строительство__Ход работ].[Процент освоения прочие] < 0.5 
        ) 
    ) on rows     
from [ЭО_Мониторинг строительства_Объекты строительства]       
where       
    (
        <%current_period%>,
        [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ямало-Ненецкий автономный округ]       
    )            
    ]]>
  </query>  
</root>