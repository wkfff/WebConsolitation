<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FNS_0001_0005_date">
    <![CDATA[
-- FNS_0001_0005_date

with      
    member Measures.[ДанныеНа]      
    as '<%period_dimension%>.CurrentMember.UniqueName'      
select
    {Measures.[ДанныеНа]} on columns,
    Tail      
    (
        NonEmptyCrossjoin
        (
            OpeningPeriod    
            (
                <%period_dimension%>.[Месяц],
                <%period_dimension%>.[Данные всех периодов].[2008]
            ) : ClosingPeriod    
            (
                <%period_dimension%>.[Месяц],
                <%period_dimension%>.[Данные всех периодов].[2011]
            )
        )
    ) on rows  
from [ФНС_28н_с расщеплением]
  ]]>
</query>
  
    
  <query id="FNS_0001_0005_grid1">
    <![CDATA[
-- FNS_0001_0005_grid
       with

    member Measures.[Код]
    as '[Районы].[Сопоставимый].CurrentMember.Properties("Код")'
    member Measures.[Уровень]
    as '[Районы].[Сопоставимый].CurrentMember.Level.Name'
    member Measures.[Наименование]
    as '[Районы].[Сопоставимый].CurrentMember.Name'
    member [Районы].[Сопоставимый].[Местные бюджеты ]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'
	 member [Районы].[Сопоставимый].[Городские округа ] 
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область].[Города областного подчинения Вологодской области]' 
	member [Районы].[Сопоставимый].[Всего по районам ]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область].[Районы Вологодской области]'
    set [Города и районы]            
    as 'Generate            
        (
            Filter            
            (
                Descendants            
                (
                    [Районы].[Сопоставимый].[Все районы].[Вологодская область],
                    [Районы].[Сопоставимый].[Уровень 04],
                    SELF            
                ),
                (
                    (
                        [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"            
                    )            
                )            
            ),
            {
                [Районы].[Сопоставимый].CurrentMember            
            }            
        )'            
    set [Районы с поселениями]            
    as 'Generate            
        (
            [Города и районы],
            {
                [Районы].[Сопоставимый].CurrentMember            
            } +          

                Descendants            
                (
                    [Районы].[Сопоставимый].CurrentMember,
                    [Районы].[Сопоставимый].[Уровень 05],
                    SELF            
                )          

        )'         
    set [Города]   
    as 'Filter  
        (
            Descendants   
            (
                [Районы].[Сопоставимый].[Все районы].[Вологодская область].[Города областного подчинения Вологодской области],
                [Районы].[Сопоставимый].[Все районы].[Вологодская область].[Города областного подчинения Вологодской области].Level,
                after   
            ) ,
            not  
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) 
        )' 
     
    MEMBER Measures.[Всего налоговых и неналоговых доходов, тыс. руб.] as'
        (
            [Measures].[С начала года],
            [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ]
        )'
		
    member Measures.[Удельный вес доходов в целом по области, тыс. руб.]        
    as 'IIF        
            (
                IsEmpty        
                (
                    (
                        [Measures].[С начала года],
                        [Районы].[Сопоставимый].[Все районы].[Вологодская область] 				       
                    )        
                ),
                null,
                (
                    [Measures].[С начала года],
                    [Районы].[Сопоставимый].CurrentMember        
                )/        
                (
                    [Measures].[С начала года],
                    [Районы].[Сопоставимый].[Все районы].[Вологодская область]        
                )        
          )'        
    member Measures.[Удельный вес доходов по поселениям в отдельном МР]        
    as 'IIF        
        (
                    
            (
                (
                   [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты ]
                )
				or        
                (
                   [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Всего по районам ]
                ) 
				or
				(
				 [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ] 
				)
            ),
            null,
            IIF
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" and  not [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.DataMember ,
                (
                    (
                        [Measures].[С начала года],
                        [Районы].[Сопоставимый].CurrentMember        
                    )/        
                    (
                        [Measures].[С начала года],
                        [Районы].[Сопоставимый].CurrentMember        
                    )        
                ),
                IIF        
                (
                    IsEmpty        
                    (
                        (
                            [Measures].[С начала года],
                            [Районы].[Сопоставимый].CurrentMember.Parent        
                        )        
                    ) ,
                    null,
                    (
                        [Measures].[С начала года],
                        [Районы].[Сопоставимый].CurrentMember        
                    )/        
                    (
                        [Measures].[С начала года],
                        [Районы].[Сопоставимый].CurrentMember.Parent        
                    )        
                )        
            )        
        )'       
    member Measures.[Численность постоянного населения по МО]
    as 'IIF
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты ],
            Sum
            (
                [Города и районы],
                Measures.[Численность постоянного населения по МО]
            ),
			 IIF
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Всего по районам ],
            Sum
            (
                [Районы с поселениями],
                Measures.[Численность постоянного населения по МО]
            ),
			 IIF
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ] ,
            Sum
            (
                [Города],
                Measures.[Численность постоянного населения по МО]
            ),
            IIF
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 05],
                LookupCube
                (
                    "[ФО_Показатели для планирования]",
                    "
                    (
                        [Measures].[Факт],
                        [Показатели].[Показатели для планирования Сопост].[Все показатели].[Данные по численности населения].[Численность населения поселений],
                        " + MemberToStr
                        (
                            [Районы].[Сопоставимый].CurrentMember
                        ) + ",
                        " + MemberToStr
                        (
                            [Период].[Период].CurrentMember
                        ) + "
                    ) "
                ),
                LookupCube
                (
                    "[ФО_Показатели для планирования]",
                    "
                    (
                        [Measures].[Факт],
                        [Показатели].[Показатели для планирования Сопост].[Все показатели].[Данные по численности населения].[Численность постоянного населения МР(ГО)],
                        " + MemberToStr
                        (
                            [Районы].[Сопоставимый].CurrentMember
                        ) + ",
                        " + MemberToStr
                        (
                            [Период].[Период].CurrentMember
                        ) + "
                    )"
                )
            )
			)
			)
        )'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            not IsEmpty
            (
                (
                    Measures.[Численность постоянного населения по МО],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>]
                )
            ),
            (
                Measures.[Численность постоянного населения по МО],
                [Период].[Период].[Данные всех периодов].[<%period_year%>]
            ),
            (
                Tail
                (
                    Filter
                    (
                        {
                            [Период].[Период].[Данные всех периодов].[2000] : [Период].[Период].[Данные всех периодов].[<%period_year%>].PrevMember
                        },
                        not IsEmpty
                        (
                            Measures.[Численность постоянного населения по МО]
                        )
                    )
                ).Item(0),
                Measures.[Численность постоянного населения по МО]
            )
        )'
    member Measures.[Удельный вес населения в отдельном МР]
    as 'IIF
        (
             not
            (
                (
                    [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 05]           
                )
                or
                (
                    [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 04] and
                     [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
                )
            ),
            null,
            (
                Measures.[Численность постоянного населения],
                [Районы].[Сопоставимый].CurrentMember
            )/
            (
                Measures.[Численность постоянного населения],
                [Районы].[Сопоставимый].CurrentMember.Parent
            )
        )'
    member Measures.[Среднедушевые доходы,  руб./чел.]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения]
            ),
            null,
            Measures.[Всего налоговых и неналоговых доходов, тыс. руб.] / Measures.[Численность постоянного населения]
        )'
    member Measures.[Ранг поселения_Среднедушевые расходы]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Среднедушевые доходы,  руб./чел.]
            ) or not
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 05]
            ),
            null,
            Rank
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order
                (
                    [Районы].[Сопоставимый].Members,
                    Measures.[Среднедушевые доходы,  руб./чел.],
                    BDESC
                ),
                Measures.[Среднедушевые доходы,  руб./чел.]
            )
        )'

   member Measures.[Худший ранг поселения_Среднедушевые расходы]   
    as 'Max          
        (
            [Районы].[Сопоставимый].Members,
            Measures.[Ранг поселения_Среднедушевые расходы]          
        )'   
    member Measures.[Лудший ранг поселения_Удельный вес доходов в целом по области]
    as 'Min
        (
            [Районы].[Сопоставимый].Members,
           ( Measures.[Удельный вес доходов в целом по области, тыс. руб.])
        )'
    member Measures.[Худший ранг поселения_Удельный вес доходов в целом по области]   
    as 'Max   
        (
            [Районы].[Сопоставимый].Members,
            Measures.[Удельный вес доходов в целом по области, тыс. руб.]   
        )'     

     member Measures.[Лудший ранг поселения_Удельный вес населения в отдельном МР]
    as 'Min
        (
            [Районы].[Сопоставимый].CurrentMember.Parent.Children,
            Measures.[Удельный вес доходов по поселениям в отдельном МР]
        )'
   
    member Measures.[Худший ранг поселения_Удельный вес населения в отдельном МР]
    as 'Max 
        (
            [Районы].[Сопоставимый].CurrentMember.Parent.Children,
            Measures.[Удельный вес доходов по поселениям в отдельном МР]
        )' 

    member Measures.[Ранг поселения_Темп роста]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Темп роста к аналогичному периоду предыдущего года_С начала года]
            ) or not
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 05]
            ),
            null,
            Rank
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order
                (
                    [Районы].[Сопоставимый].Members,
                    [Measures].[Темп роста к аналогичному периоду предыдущего года_С начала года],
                    BDESC
                ),
                [Measures].[Темп роста к аналогичному периоду предыдущего года_С начала года]
            )
        )'
  MEMBER  [КД].[Сопоставимый].[Все коды доходов].[Акцизы]
   AS ' Aggregate
        (
            {
                {
                   [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ТОВАРЫ, ВВОЗИМЫЕ НА ТЕРРИТОРИЮ РОССИЙСКОЙ ФЕДЕРАЦИИ].[Акцизы по подакцизным товарам (продукции), ввозимым на территорию Российской Федерации]
                },
                {
                   [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ТОВАРЫ (РАБОТЫ, УСЛУГИ), РЕАЛИЗУЕМЫЕ НА ТЕРРИТОРИИ РОССИЙСКОЙ ФЕДЕРАЦИИ].[Акцизы по подакцизным товарам (продукции), производимым на территории Российской Федерации]
                }
            }
        )'


    member [КД].[Сопоставимый].[Неналоговые доходы]      
    as 'Aggregate    
        (
            {
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[ШТРАФЫ, САНКЦИИ, ВОЗМЕЩЕНИЕ УЩЕРБА],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[ПЛАТЕЖИ ПРИ ПОЛЬЗОВАНИИ ПРИРОДНЫМИ РЕСУРСАМИ].[Платежи при пользовании недрами]     
            }     
        )'     
    member [КД].[Сопоставимый].[Налоговые доходы]  
    as 'Aggregate     
        (
            {
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ПРИБЫЛЬ, ДОХОДЫ],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[СТРАХОВЫЕ ВЗНОСЫ НА ОБЯЗАТЕЛЬНОЕ СОЦИАЛЬНОЕ СТРАХОВАНИЕ],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ТОВАРЫ (РАБОТЫ, УСЛУГИ), РЕАЛИЗУЕМЫЕ НА ТЕРРИТОРИИ РОССИЙСКОЙ ФЕДЕРАЦИИ],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ТОВАРЫ, ВВОЗИМЫЕ НА ТЕРРИТОРИЮ РОССИЙСКОЙ ФЕДЕРАЦИИ],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА СОВОКУПНЫЙ ДОХОД],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ИМУЩЕСТВО],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ, СБОРЫ И РЕГУЛЯРНЫЕ ПЛАТЕЖИ ЗА ПОЛЬЗОВАНИЕ ПРИРОДНЫМИ РЕСУРСАМИ],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[ГОСУДАРСТВЕННАЯ ПОШЛИНА],
                [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[ЗАДОЛЖЕННОСТЬ И ПЕРЕРАСЧЕТЫ ПО ОТМЕНЕННЫМ НАЛОГАМ, СБОРАМ И ИНЫМ ОБЯЗАТЕЛЬНЫМ ПЛАТЕЖАМ]      
            }     
        )'   
		
    member [КД].[Сопоставимый].[Всего налоговых и неналоговых доходов]      
    as 'Aggregate 
        (
            {
                [КД].[Сопоставимый].[Неналоговые доходы],
                [КД].[Сопоставимый].[Налоговые доходы]  
            }  
        )'   
  	
    member Measures.[Всего налоговых и неналоговых доходов, Темп роста]  
    as '  
        (
            [Measures].[Темп роста к аналогичному периоду предыдущего года_С начала года]  
        )'  
		
    member Measures.[Всего налоговых и неналоговых доходов, Ранг]  
    as ' IIF  
        (
            IsEmpty  
            (
                Measures.[Всего налоговых и неналоговых доходов, Темп роста]  
            ) or not  
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Уровень 05]  
            ),
            null,
            Rank  
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order  
                (
                    [Районы].[Сопоставимый].Members,
                    Measures.[Всего налоговых и неналоговых доходов, Темп роста],
                    BDESC  
                ),
                Measures.[Всего налоговых и неналоговых доходов, Темп роста]  
            )  
        )' 
		
    member [Measures].[С начала года ]
    as '( [Measures].[С начала года] / 1000 )'		
      
select
    {
        {
			{
				[КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ПРИБЫЛЬ, ДОХОДЫ]
			}
			*
			{
				Measures.[Код],
				Measures.[Наименование]  
			}
        } + 
           {
		     {<%selected_Debit%>}
			 *
			 {
			    [Measures].[С начала года ],
				[Measures].[Темп роста к аналогичному периоду предыдущего года_С начала года],
				Measures.[Ранг поселения_Темп роста],
				Measures.[Удельный вес доходов в целом по области, тыс. руб.],
				Measures.[Удельный вес доходов по поселениям в отдельном МР]
			} 
		  }	 
          +
       {
			{
				[КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ПРИБЫЛЬ, ДОХОДЫ]
			}
			*
			{
				
				Measures.[Численность постоянного населения],
				Measures.[Удельный вес населения в отдельном МР],
				Measures.[Среднедушевые доходы,  руб./чел.],
				Measures.[Ранг поселения_Среднедушевые расходы],
		        Measures.[Худший ранг поселения_Среднедушевые расходы],
				Measures.[Уровень]  
			}
        }  
    } on columns,
   Filter           
    (
        {
            [Районы].[Сопоставимый].[Местные бюджеты ]
        } +
		{[Районы].[Сопоставимый].[Всего по районам ]}
		+{[Районы с поселениями] } + 
        {
            [Районы].[Сопоставимый].[Городские округа ]
        } + { [Города] } ,
        not IsEmpty([Measures].[С начала года])           
    ) on rows   
FROM [ФНС_28н_с расщеплением]  
WHERE  
    (
         [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
         <%level_budget%>,
        [ФНС_65н_Показатели].[Все].[Поступило - всего] 
    )    
    ]]>
</query>
  
  <query id="FNS_0001_0005_grid">
    <![CDATA[
-- FNS_0001_0005_grid
  
with    
    member Measures.[Код]    
    as '[Районы].[Сопоставимый].CurrentMember.Properties("Код")'    
    member Measures.[Уровень]    
    as '[Районы].[Сопоставимый].CurrentMember.Level.Name'   
    member Measures.[Наименование]    
    as '[Районы].[Сопоставимый].CurrentMember.Name'        
    member Measures.[Налог на доходы физических лиц, тыс.руб.]    
    as '    
        (
            [Measures].[С начала года],
            [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ПРИБЫЛЬ, ДОХОДЫ].[Налог на доходы физических лиц]    
        ) / 1000'    
    member Measures.[Налог на имущество физических лиц, тыс.руб.]    
    as '    
        (
            [Measures].[С начала года],
            [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ИМУЩЕСТВО].[Налог на имущество физических лиц]  
        ) / 1000'    
    member Measures.[Земельный налог, тыс.руб.]    
    as '    
        (
            [Measures].[С начала года],
            [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА ИМУЩЕСТВО].[Земельный налог]  
        ) / 1000'    
    member Measures.[Единый сельскохозяйственный налог, тыс.руб.]    
    as '    
        (
            [Measures].[С начала года],
            [КД].[Сопоставимый].[Все коды доходов].[Всего доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ].[НАЛОГИ НА СОВОКУПНЫЙ ДОХОД].[Единый сельскохозяйственный налог]
        ) / 1000'            
   
    member Measures.[Итого по налоговым доходам, подлежащим зачислению в бюджеты поселений, тыс.руб.]    
    as 'Measures.[Налог на доходы физических лиц, тыс.руб.] + Measures.[Налог на имущество физических лиц, тыс.руб.] + Measures.[Земельный налог, тыс.руб.] + Measures.[Единый сельскохозяйственный налог, тыс.руб.]'    
    member Measures.[Удельный вес доходов в итоге по поселениям]    
    as 'IIF    
        (
            not    
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Районы уровень 05]   
            ),
            null,
            (
                Measures.[Итого по налоговым доходам, подлежащим зачислению в бюджеты поселений, тыс.руб.],
                [Районы].[Сопоставимый].CurrentMember    
            )/    
            (
                Measures.[Итого по налоговым доходам, подлежащим зачислению в бюджеты поселений, тыс.руб.],
                [Районы].[Сопоставимый].CurrentMember.Parent    
            )    
        )'    
    member Measures.[Численность постоянного населения по МО]    
    as 'IIF   
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы ],
            Sum
            (
                [Города и районы],
                Measures.[Численность постоянного населения по МО]
            ),
            IIF
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Районы уровень 05],
                LookupCube    
                (
                    "[ФО_Показатели для планирования]",
                    "    
                    (
                        [Measures].[Факт],
                        [Показатели].[Показатели для планирования Сопост].[Все показатели].[Данные по численности населения].[Численность населения поселений],
                        " + MemberToStr    
                        (
                            [Районы].[Сопоставимый].CurrentMember    
                        ) + ",
                        " + MemberToStr    
                        (
                            [Период].[Период].CurrentMember    
                        ) + "    
                    ) "    
                ),
                LookupCube    
                (
                    "[ФО_Показатели для планирования]",
                    "    
                    (
                        [Measures].[Факт],
                        [Показатели].[Показатели для планирования Сопост].[Все показатели].[Данные по численности населения].[Численность постоянного населения МР(ГО)],
                        " + MemberToStr    
                        (
                            [Районы].[Сопоставимый].CurrentMember    
                        ) + ",
                        " + MemberToStr    
                        (
                            [Период].[Период].CurrentMember    
                        ) + "    
                    )"    
                )   
            ) 
        )' 
    member Measures.[Численность постоянного населения]    
    as 'IIF    
        (
            not IsEmpty    
            (
                (
                    Measures.[Численность постоянного населения по МО],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>]    
                )    
            ),
            (
                Measures.[Численность постоянного населения по МО],
                [Период].[Период].[Данные всех периодов].[<%period_year%>]    
            ),
            (
                Tail    
                (
                    Filter    
                    (
                        {
                            [Период].[Период].[Данные всех периодов].[2000] : [Период].[Период].[Данные всех периодов].[<%period_year%>].PrevMember    
                        },
                        not IsEmpty    
                        (
                            Measures.[Численность постоянного населения по МО]    
                        )    
                    )    
                ).Item(0),
                Measures.[Численность постоянного населения по МО]    
            )    
        )'    
    member Measures.[Удельный вес населения в итоге по поселениям]    
    as 'IIF    
        (
            not   
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Районы уровень 05]   
            ),
            null,
            (
                Measures.[Численность постоянного населения],
                [Районы].[Сопоставимый].CurrentMember    
            )/    
            (
                Measures.[Численность постоянного населения],
                [Районы].[Сопоставимый].CurrentMember.Parent    
            )    
        )'    
    member Measures.[Среднедушевые доходы,  руб./чел.]    
    as 'IIF    
        (
            IsEmpty    
            (
                Measures.[Численность постоянного населения]  
            ),
            null,
            1000 * Measures.[Итого по налоговым доходам, подлежащим зачислению в бюджеты поселений, тыс.руб.] / Measures.[Численность постоянного населения]  
        )'    
    member Measures.[Ранг поселения]  
    as 'IIF  
        (
            IsEmpty  
            (
                Measures.[Среднедушевые доходы,  руб./чел.]  
            ) or not  
            (
                [Районы].[Сопоставимый].CurrentMember.Level is [Районы].[Сопоставимый].[Районы уровень 05]  
            ),
            null,
            Rank  
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order  
                (
                    [Районы].[Сопоставимый].CurrentMember.Parent.Children,
                    Measures.[Среднедушевые доходы,  руб./чел.],
                    BDESC  
                ),
                Measures.[Среднедушевые доходы,  руб./чел.]  
            )  
        )'  
    member Measures.[Худший ранг поселения]  
    as 'Max
        (
            [Районы].[Сопоставимый].CurrentMember.Parent.Children,
            Measures.[Ранг поселения]
        )'         
    member [Районы].[Сопоставимый].[Все районы ] 
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]' 
    set [Города и районы]
    as 'Generate
        (
            Filter
            (
                Descendants
                (
                    [Районы].[Сопоставимый].[Все районы].[Вологодская область],
                    [Районы].[Сопоставимый].[Районы уровень 04],
                    SELF
                ),
                not
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
                ) and
                (
                    (
                        [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
                    )
                )
            ),
            {
                [Районы].[Сопоставимый].CurrentMember
            }
        )'
    set [Районы с поселениями] 
    as 'Generate   
        (
            [Города и районы],
            {
                [Районы].[Сопоставимый].CurrentMember  
            } + Filter  
            (
                Descendants   
                (
                    [Районы].[Сопоставимый].CurrentMember,
                    [Районы].[Сопоставимый].[Районы уровень 05],
                    SELF   
                ),
                not   
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember   
                ) and   
                (
                    [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП"   
                )   
            )   
        )'  
   MEMBER  [ФНС_65н_Показатели].[Все].[Показатели]
    AS ' Aggregate
        (
            {
                {
                  [ФНС_65н_Показатели].[Все].[Поступило - всего]
                },

                {
                 [ФНС_65н_Показатели].[Все].[Недоимка по налогу]
               }
            }
        )' 
select
    {
        Measures.[Код],
        Measures.[Наименование],
        Measures.[Налог на доходы физических лиц, тыс.руб.],
        Measures.[Налог на имущество физических лиц, тыс.руб.],
        Measures.[Земельный налог, тыс.руб.],
        Measures.[Единый сельскохозяйственный налог, тыс.руб.],
        Measures.[Итого по налоговым доходам, подлежащим зачислению в бюджеты поселений, тыс.руб.],
        Measures.[Удельный вес доходов в итоге по поселениям],
        Measures.[Численность постоянного населения],
        Measures.[Удельный вес населения в итоге по поселениям],
        Measures.[Среднедушевые доходы,  руб./чел.],
        Measures.[Ранг поселения],
        Measures.[Худший ранг поселения],
        Measures.[Уровень]  
    } on columns,
    Filter 
    (
        {
            [Районы].[Сопоставимый].[Местные бюджеты ]
        } + [Районы с поселениями]
        ,
        not IsEmpty([Measures].[С начала года]) 
    ) on rows  
FROM [ФНС_28н_с расщеплением]    
WHERE    
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        <%level_budget%>,
        [ФНС_65н_Показатели].[Все].[Показатели] 
    )    
	]]>
</query>
 
</root>