<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0002_0003_HMAO_date">
    <![CDATA[
-- FO_0002_0003_HMAO_date
ith
    member [Measures].[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                <%period_dimension%>.Members,
                not IsEmpty([Measures].[Факт]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from  [ФО_МесОтч_Доходы]
  ]]>
  </query>

  <query id="FO_0002_0003_HMAO_grid">
    <![CDATA[
-- FO_0002_0003_HMAO_detail_grid
with 
    member <%incomes_kd_dimension%>.[Доходы итого] 
    as '<%incomes_total%>' 
    member Measures.[Темп роста] 
    as '[Measures].[Темп роста к аналогичному периоду предыдущего года_Факт]' 
    member Measures.[Доля] 
    as ' 
        (
            <%incomes_kd_dimension%>.CurrentMember,
            [Measures].[Факт] 
        )/ 
        (
            <%incomes_kd_dimension%>.[Доходы итого],
            [Measures].[Факт] 
        )' 
    member Measures.[Доля прошлый год] 
    as ' 
        (
            <%incomes_kd_dimension%>.CurrentMember,
            [Measures].[Факт_прошлый год] 
        )/ 
        (
            <%incomes_kd_dimension%>.[Доходы итого],
            [Measures].[Факт_прошлый год] 
        )' 
    member Measures.[Исполнено млн] 
    as 'Measures.[Факт] / <%rub_multiplier%>' 
    
    member Measures.[Исполнено прошлый год млн] 
    as 'Measures.[Факт_прошлый год] / <%rub_multiplier%>' 
    
    member Measures.[Назначено млн] 
    as '(Measures.[Годовые назначения], <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>]) / <%rub_multiplier%>' 
    
    member Measures.[Назначено прошлый год млн] 
    as '(Measures.[Годовые назначения], <%period_dimension%>.[Данные всех периодов].[<%period_last_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>]) / <%rub_multiplier%>' 
    
    member Measures.[Процент выполнения прошлый год] 
    as 'IIF 
        (
            IsEmpty 
            (
                Measures.[Назначено прошлый год млн] 
            ) or Measures.[Назначено прошлый год млн] = 0,
            null,
            Measures.[Исполнено прошлый год млн] / Measures.[Назначено прошлый год млн]
        )' 
    member Measures.[Уровень] 
    as '<%incomes_kd_dimension%>.CurrentMember.Level.Name' 
    member Measures.[Код]
    as '<%incomes_kd_dimension%>.CurrentMember.Properties("Код")'
    
    member Measures.[% выполнения годовых назначений прошлый год]    
    as '(<%period_dimension%>.[Данные всех периодов].[<%period_last_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
         Measures.[% выполнения годовых назначений])
    '  
    
    member  <%region_dimension%>.[Консолидированный бюджет субъекта ]
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)' 
    
    member <%region_dimension%>.[<%own_subject_budget_name%>]
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)' 
    
    member <%region_dimension%>.[Местные бюджеты]
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)'    
        
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ]
    as 'IIF
        (
            <%region_dimension%>.CurrentMember is  <%region_dimension%>.[Консолидированный бюджет субъекта ],
            [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
            IIF
            (
               <%region_dimension%>.CurrentMember is <%region_dimension%>.[<%own_subject_budget_name%>],
               [Уровни бюджета].[СКИФ].[Все].[Бюджет субъекта],
               IIF
               (
                  <%region_dimension%>.CurrentMember is <%region_dimension%>.[Местные бюджеты],
                  [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет МО],
                  <%region_budget_skif_level%>
               )
            )
        ) '  
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )'   
        
    member [Районы].[Сопоставимый].[Городские округа ] 
    as 'Aggregate
        (
           [Города ]
        )' 
    member [Районы].[Сопоставимый].[Муниципальные районы ] 
    as 'Aggregate
        (
           [Районы ]
        )'    
    set [Районы ]    
    as 'Filter    
        (
            Descendants    
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF    
            ),
            not    
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember    
            ) and    
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"    
            )    
        )'    
    set [Города ]    
    as 'Filter    
        (
            Descendants    
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF    
            ),
            not    
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember    
            ) and    
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"   
            )    
        )'          
select
    {
        Measures.[Код],
        Measures.[Назначено млн],
        Measures.[Исполнено млн],
        [Measures].[% выполнения годовых назначений],
        Measures.[Исполнено прошлый год млн],
        Measures.[Темп роста],
        Measures.[Уровень]
    } on columns,
    non empty Filter 
    (
        Descendants
        (
           <%incomes_kd_dimension%>.[Все коды доходов], <%incomes_kd_dimension%>.[<%incomes_kd_subsection_level%>], Self_and_before
        ) - {<%incomes_kd_dimension%>.[Все коды доходов]} - {<%incomes_kd_all_level%>} - {<%incomes_kd_dimension%>.Children.Item(0)} - {<%incomes_total%>} + {<%incomes_total%>},
        (
           Measures.[Исполнено млн] + Measures.[Исполнено прошлый год млн] + Measures.[Назначено млн] + Measures.[Назначено прошлый год млн]
        ) <> 0 and
        not( <%incomes_kd_dimension%>.CurrentMember is <%incomes_kd_dimension%>.CurrentMember.Parent.DataMember ) and
        IIF 
        (
           <%kd_internal_circulation_extruding%>,
           not (<%incomes_kd_dimension%>.CurrentMember.Properties("Код") = "00087000000000000000") and
           not (<%incomes_kd_dimension%>.CurrentMember.Properties("Код") = "00087000000000000120") and
           not (<%incomes_kd_dimension%>.CurrentMember.Properties("Код") = "00087000000000000151") and
           not (<%incomes_kd_dimension%>.CurrentMember.Properties("Код") = "00087000000000001151") and
           not (<%incomes_kd_dimension%>.CurrentMember.Properties("Код") = "00087000000000002151"),
           true
        ) and
        IIF
        (
          <%region_dimension%>.CurrentMember is <%regions_consolidate_level%> or                
          <%region_dimension%>.CurrentMember is <%region_dimension%>.[<%own_subject_budget_name%>] or
          <%region_dimension%>.CurrentMember is <%region_dimension%>.[Консолидированный бюджет субъекта ],
          <%incomes_kd_dimension%>.CurrentMember.Properties("Код") <> "00085900000000000000", 
          true
        )
    ) on rows
from [ФО_МесОтч_Доходы]
where 
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        <%selected_region%>,
        [Уровни бюджета].[СКИФ].[Уровень бюджета ],
        <%region_document_skif_type%>
    ) 
  ]]>
  </query>

</root>