<?xml version="1.0" encoding="windows-1251"?>
<root>  
<query id="FO_0002_0007_date">
    <![CDATA[
-- FO_0002_0007_compare_date
with
    member [Measures].[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                <%period_dimension%>.Members,
                not IsEmpty([Measures].[Факт])
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_МесОтч_Расходы]
  ]]>
</query>

<query id="FO_0002_0007_compare_Grid">
<![CDATA[
-- FO_0002_0007_compare_Grid 
with   
    member Measures.[isMRGO] 
    as 'not( [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ])'
    
    set [Города] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF 
            ),
            not 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            ) 
        )' 
    set [Районы] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF 
            ),
            not 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            ) 
        )'         
    
    member [Районы].[Сопоставимый].[Муниципальные районы ]    
    as 'Aggregate({[Районы]})'   
    
    member [Районы].[Сопоставимый].[Городские округа ]    
    as 'Aggregate({[Города]})'    
    
    set [Города и районы]
    as '[Города] + [Районы]' 
    
    member Measures.[Численность постоянного населения по МО] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ],
            Sum 
            (
                [Районы],
                Measures.[Численность постоянного населения по МО] 
            ),
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ],
                Sum 
                (
                    [Города],
                    Measures.[Численность постоянного населения по МО] 
                ),
                IIF 
                (
                    not(Measures.[isMRGO]),
                    Sum 
                    (
                        [Города и районы],
                        Measures.[Численность постоянного населения по МО] 
                    ),
                    LookupCube            
                    (
                        "<%population_cube%>",
                        "            
                        (
                            <%population_filter%>,
                            " + MemberToStr            
                            (
                                [Районы].[Сопоставимый].CurrentMember            
                            ) + ",
                            <%population_period_dimension%>.[" + [Период].[Период].CurrentMember.Name + "]     
                        ) / <%population_value_divider%>"            
                    )  
                )
            )
        )'    
    member Measures.[Численность постоянного населения]
    as 'IIF 
        (
            not IsEmpty 
            (
                (
                    Measures.[Численность постоянного населения по МО],
                    [Период].[Период].[Данные всех периодов].[<%population_measure_year%>] 
                ) 
            ),
            (
                Measures.[Численность постоянного населения по МО],
                [Период].[Период].[Данные всех периодов].[<%population_measure_year%>] 
            ),
            (
                Tail 
                (
                    Filter 
                    (
                        {
                            [Период].[Период].[Данные всех периодов].[2000] : [Период].[Период].[Данные всех периодов].[<%population_measure_year%>].PrevMember 
                        },
                        not IsEmpty 
                        (
                            Measures.[Численность постоянного населения по МО] 
                        ) 
                    ) 
                ).Item(0),
                Measures.[Численность постоянного населения по МО] 
            ) 
        )'      

    member Measures.[Коэффициент бюджетной обеспеченности населения]  
    as 'IIF   
        (
            IsEmpty   
            (
                Measures.[Численность постоянного населения]   
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            Measures.[Факт]/   
            (
                Measures.[Численность постоянного населения]   
                *1000   
            )   
        )'   
    
    member Measures.[isNotRankingMO] 
    as ' [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ]'
         
    member Measures.[isNotRankingMR] 
    as ' Measures.[isNotRankingMO] or [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"'         
    
    member Measures.[Ранг бюдж.обесп. МО]
    as 'IIF   
        (
            IsEmpty   
            (
                Measures.[Коэффициент бюджетной обеспеченности населения]  
            ) or Measures.[<%ranking_condition%>],
            null,
            Rank   
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order   
                (
                    Filter   
                    (
                        [<%ranking_set%>],
                        not IsEmpty   
                        (
                            Measures.[Коэффициент бюджетной обеспеченности населения]  
                        )   
                    ),
                    Measures.[Коэффициент бюджетной обеспеченности населения],
                    BDESC   
                ),
                Measures.[Коэффициент бюджетной обеспеченности населения]  
            )   
        )'   
    member Measures.[Худший ранг бюдж.обесп. МО]
    as 'IIF 
         ( IsEmpty(Measures.[Ранг бюдж.обесп. МО]) or Measures.[<%ranking_condition%>], null,
         max   
         (
             [<%ranking_set%>],
             Measures.[Ранг бюдж.обесп. МО]
         ))'   

    member Measures.[Доля]  
    as 'IIF(IsEmpty((
                Measures.[Факт],
                <%outcomes_total%>
            )) or (
                Measures.[Факт],
                <%outcomes_total%>
            ) = 0, null,   (
                Measures.[Факт],
                <%fkr_dimension%>.CurrentMember
            )/   
            (
                Measures.[Факт],
                <%outcomes_total%>
            ))
        '
        
    member Measures.[Ранг МО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ) or Measures.[<%ranking_condition%>],
            null,
            Rank    
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order    
                (
                    Filter    
                    (
                        [<%ranking_set%>],
                        not IsEmpty ( [Measures].[Доля] )    
                    ),
                    [Measures].[Доля],
                    BDESC    
                ),
                [Measures].[Доля]    
            )    
        )'    
    member Measures.[Худший ранг МО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ) or Measures.[<%ranking_condition%>],
            null,
            max    
            (
                [<%ranking_set%>],
                Measures.[Ранг МО]    
            )    
        ) '    
 
    member [Районы].[Сопоставимый].[Консолидированный бюджет субъекта]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'
    
    member [Районы].[Сопоставимый].[<%own_subject_budget_name%>]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'
    
    member [Районы].[Сопоставимый].[Местные бюджеты]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'   
    
    
    member [ТипДокумента].[СКИФ].[Тип документа] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or 
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты],
            <%consolidate_document_skif_type%>,
            <%region_document_skif_type%>
        ) '  
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта],
            [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>],
                [Уровни бюджета].[СКИФ].[Все].[Бюджет субъекта],
                IIF 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты],
                    [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет МО],
                    <%region_budget_skif_level%> 
                ) 
            ) 
        ) ' 
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )' 
    member <%fkr_dimension%>.[Расходы итого ]
    as 'Aggregate 
        (
            {
                Filter 
                (
                    Descendants 
                    (
                        <%fkr_dimension%>.[Все коды ФКР],
                        <%fkr_dimension%>.[Раздел],
                        SELF 
                    ),
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "0"
                    ) and
                    (
                       <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9600"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9700"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9800"
                    ) 
                ) 
            } 
        )'        
    member [КОСГУ].[Сопоставимый].[KOSGUSlicer]
    as 'Aggregate
        (
            Filter
            (
               [КОСГУ].[Сопоставимый].[Все коды ЭКР].Children,
               [КОСГУ].[Сопоставимый].CurrentMember.Properties("Код") <> "960"
            )
        )'          
select
    {
        Measures.[Годовые назначения],
        Measures.[Факт],
        Measures.[% выполнения годовых назначений],
        Measures.[Численность постоянного населения],
        Measures.[Коэффициент бюджетной обеспеченности населения],
        Measures.[Ранг бюдж.обесп. МО],
        Measures.[Худший ранг бюдж.обесп. МО],
        Measures.[Доля],
        Measures.[Ранг МО],
        Measures.[Худший ранг МО]
    } on columns,
    Filter
    (
        {
            [Районы].[Сопоставимый].[Консолидированный бюджет субъекта],
            [Районы].[Сопоставимый].[<%own_subject_budget_name%>],
            [Районы].[Сопоставимый].[Местные бюджеты] 
        } + {[Районы].[Сопоставимый].[Городские округа ]} + [Города] +
        {[Районы].[Сопоставимый].[Муниципальные районы ]} + [Районы],
        not (IsEmpty( Measures.[Годовые назначения]) and IsEmpty( Measures.[Факт]))
    ) on rows 
from  [ФО_МесОтч_Расходы]  
where   
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        <%fkr_group_name%>,
        [ТипДокумента].[СКИФ].[Тип документа],
        [Уровни бюджета].[СКИФ].[Уровень бюджета ],
        <%kosgu_filter%>
    )
  ]]>
  </query>

  <query id="FO_0002_0007_compare_avg">
    <![CDATA[
-- FO_0002_0007_compare_avg 
with 
    set [Города]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            )
        )'
    set [Районы]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF
            ),
            not
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            )
        )'
    set [Города и районы]
    as '[Города] + [Районы]'        
    member [Районы].[Сопоставимый].[Консолидированный бюджет субъекта]
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)'         
    member [Районы].[Сопоставимый].[<%own_subject_budget_name%>]
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)'  
    member [Районы].[Сопоставимый].[Местные бюджеты] 
    as '(<%regions_consolidate_level%>, <%consolidate_document_skif_type%>)'  
    
 
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта],
            [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>],
                [Уровни бюджета].[СКИФ].[Все].[Бюджет субъекта],
                IIF 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты],
                    [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет МО],
                    <%region_budget_skif_level%>
                ) 
            ) 
        ) ' 
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )'  
        
    member Measures.[Среднее] 
    as '100 *
        AVG 
        (
            [Множество бюджетов],
            Measures.[% выполнения годовых назначений] 
        )' 
    set [Множество бюджетов] 
    as '
        {
            [Районы__Сопоставимый].[Районы__Сопоставимый].[Собственный бюджет субъекта] 
        } + [Города и районы]' 
        
    member <%fkr_dimension%>.[Расходы итого ]
    as 'Aggregate 
        (
            {
                Filter 
                (
                    Descendants 
                    (
                        <%fkr_dimension%>.[Все коды ФКР],
                        <%fkr_dimension%>.[Раздел],
                        SELF 
                    ),
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "0"
                    ) and
                    (
                       <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9600"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9700"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9800"
                    ) 
                ) 
            } 
        )'    
    member [КОСГУ].[Сопоставимый].[KOSGUSlicer]
    as 'Aggregate
        (
            Filter
            (
               [КОСГУ].[Сопоставимый].[Все коды ЭКР].Children,
               [КОСГУ].[Сопоставимый].CurrentMember.Properties("Код") <> "960"
            )
        )'         
select
    { Measures.[Среднее] } on columns 
from [ФО_МесОтч_Расходы] 
where 
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        <%region_document_skif_type%>,
        [Уровни бюджета].[СКИФ].[Уровень бюджета ],
        <%fkr_group_name%>,
        <%kosgu_filter%>
    ) 
  ]]>
  </query>

  <query id="FO_0002_0007_compare_Map">
    <![CDATA[
-- FO_0002_0007_compare_Map 
with   
    member Measures.[isMRGO] 
    as 'not( [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ])'
    
    set [Города] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF 
            ),
            not 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            ) 
        )' 
    set [Районы] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы].[Сопоставимый].[Все районы],
                <%regions_level%>,
                SELF 
            ),
            not 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
            ) 
        )'         
    
    member [Районы].[Сопоставимый].[Муниципальные районы ]    
    as 'Aggregate({[Районы]})'   
    
    member [Районы].[Сопоставимый].[Городские округа ]    
    as 'Aggregate({[Города]})'    
    
    set [Города и районы]
    as '[Города] + [Районы]' 
    
    member Measures.[Численность постоянного населения по МО] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ],
            Sum 
            (
                [Районы],
                Measures.[Численность постоянного населения по МО] 
            ),
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ],
                Sum 
                (
                    [Города],
                    Measures.[Численность постоянного населения по МО] 
                ),
                IIF 
                (
                    not(Measures.[isMRGO]),
                    Sum 
                    (
                        [Города и районы],
                        Measures.[Численность постоянного населения по МО] 
                    ),
                    LookupCube            
                    (
                        "<%population_cube%>",
                        "            
                        (
                            <%population_filter%>,
                            " + MemberToStr            
                            (
                                [Районы].[Сопоставимый].CurrentMember            
                            ) + ",
                            <%population_period_dimension%>.[" + [Период].[Период].CurrentMember.Name + "]     
                        ) / <%population_value_divider%>"            
                    )  
                )
            )
        )'    
    member Measures.[Численность постоянного населения]
    as 'IIF 
        (
            not IsEmpty 
            (
                (
                    Measures.[Численность постоянного населения по МО],
                    [Период].[Период].[Данные всех периодов].[<%population_measure_year%>] 
                ) 
            ),
            (
                Measures.[Численность постоянного населения по МО],
                [Период].[Период].[Данные всех периодов].[<%population_measure_year%>] 
            ),
            (
                Tail 
                (
                    Filter 
                    (
                        {
                            [Период].[Период].[Данные всех периодов].[2000] : [Период].[Период].[Данные всех периодов].[<%population_measure_year%>].PrevMember 
                        },
                        not IsEmpty 
                        (
                            Measures.[Численность постоянного населения по МО] 
                        ) 
                    ) 
                ).Item(0),
                Measures.[Численность постоянного населения по МО] 
            ) 
        )'      

    member Measures.[Коэффициент бюджетной обеспеченности населения]  
    as 'IIF   
        (
            IsEmpty   
            (
                Measures.[Численность постоянного населения]   
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            Measures.[Факт]/   
            (
                Measures.[Численность постоянного населения]   
                *1000   
            )   
        )'   
    
    member Measures.[isNotRankingMO] 
    as ' [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Муниципальные районы ] or
         [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Городские округа ]'
         
    member Measures.[isNotRankingMR] 
    as ' Measures.[isNotRankingMO] or [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"'         
    
    member Measures.[Ранг бюдж.обесп. МО]
    as 'IIF   
        (
            IsEmpty   
            (
                Measures.[Коэффициент бюджетной обеспеченности населения]  
            ) or Measures.[<%ranking_condition%>],
            null,
            Rank   
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order   
                (
                    Filter   
                    (
                        [<%ranking_set%>],
                        not IsEmpty   
                        (
                            Measures.[Коэффициент бюджетной обеспеченности населения]  
                        )   
                    ),
                    Measures.[Коэффициент бюджетной обеспеченности населения],
                    BDESC   
                ),
                Measures.[Коэффициент бюджетной обеспеченности населения]  
            )   
        )'   
    member Measures.[Худший ранг бюдж.обесп. МО]
    as 'IIF 
         ( IsEmpty(Measures.[Ранг бюдж.обесп. МО]) or Measures.[<%ranking_condition%>], null,
         max   
         (
             [<%ranking_set%>],
             Measures.[Ранг бюдж.обесп. МО]
         ))'   

    member Measures.[Доля]  
    as 'IIF(IsEmpty((
                Measures.[Факт],
                <%outcomes_total%>
            )) or (
                Measures.[Факт],
                <%outcomes_total%>
            ) = 0, null,   (
                Measures.[Факт],
                <%fkr_dimension%>.CurrentMember
            )/   
            (
                Measures.[Факт],
                <%outcomes_total%>
            ))
        '
        
    member Measures.[Ранг МО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ) or Measures.[<%ranking_condition%>],
            null,
            Rank    
            (
                [Районы].[Сопоставимый].CurrentMember,
                Order    
                (
                    Filter    
                    (
                        [<%ranking_set%>],
                        not IsEmpty ( [Measures].[Доля] )    
                    ),
                    [Measures].[Доля],
                    BDESC    
                ),
                [Measures].[Доля]    
            )    
        )'    
    member Measures.[Худший ранг МО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ) or Measures.[<%ranking_condition%>],
            null,
            max    
            (
                [<%ranking_set%>],
                Measures.[Ранг МО]    
            )    
        ) '    
 
    member [Районы].[Сопоставимый].[Консолидированный бюджет субъекта]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'
    
    member [Районы].[Сопоставимый].[<%own_subject_budget_name%>]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'
    
    member [Районы].[Сопоставимый].[Местные бюджеты]
    as 'IIF
        (
            IsEmpty
            (
                (
                    <%regions_consolidate_level%>,
                    <%consolidate_document_skif_type%>
                )
            ),
            (
                <%regions_consolidate_level%>,
                [ТипДокумента].[СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)]
            ),
            (
                <%regions_consolidate_level%>,
                <%consolidate_document_skif_type%>
            )
        )'   
    
    
    member [ТипДокумента].[СКИФ].[Тип документа] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is <%regions_consolidate_level%> or 
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта] or
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>] or 
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты],
            <%consolidate_document_skif_type%>,
            <%region_document_skif_type%>
        ) '  
    member [Уровни бюджета].[СКИФ].[Уровень бюджета ] 
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолидированный бюджет субъекта],
            [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[<%own_subject_budget_name%>],
                [Уровни бюджета].[СКИФ].[Все].[Бюджет субъекта],
                IIF 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Местные бюджеты],
                    [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет МО],
                    <%region_budget_skif_level%> 
                ) 
            ) 
        ) ' 
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )' 
    member <%fkr_dimension%>.[Расходы итого ]
    as 'Aggregate 
        (
            {
                Filter 
                (
                    Descendants 
                    (
                        <%fkr_dimension%>.[Все коды ФКР],
                        <%fkr_dimension%>.[Раздел],
                        SELF 
                    ),
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "0"
                    ) and
                    (
                       <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9600"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9700"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9800"
                    ) 
                ) 
            } 
        )'        
    member [КОСГУ].[Сопоставимый].[KOSGUSlicer]
    as 'Aggregate
        (
            Filter
            (
               [КОСГУ].[Сопоставимый].[Все коды ЭКР].Children,
               [КОСГУ].[Сопоставимый].CurrentMember.Properties("Код") <> "960"
            )
        )'   
   member Measures.[Код объекта карты]
   as '[Районы].[Сопоставимый].CurrentMember.Properties("Код объекта карты")'        
select
    {
        Measures.[Коэффициент бюджетной обеспеченности населения],
        Measures.[Код объекта карты]
    } on columns,
    Filter
    (
        {
            [Районы].[Сопоставимый].[Консолидированный бюджет субъекта],
            [Районы].[Сопоставимый].[<%own_subject_budget_name%>],
            [Районы].[Сопоставимый].[Местные бюджеты] 
        } + {[Районы].[Сопоставимый].[Городские округа ]} + [Города] +
        {[Районы].[Сопоставимый].[Муниципальные районы ]} + [Районы],
        not (IsEmpty( Measures.[Годовые назначения]) and IsEmpty( Measures.[Факт]))
    ) on rows 
from  [ФО_МесОтч_Расходы]  
where   
    (
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        <%fkr_group_name%>,
        [ТипДокумента].[СКИФ].[Тип документа],
        [Уровни бюджета].[СКИФ].[Уровень бюджета ],
        <%kosgu_filter%>
    )
  ]]>
  </query>
</root>