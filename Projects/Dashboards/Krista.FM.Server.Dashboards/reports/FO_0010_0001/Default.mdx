<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FO_0010_0001_date">
    <![CDATA[
-- FO_0010_0001_date
-- <#[МОФО_Дополнительные мероприятия]#>
with 
    member [Measures].[ДанныеНа] 
    as '[Период].[Период].CurrentMember.UniqueName' 
    set [NonEmptySet] 
    as 'Tail 
        (
            nonemptycrossjoin 
            (
                [Период].[Период].[Год].Members,
                {
                    [Вариант].[МОФО_Доп мероприятия].[Все].[1 квартал],
                    [Вариант].[МОФО_Доп мероприятия].[Все].[2 квартал],
                    [Вариант].[МОФО_Доп мероприятия].[Все].[3 квартал],
                    [Вариант].[МОФО_Доп мероприятия].[Все].[Итоговый за год]
                } 
            )
        ) ' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from [МОФО_Дополнительные мероприятия]
]]>
</query>

<query id="FO_0010_0001_grid">
<![CDATA[
-- FO_0010_0001_grid
-- <#[МОФО_Дополнительные мероприятия]#>
with               
    member [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'
    
    member [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'
    
    member [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'

    member [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'

    member [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'

    member [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'
    
    member [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'    

    member [Районы].[Сопоставимый].[Консолид.бюджеты районов]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'
    member [Районы].[Сопоставимый].[Все районы].[Городские округа Всего]
    as '[Районы].[Сопоставимый].[Все районы].[Вологодская область]'

    set [Все муниципальные образования]
    as '{
           [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
           [Районы].[Сопоставимый].[Консолид.бюджеты районов],
           [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
           [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
           [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего],
           [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
           [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений]
        } +
        Generate
        (
            Filter
            (
                Descendants
                (
                   [Районы].[Сопоставимый].[Все районы].[Вологодская область].[Города областного подчинения Вологодской области],
                   <%region_level%>,
                   SELF
                ) +
                Descendants
                (
                   [Районы].[Сопоставимый].[Все районы].[Вологодская область].[Районы Вологодской области],
                   <%region_level%>,
                   SELF
                ),
                not
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember
                )
            ),
            {
                [Районы].[Сопоставимый].CurrentMember
            } +
            Descendants
                (
                    [Районы].[Сопоставимый].CurrentMember,
                    <%settlement_level%>,
                    SELF
                )
        )'
    set [Выбранные МО]    
    as '{<%selected_region_set%>}'
    
    set [Муниципальные образования]
    as 'Filter
        (
          Descendants               
          (
             [Районы].[Сопоставимый].[Все районы].[Вологодская область],
             <%region_level%>,
             SELF               
          ),
          not  
          (
             [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember  
          )
       )'
    
    set [Собственные районы]
    as 'Filter
        (
          Descendants               
          (
             [Районы].[Сопоставимый].[Все районы].[Вологодская область],
             <%settlement_level%>,
             SELF               
          ),
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
       )'
    
    set [Муниципальные районы]
    as 'Filter
        (
            Descendants
            (
                [Районы].[Сопоставимый].[Все районы].[Вологодская область],
                <%region_level%>,
                SELF
            ),
            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР"
        )'
        
    set [Городские округа]
    as 'Filter
        (
          Descendants               
          (
             [Районы].[Сопоставимый].[Все районы].[Вологодская область],
             <%region_level%>,
             SELF               
          ),
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
       )'
    
    set [Сельские поселения]
    as 'Filter
        (
          Descendants               
          (
             [Районы].[Сопоставимый].[Все районы].[Вологодская область],
             <%settlement_level%>,
             SELF               
          ),
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП"
       )'
    
    set [Городские поселения]
    as 'Filter
        (
          Descendants               
          (
             [Районы].[Сопоставимый].[Все районы].[Вологодская область],
             <%settlement_level%>,
             SELF               
          ),
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП"
       )'
    
    set [Городские и сельские поселения]
    as '[Сельские поселения] + [Городские поселения]'
    
    set [Поселения текущего района]
    as 'Filter
        (
          Descendants               
          (
             <%selected_region%>,
             <%settlement_level%>,
             SELF               
          ),
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or
          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП"
       )'
    
    set [Показатели местного бюджета]  
    as 'Filter    
        (
            <%incomes_mobilization%>
            Generate    
            (
                Filter   
                (
                    {<%selected_main_indicator%>},
                    Count  
                    (
                        Filter
                        (
                            Descendants 
                            (
                                [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember,
                                [Показатели].[ДопМероприятия_Сопоставимый].[Показатели уровень 05],
                                SELF_AND_BEFORE  
                            ),
                            <%selected_detail_indicator%>
                        ) 
                    ) <> 0  
                ),
                {
                    [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember    
                } <%indicator_sign%> Filter    
                (
                    Generate    
                    (
                        Descendants    
                        (
                            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember,
                            [Показатели].[ДопМероприятия_Сопоставимый].[Показатели уровень 3],
                            SELF    
                        ),
                        {
                            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember    
                        } + Descendants    
                        (
                            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember,
                            [Показатели].[ДопМероприятия_Сопоставимый].[Показатели уровень 05],
                            SELF    
                        )    
                    ),
                    <%selected_detail_indicator%>   
                )    
            ),
            not    
            (
                [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember is [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Parent.DataMember    
            )    
        )'          
    member [Measures].[Тип терри- тории]
    as 'IIF  
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
            "Все",
            IIF   
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                "МР",
                IIF   
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] or
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                    "ГО",
                    IIF   
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] or
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] or
                        <%settelment_total_selected%>,
                        "ГСП",
                        IIF   
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                            "СП",
                            IIF   
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                "ГП",
                                [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории")
                            )   
                        )   
                    )   
                )   
            )
        )'              
    member [Measures].[Код]
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
            "Все",
            IIF 
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
                "МР",
                IIF 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] or
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                    "ГО",
                    IIF 
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] or
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] or
                        <%settelment_total_selected%>,
                        "ГСП",
                        IIF 
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                            "ГCП",
                            IIF 
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                "ГСП",
                                IIF 
                                (
                                     
                                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                                    "кон",
                                    IIF 
                                    (
                                      [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СБ",
                                      "Все",
                                      IIF 
                                      (
                                          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП" or
                                          [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП",
                                          "ГСП",
                                          IIF 
                                          (
                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" and not 
                                            (
                                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
                                            ),
                                            "кон",
                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") 
                                          )   
                                      )   
                                    )  
                                ) 
                            ) 
                        ) 
                    ) 
                ) 
            ) 
        )'          
    member [Measures].[Муниципальное образование]            
    as 'IIF 
        (
            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember,
            [Районы].[Сопоставимый].CurrentMember.Name + " (собственный бюджет)",
            IIF 
            (
               <%settelment_total_selected%> and not ([Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего]),
               "Бюджеты поселений (" + [Районы].[Сопоставимый].CurrentMember.Name + ")",
               [Районы].[Сопоставимый].CurrentMember.Name
            )
        )'   
    member [Measures].[Задание, тыс.руб.]     
    as 'IIF     
        (
            ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>]) = 0,
            null,
            IIF     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
                Sum     
                (
                    [Муниципальные образования],
                    ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])  
                ) / 1000,
                IIF     
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
                    Sum     
                    (
                        [Собственные районы],
                        ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])   
                    ) / 1000,
                    IIF    
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего],
                        Sum    
                        (
                            [Городские округа],
                            ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])  
                        ) / 1000,
                        IIF   
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего],
                            Sum   
                            (
                                [Городские и сельские поселения],
                                ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                            ) / 1000,
                            IIF  
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                                Sum  
                                (
                                    [Сельские поселения],
                                    ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                                ) / 1000,
                                IIF 
                                (
                                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                    Sum 
                                    (
                                        [Городские поселения],
                                        ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                                    ) / 1000,
                                    IIF 
                                    (
                                       [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                                       Sum 
                                       (
                                           [Муниципальные районы],
                                           ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                                       ) / 1000,
                                       IIF 
                                       (
                                          [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                                          Sum 
                                          (
                                              [Городские округа],
                                              ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                                          ) / 1000,
                                          IIF 
                                          (
                                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений],
                                                Sum 
                                                (
                                                    Filter([Поселения текущего района], ([Measures].[Задание]) <> 0),
                                                    ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>])
                                                ) / 1000,
                                                IIF       
                                                (
                                                    <%settelment_total_selected%>,
                                                    Sum        
                                                    (
                                                        Filter       
                                                        (
                                                            Descendants       
                                                            (
                                                                [Районы].[Сопоставимый].CurrentMember,
                                                                <%settlement_level%>,
                                                                SELF       
                                                            ),
                                                            ([Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or 
                                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП") and
                                                            ([Measures].[Задание]) <> 0
                                                        ),
                                                        ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>]) / 1000        
                                                    ),
                                                    ([Measures].[Задание], [Период].[Период].[Данные всех периодов].[<%period_year%>]) / 1000       
                                                )  
                                          )  
                                       )
                                    )   
                                ) 
                            )  
                        )   
                    )    
                )     
            )     
        )'
        
    member [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]         
    as 'IIF     
        (
            (
                [Measures].[Экономический эффект],
                [Период].[Период].[Данные всех периодов].[<%period_year%>],
                [Вариант].[МОФО_Доп мероприятия].[Все].[Первоначальный]         
            ) = 0,
            null,
            IIF     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
                Sum     
                (
                    [Муниципальные образования],
                    [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]   
                ),
                IIF     
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
                    Sum     
                    (
                        [Собственные районы],
                        [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]    
                    ),
                    IIF    
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего],
                        Sum    
                        (
                            [Городские округа],
                            [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]    
                        ),
                        IIF   
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего],
                            Sum   
                            (
                                [Городские и сельские поселения],
                                [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]  
                            ),
                            IIF  
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                                Sum  
                                (
                                    [Сельские поселения],
                                    [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]  
                                ),
                                IIF 
                                (
                                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                    Sum 
                                    (
                                        [Городские поселения],
                                        [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]
                                    ),
                                    IIF 
                                    (
                                       [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                                       Sum 
                                       (
                                           [Муниципальные районы],
                                           [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]
                                       ),
                                       IIF 
                                       (
                                          [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                                          Sum 
                                          (
                                              [Городские округа],
                                              [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]
                                          ),
                                          IIF 
                                          (
                                             [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений],
                                             Sum 
                                             (
                                                 [Поселения текущего района],
                                                 [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]
                                             ),
                                             IIF       
                                                (
                                                    <%settelment_total_selected%>,
                                                    Sum        
                                                    (
                                                        Filter       
                                                        (
                                                            Descendants       
                                                            (
                                                                [Районы].[Сопоставимый].CurrentMember,
                                                                <%settlement_level%>,
                                                                SELF       
                                                            ),
                                                            ([Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or 
                                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП") and
                                                              (
                                                               [Measures].[Экономический эффект],
                                                               [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                               [Вариант].[МОФО_Доп мероприятия].[Все].[Первоначальный]         
                                                              ) 
                                                             <> 0       
                                                        ),
                                                        (
                                                           [Measures].[Экономический эффект],
                                                           [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                           [Вариант].[МОФО_Доп мероприятия].[Все].[Первоначальный]         
                                                        ) / 1000    
                                                    ),
                                                    (
                                                         [Measures].[Экономический эффект],
                                                         [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                         [Вариант].[МОФО_Доп мероприятия].[Все].[Первоначальный]         
                                                    ) / 1000     
                                                ) 
                                          )   
                                       )
                                    ) 
                                ) 
                            )  
                        )   
                    )    
                )     
            )     
        )'         
    member [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]        
    as 'IIF     
        (
            (
                 [Measures].[Экономический эффект],
                 [Период].[Период].[Данные всех периодов].[<%period_year%>],
                 [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
            ) = 0,
            null,
            IIF     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
                Sum     
                (
                    [Муниципальные образования],
                    [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]    
                ),
                IIF     
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
                    Sum     
                    (
                        [Собственные районы],
                        [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]     
                    ),
                    IIF    
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего],
                        Sum    
                        (
                            [Городские округа],
                            [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.] 
                        ),
                        IIF   
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего],
                            Sum   
                            (
                                [Городские и сельские поселения],
                                [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]  
                            ),
                            IIF  
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                                Sum  
                                (
                                    [Сельские поселения],
                                    [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.] 
                                ),
                                IIF 
                                (
                                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                    Sum 
                                    (
                                        [Городские поселения],
                                        [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]
                                    ),
                                    IIF 
                                    (
                                       [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                                       Sum 
                                       (
                                           [Муниципальные районы],
                                            [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]
                                       ),
                                       IIF 
                                       (
                                          [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                                          Sum 
                                          (
                                              [Городские округа],
                                              [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]
                                          ),
                                          IIF 
                                          (
                                             [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений],
                                             Sum 
                                             (
                                                 [Поселения текущего района],
                                                 [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]
                                             ),
                                             IIF       
                                                (
                                                    <%settelment_total_selected%>,
                                                    Sum        
                                                    (
                                                        Filter       
                                                        (
                                                            Descendants       
                                                            (
                                                                [Районы].[Сопоставимый].CurrentMember,
                                                                <%settlement_level%>,
                                                                SELF       
                                                            ),
                                                            ([Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or 
                                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП") and
                                                              (
                                                                 [Measures].[Экономический эффект],
                                                                 [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                                 [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                              ) 
                                                             <> 0       
                                                        ),
                                                        (
                                                           [Measures].[Экономический эффект],
                                                           [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                           [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                        ) / 1000    
                                                    ),
                                                    (
                                                       [Measures].[Экономический эффект],
                                                       [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                       [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                    ) / 1000   
                                                )                                               
                                          )   
                                       )
                                    )                                     
                                ) 
                            )  
                        )   
                    )    
                )     
            )     
        )'        
    member [Measures].[Фактически полученный экономический эффект, тыс.руб.]        
    as 'IIF     
        (
            (
                [Measures].[Согласованная оценка],
                [Период].[Период].[Данные всех периодов].[<%period_year%>],
                [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
            ) = 0,
            null,
            IIF     
            (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего],
                Sum     
                (
                    [Муниципальные образования],
                    [Measures].[Фактически полученный экономический эффект, тыс.руб.]   
                ),
                IIF     
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего],
                    Sum     
                    (
                        [Собственные районы],
                        [Measures].[Фактически полученный экономический эффект, тыс.руб.]     
                    ),
                    IIF    
                    (
                        [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего],
                        Sum    
                        (
                            [Городские округа],
                            [Measures].[Фактически полученный экономический эффект, тыс.руб.]  
                        ),
                        IIF   
                        (
                            [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего],
                            Sum   
                            (
                                [Городские и сельские поселения],
                                [Measures].[Фактически полученный экономический эффект, тыс.руб.]  
                            ),
                            IIF  
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений],
                                Sum  
                                (
                                    [Сельские поселения],
                                    [Measures].[Фактически полученный экономический эффект, тыс.руб.]
                                ),
                                IIF 
                                (
                                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений],
                                    Sum 
                                    (
                                        [Городские поселения],
                                        [Measures].[Фактически полученный экономический эффект, тыс.руб.]
                                    ),
                                    IIF 
                                    (
                                       [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов],
                                       Sum 
                                       (
                                           [Муниципальные районы],
                                           [Measures].[Фактически полученный экономический эффект, тыс.руб.]
                                       ),
                                       IIF 
                                       (
                                          [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                                          Sum 
                                          (
                                              [Городские округа],
                                              [Measures].[Фактически полученный экономический эффект, тыс.руб.]
                                          ),
                                          IIF 
                                          (
                                             [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений],
                                             Sum 
                                             (
                                                 [Поселения текущего района],
                                                 [Measures].[Фактически полученный экономический эффект, тыс.руб.]
                                             ),
                                             IIF       
                                                (
                                                    <%settelment_total_selected%>,
                                                    Sum        
                                                    (
                                                        Filter       
                                                        (
                                                            Descendants       
                                                            (
                                                                [Районы].[Сопоставимый].CurrentMember,
                                                                <%settlement_level%>,
                                                                SELF       
                                                            ),
                                                            ([Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or 
                                                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП") and
                                                              (
                                                                   [Measures].[Согласованная оценка],
                                                                   [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                                   [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                              ) <> 0             
                                                        ),
                                                        (
                                                             [Measures].[Согласованная оценка],
                                                             [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                             [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                        ) / 1000   
                                                    ),
                                                    (
                                                         [Measures].[Согласованная оценка],
                                                         [Период].[Период].[Данные всех периодов].[<%period_year%>],
                                                         [Вариант].[МОФО_Доп мероприятия].[Все].[<%selected_variant%>]        
                                                    ) / 1000
                                                )                                                  
                                          )   
                                       )
                                    )                                     
                                ) 
                            )  
                        )   
                    )    
                )     
            )     
        )'        
    member [Measures].[% исполнения програмных мероприятий (первоночальных)]        
    as 'IIF        
        (
            IsEmpty       
            (
                [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]        
            ) or        
            (
                [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]        
            ) = 0,
            null,
            [Measures].[Фактически полученный экономический эффект, тыс.руб.] / [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]       
        )'        
    member [Measures].[% исполнения програмных мероприятий (уточненных)]       
    as 'IIF       
        (
            IsEmpty       
            (
                [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]       
            ) or       
            (
                [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]       
            ) = 0,
            null,
            [Measures].[Фактически полученный экономический эффект, тыс.руб.] / [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]       
        )'       
    member [Measures].[% исполнения задания ДФ ВО на год]       
    as 'IIF       
        (
            IsEmpty ( [Measures].[Задание, тыс.руб.] ) or ( [Measures].[Задание, тыс.руб.] ) = 0,
            null,
            [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.] / [Measures].[Задание, тыс.руб.]       
        )'       
    member [Measures].[Наименование мероприятия]     
    as 'IIF 
        (
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name = "Показатели уровень 1" or
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name = "Показатели уровень 2",
            "",
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Name
        )' 
    member [Measures].[Показатели местного бюджета]     
    as 'IIF    
        (
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name = "Показатели уровень 1" or
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name = "Показатели уровень 2",
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Name,
            IIF  
            (
                [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name = "Показатели уровень 3",
                [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Parent.Name,
                [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Parent.Parent.Name 
            )  
        )'
    member [Measures].[Уровень]
    as '[Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level.Name'
    member [Measures].[Фильтр по коду]    
    as 'IIF   
        (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                "<%selected_region_code%>" = "Все" or
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего] and "<%selected_region_code%>" = "Все"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего] and "<%selected_region_code%>" = "МР"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] and "<%selected_region_code%>" = "ГО"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] and "<%selected_region_code%>" = "ГСП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] and "<%selected_region_code%>" = "ГСП"  
                ) or 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений] and "<%selected_region_code%>" = "ГСП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений] and "<%selected_region_code%>" = "ГСП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов] and "<%selected_region_code%>" = "кон"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего] and "<%selected_region_code%>" = "ГО"  
                ),
                IIF    
                (
                    "<%selected_region_code%>" = "ГСП",
                    [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП" or [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "СП" or
                    <%settelment_total_selected%>,
                    IIF    
                    (
                        "<%selected_region_code%>" = "Все",
                        true,
                        IIF 
                        (
                            [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" and not 
                            (
                                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].CurrentMember.Parent.DataMember 
                            ),
                            "<%selected_region_code%>" = "кон",
                            "<%selected_region_code%>" = [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории")
                        ) 
                    )    
                 )    
         )' 
    member [Measures].[Фильтр по типу]
    as 'IIF   
        (
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов] or
                [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего],
                "<%selected_region_type%>" = "Все" or
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Местные бюджеты – Всего] and "<%selected_region_type%>" = "Все"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Собственные бюджеты МР - Всего] and "<%selected_region_type%>" = "МР"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты ГО – Всего] and "<%selected_region_type%>" = "ГО"  
                ) or  
                (
                    ([Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений – Всего] or <%settelment_total_selected%>) and "<%selected_region_type%>" = "ГСП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты поселений] and "<%selected_region_type%>" = "ГСП"  
                ) or                 
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты сельских поселений] and "<%selected_region_type%>" = "СП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Бюджеты городских поселений] and "<%selected_region_type%>" = "ГП"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Консолид.бюджеты районов] and "<%selected_region_type%>" = "МР"  
                ) or  
                (
                    [Районы].[Сопоставимый].CurrentMember is [Районы].[Сопоставимый].[Все районы].[Городские округа Всего] and "<%selected_region_type%>" = "ГО"  
                ),
                IIF
                (
                    "<%selected_region_type%>" = "Все",
                    true,
                    "<%selected_region_type%>" = [Районы].[Сопоставимый].CurrentMember.Properties("Тип территории")
                )
         )'  
    member [Measures].[Число непустых выбранных потомков]  
    as 'IIF 
        (
            [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember.Level is [Показатели].[ДопМероприятия_Сопоставимый].[Показатели уровень 2],
            Count 
            (
                Filter  
                (
                    Descendants  
                    (
                        [Показатели].[ДопМероприятия_Сопоставимый].CurrentMember,
                        [Показатели].[ДопМероприятия_Сопоставимый].[Показатели уровень 05],
                        SELF_AND_BEFORE  
                    ),
                    <%selected_detail_indicator%> and not  
                    (
                        IsEmpty  
                        (
                            [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]  
                        ) and IsEmpty  
                        (
                            [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]  
                        ) and IsEmpty  
                        (
                            [Measures].[Фактически полученный экономический эффект, тыс.руб.]  
                        )  and
                        IsEmpty  
                        (
                            [Measures].[Задание, тыс.руб.]
                        ) 
                    )  
                )  
            ),
            1
        )'         
SELECT
    {
        [Measures].[Код],
        [Measures].[Тип терри- тории],
        [Measures].[Муниципальное образование],
        [Measures].[Показатели местного бюджета],
        [Measures].[Наименование мероприятия],
        [Measures].[Задание, тыс.руб.],
        [Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.],
        [Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.],
        [Measures].[Фактически полученный экономический эффект, тыс.руб.],
        [Measures].[% исполнения програмных мероприятий (первоночальных)],
        [Measures].[% исполнения програмных мероприятий (уточненных)],
        [Measures].[% исполнения задания ДФ ВО на год],
        [Measures].[Уровень]
    } on columns,
    Filter
    (
        Filter
        (
           {<%selected_region_set%>},
           [Measures].[Фильтр по коду] = true and
           [Measures].[Фильтр по типу] = true
        )  
        * [Показатели местного бюджета],
        [Measures].[Число непустых выбранных потомков] > 0 and
        not (
              IsEmpty([Measures].[Экономический эффект, утвержденный программой на текущий год первоначально, тыс.руб.]) and
              IsEmpty([Measures].[Уточненный экономический эффект, утвержденный программой на текущий год, тыс.руб.]) and
              IsEmpty([Measures].[Фактически полученный экономический эффект, тыс.руб.]) and
              IsEmpty([Measures].[Задание, тыс.руб.]) 
            )
    ) on rows         
FROM [МОФО_Дополнительные мероприятия]               
  ]]>
  </query>

</root>