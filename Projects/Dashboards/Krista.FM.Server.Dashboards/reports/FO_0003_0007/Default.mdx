<?xml version="1.0" encoding="Windows-1251"?>
<root>

   <query id="FO_0003_0007_date">
    <![CDATA[
-- FO_0002_0008_date
  with
    member [Measures].[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                <%period_dimension%>.Members,
                not IsEmpty([Measures].[Факт])
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_МесОтч_Расходы]
]]>
  </query>

   <query id="FO_0003_0007_grid">
<![CDATA[
--FO_0003_0007_grid
WITH      

    set [РзПр]   
    as '  
        {
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО].[Жилищное хозяйство],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО].[Коммунальное хозяйство],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО].[Благоустройство],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО].[Прикладные научные исследования в области жилищно- коммунального хозяйства],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО].[Другие вопросы в области жилищно-коммунального хозяйства]   
        }+
        {
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ].[Экологический контроль],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ].[Сбор, удаление отходов и очистка сточных вод],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ].[Охрана объектов растительного и животного мира и среды их обитания],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ].[Прикладные научные исследования в области охраны окружающей среды],
            [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ].[Другие вопросы в области охраны окружающей среды]   
        }   '  

    member Measures.[Код]
    as '[РзПр__Сопоставимый].[РзПр__Сопоставимый].CurrentMember.Properties("Код")' 
    member Measures.[План ]
    as ' [Measures].[Годовые назначения] '
    member Measures.[Факт ]
    as '[Measures].[Факт]'
    member Measures.[Факт прошлый год ]  
    as 'IIF  
        (
            <%ekr_dimension%>.CurrentMember is <%ekr_dimension%>.[Расходы бюджета - ИТОГО ],
            Sum  
            (
                [Список кодов ЭКР],
                [Measures].[Факт_прошлый год]      
            ),
            [Measures].[Факт_прошлый год]    
        )'          
    member Measures.[Процент исполнения ]  
    as 'IIF  
        (
            <%ekr_dimension%>.CurrentMember is <%ekr_dimension%>.[Расходы бюджета - ИТОГО ],
            Measures.[Факт ] / Measures.[План ],
            [Measures].[% выполнения годовых назначений]  
        )'  
    member Measures.[Ранг процент исполнения]             
    as 'IIF             
        (
            IsEmpty             
            (
                Measures.[Процент исполнения ]             
            ) or             
            (
                Measures.[Процент исполнения ] = 0             
            ) ,
            null,
            Rank             
            (
                [РзПр__Сопоставимый].[РзПр__Сопоставимый].CurrentMember,
                Order             
                (
                    [РзПр],
                    Measures.[Процент исполнения ],
                    BDESC             
                ),
                Measures.[Процент исполнения ]             
            )             
        )'             
    member Measures.[Худший ранг процент исполнения]             
    as 'IIF             
        (
            IsEmpty              
            (
                Measures.[Ранг процент исполнения]             
            ) or             
            (
                Measures.[Ранг процент исполнения] = 0            
            ) ,
            null,
            max             
            (
                [РзПр]   ,
                Measures.[Ранг процент исполнения]             
            )             
        )'   
   member   [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Всего ] 
    as 'Aggregate 
        (
            {
                [РзПр] 
            }  
        )'  
    member Measures.[Доля]        
    as 'IIF        
        (
            (
                [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Всего ],
                [Measures].[Факт ]        
            ) = 0,
            null,
            (
                [РзПр__Сопоставимый].[РзПр__Сопоставимый].CurrentMember,
                [Measures].[Факт ]        
            ) /        
            (
                [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Всего ],
                [Measures].[Факт ]        
            )        
        )'  
    member Measures.[Ранг Доля]
    as 'IIF
        (
            IsEmpty
            (
                ( Measures.[Доля]      )
            ) or         ( Measures.[Доля]       ) = 0 or  [РзПр__Сопоставимый].[РзПр__Сопоставимый].CurrentMember is [РзПр__Сопоставимый].[РзПр__Сопоставимый].[Всего ],
            null,
            Rank
            (
                [РзПр__Сопоставимый].[РзПр__Сопоставимый].CurrentMember,
                Order
                (
                    [РзПр] ,
                    Measures.[Доля],
                    BDESC
                ),
                Measures.[Доля]
            )
        )'
     member Measures.[Худший ранг Доля]             
    as 'IIF             
        (
            IsEmpty  ( Measures.[Ранг Доля] ) or ( Measures.[Ранг Доля] = 0),
            null,
            max             
            ( [РзПр] ,
                Measures.[Ранг Доля]             
            )             
        )'
    member Measures.[Отклонение (+,-)]  
    as 'Measures.[Факт ] - Measures.[Факт прошлый год ]'  
    member Measures.[Темп роста, %] 
    as 'IIF 
        (
            IsEmpty(Measures.[Факт прошлый год ]) or (Measures.[Факт прошлый год ]) = 0,
            null,
            Measures.[Факт ] / Measures.[Факт прошлый год ]
        )'
    member Measures.[Рост (снижение)]
    as 'IIF
        (
            IsEmpty(Measures.[Темп роста, %]) or (Measures.[Темп роста, %]) = 0,
            null,
            Measures.[Темп роста, %] - 1
        )'        
    member [Уровни бюджета].[СКИФ].[Бюджет гор.округа, мун.района и поселения] 
    as 'Aggregate
        (
          {
            [Уровни бюджета].[СКИФ].[Бюджет поселения],
            [Уровни бюджета].[СКИФ].[Бюджет гор.округа],
            [Уровни бюджета].[СКИФ].[Бюджет района]
          }
        )'         
    member <%fkr_dimension%>.[Расходы итого ]
    as 'Aggregate 
        (
            {
                Filter 
                (
                    Descendants 
                    (
                        <%fkr_dimension%>.[Все коды ФКР],
                        <%fkr_dimension%>.[Раздел],
                        SELF 
                    ),
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "0"
                    ) and
                    (
                       <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9600"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9700"
                    ) and
                    (
                        <%fkr_dimension%>.CurrentMember.Properties("Код") <> "9800"
                    ) 
                ) 
            } 
        )'      

    member [ТипДокумента].[СКИФ].[Тип документа] 
    as 'IIF  
        (
            IsEmpty 
            (
                (
                    [Measures].[План ],
                    <%document_type%>
                ) 
            ),
            [ТипДокумента].[СКИФ].[Данные конс. отчета субъекта в разрезе городов, районов и поселений (5+6+7+8)],
            <%document_type%>
        )'  
    member [ТипДокумента].[СКИФ].[Собственные отчеты МР и ГО] 
    as '   
      Aggregate
      (
        {
          [ТипДокумента].[СКИФ].[Все].[Собственный отчет городского округа],
          [ТипДокумента].[СКИФ].[Все].[Собственный отчет района]
        }
      )'          
SELECT
    {
        {
            [Measures].[Код],
            [Measures].[План ],
            [Measures].[Факт ],
            [Measures].[Процент исполнения ],
            [Measures].[Ранг процент исполнения],
            [Measures].[Доля],
            [Measures].[Ранг Доля],
            [Measures].[Отклонение (+,-)],
            [Measures].[Темп роста, %],
            [Measures].[Рост (снижение)],
            [Measures].[Худший ранг процент исполнения],
            [Measures].[Худший ранг Доля]   
        }  
    } on columns,
   Filter  
    (
        [РзПр]  ,
        not IsEmpty ( [Measures].[План ] ) or         not IsEmpty ( [Measures].[Факт ] ) 
    ) on rows
FROM  [ФО_МесОтч_Расходы]    
WHERE   
    (
        <%budget_SKIF_level%>,
        [ТипДокумента].[СКИФ].[Тип документа],
        <%selected_region%>,
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>] 
    )   
  ]]>
  </query>

</root>