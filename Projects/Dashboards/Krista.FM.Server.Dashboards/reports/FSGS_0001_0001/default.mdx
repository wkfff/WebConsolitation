<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FSGS_0001_0001_list_of_dates">
    <![CDATA[ -- name: FSGS_0001_0001_list_of_dates
with
member [Measures].[mounth]
as '[Период].[Период].currentmember.parent.name'
member [Measures].[year]
as '[Период].[Период].currentmember.parent.parent.parent.parent.name'
 
select
    {
    [Measures].[mounth],
    [Measures].[year]
    --[Measures].[Цена]
    } on columns,
    {  
        filter
        (
            [Период].[Период].[День].Members,
            [Measures].[Цена] > 0
        )
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        [Продукция].[Сопоставимый].[Все виды продукции]
    )
    ]]>
  </query>

  <query id ="FSGS_0001_0001_list_of_regions">
    <![CDATA[ -- name:FSGS_0001_0001_list_of_regions
with
    member [Measures].[MDX имя]
    as '[Территории].[Сопоставимый].CurrentMember.UniqueName'
    member [Measures].[Имя]
    as '[Территории].[Сопоставимый].CurrentMember.Name'
    member [Measures].[Уровень]
    as '[Территории].[Сопоставимый].CurrentMember.Level.Name'
select
    {
        [Measures].[Имя],
        [Measures].[MDX имя],
        [Measures].[Уровень]
    } on columns,
    {
        filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Субъект РФ],
                SELF_AND_BEFORE
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and ([Measures].[Цена] > 0)
        )
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        [Продукция].[Сопоставимый].[Все виды продукции]
    )
    ]]>
  </query>

  <query id = "FSGS_0001_0001_grid">
    <![CDATA[ -- FSGS_0001_0001_grid
with
    set [Даты]
    as '
    --{<%selectedFirstYearDate%>,
    Tail
        (
        
            filter
            (
                {
                    [Период].[Период].[Данные всех периодов].[1998].[Полугодие 1].[Квартал 1].[Январь].[1] : <%selected_date%>
                },
                (
                    [Продукция].[Сопоставимый].[Все виды продукции],
                    [Measures].[Цена]
                ) > 0 and [Период].[Период].currentmember.name <>"Данные месяца"
            ),
            12
        )
        --}
        '
        
    set [Даты 1.5]
    as 'filter([Даты],
    [Период__Период].[Период__Период].currentmember is <%selectedFirstYearDate%>)'
    
    set [Даты 2]
    as 'iif([Даты 1.5].count > 0,
                     Tail([Даты],13),
     { <%selectedFirstYearDate%>, Tail([Даты],12)})'
        
    set [Показатели]
    as ' except
        (
            filter
            (
                [Продукция].[Сопоставимый].[Все виды продукции].Children,
                [Measures].[Цена] > 0
            ),
            {
                {
                    [Продукция].[Сопоставимый].[Все виды продукции].[Несопоставленные данные],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Дизельное топливо],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки А-76 (АИ-80)],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки АИ-92 (АИ-93 и т.п.)],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки АИ-95 и выше],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Корригирующие очки],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Медицинский термометр ртутный],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Аппарат для измерения артериального давления электронный],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Атенолол, 50 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Эналаприл, 5 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Индапамид, 2,5 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Нитроглицерин, 0,5 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Валидол, 60 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Корвалол, капли],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Винпоцетин, 5 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Метамизол натрия (Анальгин отечественный), 500 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Комбинированные анальгетики],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Дротаверин (Но-шпа), 40 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Ацетилсалициловая кислота (Аспирин отечественный), 500 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Диклофенак, раствор для инъекций, 75 мг, ампула],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Амоксициллин, 500 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Панкреатин, 10 таблеток],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Амброксол, 30 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Супрастин, 25 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Ксилометазолин (Галазолин) 0,1%, капли],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Поливитамины без минералов отечественные],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Поливитамины с макро- и микроэлементами],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Йод],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Адельфан-Эзидрекс],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Гипотиазид, 25 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Верошпирон, 100 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Троксерутин, гель для наружного применения, 2%],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Флуоцинолона ацетонид, мазь для наружного применения, 0,025%],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Лоратадин, 10 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Валокордин, капли],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Настойка пустырника],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Сеннозиды А и B],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бисакодил, 5 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Лоперамид, 2 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Смекта, порошок для приготовления суспензии, 3 г],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Активированный уголь, 250 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Алмагель, суспензия],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Ренни],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Отинум, капли 20%],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Сульфацетамид, капли 20%],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Офтан Катахром, капли глазные],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Тимолол, капли глазные 0,25%],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Колдрекс, порошок для приготовления раствора для приема внутрь, 5 г],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Фалиминт, 25 мг],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Стрепсилс, таблетки для рассасывания],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Гепарин натрия, гель для наружного применения 1000 МЕ/г],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Бинт],
                    [Продукция].[Сопоставимый].[Все виды продукции].[Вата отечественная]
                }
            }
        )  '
    member [Measures].[Текущее значение]
    as '
        (
            [Период].[Период].CurrentMember,
            [Measures].[Цена]
        )'
    member [к началу года]
    as '(iif(
    [Период].[Период].CurrentMember.parent.parent.parent.parent is <%selectedFirstYearDateCompare%>.parent.parent.parent.parent,
    <%selectedFirstYearDateCompare%>,
    <%selectedFirstYearDate%>)
    ,
    [Measures].[Цена])'
    
    member [к предыдущему периоду]
    as '(
            [Measures].[Цена],
            Tail
            (
                filter
                (
                    {
                        [Период].[Период].[Данные всех периодов].[1998].[Полугодие 1].[Квартал 1].[Январь].[1] : [Период].[Период].CurrentMember
                    } -
                    {
                        [Период].[Период].CurrentMember
                    },
                    ( [Measures].[Цена] ) > 0
                )
            ).Item(0)
        )'
        
    member [Measures].[Предыдущее значение]
    as '[<%selectedCompareDate%>]'
    member [Measures].[Отклонение]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Текущее значение]
            ) or
            (
                [Measures].[Текущее значение]
            ) = 0 or IsEmpty
            (
                [Measures].[Предыдущее значение]
            ) or
            (
                [Measures].[Предыдущее значение]
            ) = 0,
            null,
            [Measures].[Текущее значение] - [Measures].[Предыдущее значение]
        )'
    member [Measures].[Темп роста]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Текущее значение]
            ) or
            (
                [Measures].[Текущее значение]
            ) = 0 or IsEmpty
            (
                [Measures].[Предыдущее значение]
            ) or
            (
                [Measures].[Предыдущее значение]
            ) = 0,
            null,
            [Measures].[Текущее значение] / [Measures].[Предыдущее значение]  - 1
        )'
    member [Период].[Период].[Единица измерения]
    as '[Продукция].[Сопоставимый].CurrentMember.Properties("Единица измерения")'
    member [Период].[Период].[Уникальное имя]
    as '[Продукция].[Сопоставимый].CurrentMember.UniqueName'
    member [Measures].[Дата]
    as '[Период].[Период].CurrentMember.UniqueName'
select
    {
        {
            [Период].[Период].[Единица измерения]
        } + [Даты 2] +
        {
            [Период].[Период].[Уникальное имя]
        }
    } on columns,
    {
        {
            {
                [Продукция].[Сопоставимый].[Все виды продукции]
            }
            * {[Дата]}
        } +
        {
            [Показатели]
            *
            {
                [Measures].[Текущее значение],
                [Measures].[Отклонение],
                [Measures].[Темп роста]
            }
        }
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        <%selected_region%>
    )
    ]]>
  </query>

  <query id = "FSGS_0001_0001_chart1">
    <![CDATA[ -- FSGS_0001_0001_chart1
with
    set [Даты]
    as 'Tail
        (
            filter
            (
                {
                    [Период].[Период].[Данные всех периодов].[1998].[Полугодие 1].[Квартал 1].[Январь].[1] : <%selected_date%>
                },
                (
                    [Продукция].[Сопоставимый].[Все виды продукции],
                    [Measures].[Цена]
                ) > 0
            ),
            64
        )'
    set [Показатели]
    as 'filter
        (
            [Продукция].[Сопоставимый].[Все виды продукции].Children, [Measures].[Цена] > 0
        )'
    member [Территории].[Сопоставимый].[Дата]
    as '[Период].[Период].CurrentMember.UniqueName'
    member [Период].[Период].[Территория]
    as '[Территории].[Сопоставимый].CurrentMember.Name'
select
    {
        [Территории].[Сопоставимый].[Дата],
        <%regions_for_chart%>
    } on columns,
    {{[Период].[Период].[Территория]} + [Даты]} on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        <%selected_food%>,
        [Measures].[Цена]
    )    
    ]]>
  </query>

</root>