<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0001_0015_date">
    <![CDATA[
-- FK_0001_0015_date 
-- <#[ФК_МесОтч_Доходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Доходы]
]]>
  </query>

  <query id="FK_0001_0015_grid1">
    <![CDATA[
-- FK_0001_0015_grid1
-- <#[ФК_МесОтч_Дефицит Профицит]#>
With    
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--    
    set [Субъекты]    
    as 'Filter    
        (
            Descendants    
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация]<%selected_fo%>,
                [Территории].[Сопоставимый].[Субъект РФ],
                SELF    
            ),
            not    
            (
                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember    
            ) and not IsEmpty([Measures].CurrentMember)    
        )'    
    member [Территории].[Сопоставимый].[Дефицитные]    
    as 'Count    
        (
            Filter    
            (
                [Субъекты],
                [Measures].CurrentMember < 0    
            )    
        )'    
    member [Территории].[Сопоставимый].[Профицитные]    
    as 'Count    
        (
            Filter    
            (
                [Субъекты],
                [Measures].CurrentMember > 0    
            )    
        )'    
    member [Территории].[Сопоставимый].[Сбалансированные]    
    as 'Count    
        (
            Filter    
            (
                [Субъекты],
                [Measures].CurrentMember = 0    
            )    
        )'    
    member [Территории].[Сопоставимый].[Количество бюджетов субъектов, всего]    
    as '[Территории].[Сопоставимый].[Дефицитные] + [Территории].[Сопоставимый].[Профицитные] + [Территории].[Сопоставимый].[Сбалансированные] '     
    member [Территории].[Сопоставимый].[Объем профицита, млн.руб.]    
    as 'Sum    
        (
            Filter    
            (
                [Субъекты],
                [Measures].CurrentMember > 0    
            ),
            [Measures].CurrentMember    
        ) / 1000000'    
    member [Территории].[Сопоставимый].[Объем дефицита, млн.руб.]    
    as 'Sum    
        (
            Filter    
            (
                [Субъекты],
                [Measures].CurrentMember < 0    
            ),
            [Measures].CurrentMember    
        ) / 1000000'    
    member [Территории].[Сопоставимый].[Дефицитные Стр]
    as 'IIF
        (
            Count
            (
                Filter
                (
                    [Субъекты],
                    [Measures].CurrentMember < 0
                )
            ) > 10,
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember < 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            ) + "...",
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember < 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            )
        ) '
   member [Территории].[Сопоставимый].[Профицитные Стр]
   as 'IIF
        (
            Count
            (
                Filter
                (
                    [Субъекты],
                    [Measures].CurrentMember > 0
                )
            ) > 10,
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember > 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            ) + "...",
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember > 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            )
        ) '
    member [Территории].[Сопоставимый].[Сбалансированные Стр]
    as 'IIF
        (
            Count
            (
                Filter
                (
                    [Субъекты],
                    [Measures].CurrentMember = 0
                )
            ) > 10,
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember = 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            ) + "...",
            Generate
            (
                Head
                (
                    Filter
                    (
                        [Субъекты],
                        [Measures].CurrentMember = 0
                    ),
                    10
                ),
                [Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование"),
                ", "
            )
        ) '
    member [Measures].[Назначено Стр]
    as 'IIF
        (
            [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Дефицитные],
            ([Территории].[Сопоставимый].[Дефицитные Стр], [Measures].[Назначено]),
            IIF
            (
                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Профицитные],
                ([Территории].[Сопоставимый].[Профицитные Стр], [Measures].[Назначено]),
                IIF
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Сбалансированные],
                    ([Территории].[Сопоставимый].[Сбалансированные Стр], [Measures].[Назначено]),
                    null
                )
            )
       )'
    member [Measures].[Исполнено Стр]
    as 'IIF
        (
            [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Дефицитные],
            ([Территории].[Сопоставимый].[Дефицитные Стр], [Measures].[Исполнено]),
            IIF
            (
                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Профицитные],
                ([Территории].[Сопоставимый].[Профицитные Стр], [Measures].[Исполнено]),
                IIF
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].[Сбалансированные],
                    ([Территории].[Сопоставимый].[Сбалансированные Стр], [Measures].[Исполнено]),
                    null
                )
            )
       )'
Select
    {
        [Measures].[Назначено],        
        [Measures].[Исполнено],
        [Measures].[Назначено Стр],
        [Measures].[Исполнено Стр]
    } on columns,
    Filter
    (
     {
        [Территории].[Сопоставимый].[Количество бюджетов субъектов, всего],
        [Территории].[Сопоставимый].[Дефицитные],
        [Территории].[Сопоставимый].[Профицитные],
        [Территории].[Сопоставимый].[Сбалансированные],
        [Территории].[Сопоставимый].[Объем профицита, млн.руб.],
        [Территории].[Сопоставимый].[Объем дефицита, млн.руб.]    
     },
        not 
        (
            IsEmpty 
            (
                (
                    [Measures].[Назначено],
                    [Территории].[Сопоставимый].[Объем профицита, млн.руб.] 
                ) 
            ) and IsEmpty 
            (
                (
                    [Measures].[Исполнено],
                    [Территории].[Сопоставимый].[Объем профицита, млн.руб.] 
                ) 
            ) and IsEmpty 
            (
                (
                    [Measures].[Назначено],
                    [Территории].[Сопоставимый].[Объем дефицита, млн.руб.] 
                ) 
            ) and IsEmpty 
            (
                (
                    [Measures].[Исполнено],
                    [Территории].[Сопоставимый].[Объем дефицита, млн.руб.] 
                ) 
            )
        ) 
   )     on rows    
From [ФК_МесОтч_Дефицит Профицит]    
Where    
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[<%selected_budget_level%>]    
    )    
  ]]>
  </query>

  <query id="FK_0001_0015_grid2">
    <![CDATA[
-- FK_0001_0015_grid2
-- <#[ФК_МесОтч_Дефицит Профицит]#>
With     
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--    
    set [Субъекты]     
    as 'Filter     
        (
            Generate     
            (
                Descendants     
                (
                    [Территории].[Сопоставимый].[Все территории].[Российская  Федерация]<%selected_fo%>,
                    [Территории].[Сопоставимый].[Федеральный округ],
                    SELF     
                ),
                {
                    [Территории].[Сопоставимый].CurrentMember     
                } +  Descendants     
                (
                    [Территории].[Сопоставимый].CurrentMember,
                    [Территории].[Сопоставимый].[Субъект РФ],
                    SELF     
                )     
            ),
           not  
            (
                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember  
            ) and not IsEmpty  
            (
                (
                    [Measures].CurrentMember,
                    [КД].[Сопоставимый].[Все коды доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ] 
                )  
            ) and not IsEmpty
            (
                (
                    [Measures].CurrentMember,
                    [КД].[Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ]
                )
            )   
        )'     
    member [КД].[Сопоставимый].[Доходы итого]     
    as '     
        (
            [Measures].CurrentMember,
            [КД].[Сопоставимый].[Все коды доходов].[Доходы - всего в том числе:]     
        )'     
    member [КД].[Сопоставимый].[Налоговые и неналоговые доходы ]     
    as '[КД].[Сопоставимый].[Все коды доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ]'     
    member [КД].[Сопоставимый].[Расходы итого]     
    as 'LookupCube     
        (
            "[ФК_МесОтч_Расходы]",
            "     
            (
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
                " + MemberToStr     
                (
                    [Территории].[Сопоставимый].CurrentMember     
                ) + ",
                " + MemberToStr     
                (
                    [Период].[Период].CurrentMember     
                ) + ",
                " + MemberToStr     
                (
                    [Уровни бюджета].[СКИФ].CurrentMember     
                ) + ",
                " + MemberToStr  ( Measures.CurrentMember ) + "     
            )"     
        )  '     
    member [КД].[Сопоставимый].[Объем дефицита(-) / профицита(+)]     
    as 'LookupCube     
        (
            "[ФК_МесОтч_Дефицит Профицит]",
            "     
            (
                " + MemberToStr     
                (
                    [Территории].[Сопоставимый].CurrentMember     
                ) + ",
                " + MemberToStr     
                (
                    [Период].[Период].CurrentMember     
                ) + ",
                " + MemberToStr     
                (
                    [Уровни бюджета].[СКИФ].CurrentMember     
                ) + ",
                " + MemberToStr ( Measures.CurrentMember ) + "     
            )"     
        )'     
    member [Measures].[ФО]     
    as 'IIF     
        (
            [Территории].[Сопоставимый].CurrentMember.Level is [Территории].[Сопоставимый].[Субъект РФ],
            [Территории].[Сопоставимый].CurrentMember.Parent.Properties("Сокращенное наименование"),
            " "     
        )'     
    member [Measures].[Процент исполнения]     
    as 'IIF     
        (
            IsEmpty     
            (
                (
                    [КД].[Сопоставимый].CurrentMember,
                    [Measures].[Назначено]     
                )     
            ) or     
            (
                [КД].[Сопоставимый].CurrentMember,
                [Measures].[Назначено]     
            ) = 0,
            null,
            (
                [КД].[Сопоставимый].CurrentMember,
                [Measures].[Исполнено]     
            ) /     
            (
                [КД].[Сопоставимый].CurrentMember,
                [Measures].[Назначено]     
            )     
        )'
    member Measures.[Исполнено или назначено] 
    as 'IIF 
        (
            not IsEmpty([Measures].[<%selected_measure%>]),
            [Measures].[<%selected_measure%>] / 1000000,
            null
        )' 
    member Measures.[Ранг по дефициту]
    as 'null'
    member Measures.[Худший ранг по дефициту]     
    as 'null'
Select
    {
        {
            [КД].[Сопоставимый].[Все коды доходов]     
        }     
        * {[Measures].[ФО]} +     
        {
            [КД].[Сопоставимый].[Доходы итого],
            [КД].[Сопоставимый].[Налоговые и неналоговые доходы ],
            [КД].[Сопоставимый].[Расходы итого]     
        }     
        *     
        {
            Measures.[Исполнено или назначено] ,
            [Measures].[Темп роста к аналогичному периоду предыдущего года_<%selected_measure%>]/*,
            [Measures].[Процент исполнения]     */
            <%percent_performance%>
        } +     
        {
            [КД].[Сопоставимый].[Объем дефицита(-) / профицита(+)]       
        }     
        *     
        {
            Measures.[Исполнено или назначено] ,
            [Measures].[Ранг по дефициту],
            [Measures].[Худший ранг по дефициту]
        }
    } on columns,
    { [Субъекты] }  on rows     
From [ФК_МесОтч_Доходы]     
Where     
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[<%selected_budget_level%>]     
    )     
  ]]>
  </query>

  <query id="FK_0001_0015_chart">
    <![CDATA[
-- FK_0001_0015_chart
-- <#[ФК_МесОтч_Дефицит Профицит]#>
With        
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--    
    set [Субъекты]        
    as 'Filter        
        (
            Generate        
            (
                Descendants        
                (
                    [Территории].[Сопоставимый].[Все территории].[Российская  Федерация]<%selected_fo%>,
                    [Территории].[Сопоставимый].[Федеральный округ],
                    SELF        
                ),
                Descendants        
                (
                    [Территории].[Сопоставимый].CurrentMember,
                    [Территории].[Сопоставимый].[Субъект РФ],
                    SELF        
                )        
            ),
             not  
            (
                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember  
            ) and not IsEmpty  
            (
                (
                    [Measures].CurrentMember,
                    [КД].[Сопоставимый].[Все коды доходов].[НАЛОГОВЫЕ И НЕНАЛОГОВЫЕ ДОХОДЫ] 
                )  
            ) and not IsEmpty
            (
                (
                    [Measures].CurrentMember,
                    [КД].[Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ]
                )
            )         
        )'         
    member [КД].[Сопоставимый].[Объем дефицита(-)/профицита(+)]        
    as 'LookupCube        
        (
            "[ФК_МесОтч_Дефицит Профицит]",
            "        
            (
                " + MemberToStr        
                (
                    [Территории].[Сопоставимый].CurrentMember        
                ) + ",
                " + MemberToStr        
                (
                    [Период].[Период].CurrentMember        
                ) + ",
                " + MemberToStr        
                (
                    [Уровни бюджета].[СКИФ].CurrentMember        
                ) + ",
                " + MemberToStr ( Measures.CurrentMember ) + "        
            )"        
        ) / 1000000'    
    member Measures.[Другая мера]
    as 'IIF 
        (
            [Measures].[<%selected_measure%>] is [Measures].[Назначено], 
            [Measures].[Исполнено],
            [Measures].[Назначено] 
         )'
Select
    {
        {[КД].[Сопоставимый].[Объем дефицита(-)/профицита(+)] } * {[Measures].[<%selected_measure%>], Measures.[Другая мера]}
    } on columns,
    {
        Order 
        (
            [Субъекты],
            ([КД].[Сопоставимый].[Объем дефицита(-)/профицита(+)], [Measures].[<%selected_measure%>]),
            BDESC 
        ) 
    }  on rows  
From [ФК_МесОтч_Доходы]        
Where        
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[<%selected_budget_level%>]
    )        
  ]]>
  </query>

</root>