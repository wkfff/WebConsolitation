<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FO_0042_0004_Omsk_date">
    <![CDATA[
-- FO_0042_0004_Omsk_date
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                Descendants
                (
                    [Период].[Период].[Данные всех периодов],
                    [Период].[Период].[Год],
                    SELF
                ),
                not IsEmpty
                (
                    (
                        [Measures].[Значение],
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели]
                    )
                ) and
                StrToValue([Период].[Период].CurrentMember.Properties("PKID")) > 0
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_Оценка качества ФМ_Показатели]
]]>
</query>

  <query id="FO_0042_0004_Omsk_grid">
<![CDATA[
-- FO_0042_0004_Omsk_grid
with    
    set [Администраторы]   
    as 'Filter  
        (
            {
                Descendants  
                (
                    [Администратор].[Сопоставим].[Все администраторы],
                    [Администратор].[Сопоставим].[Администратор],
                    SELF   
                ) - 
                {
                    [Администратор].[Сопоставим].[Все администраторы].[Несопоставленные данные]
                } 
            },
            not IsEmpty   
            (
                (
                    [Measures].[Взвешенное значение],
                    [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>]
                )   
            )  and
            not IsEmpty   
            (
                (
                    [Measures].[Взвешенное значение],
                    [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>]
                )   
            )  
        )'   
        
    member [Администратор].[Сопоставим].[Аггрегированные администраторы]
    as 'Aggregate({[Администраторы]})'
        
    set [Показатели для оценки]    
    as 'Order
        (
            Filter    
            (
                {
                    Descendants    
                    (
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели],
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Показатели 1],
                        SELF    
                    ) -    
                    {
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Несопоставленные данные],
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Оценка качества финансового менеджмента]    
                    }
                },
                not    
                (
                    [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Parent.DataMember    
                ) and
                (InStr([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Обозначение"), "Рейтинг") = 0) and
                (InStr([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Обозначение"), "Р") > 0)
            ),
            StrToValue([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Код"))
        )'     
    set [Показатели для значения]    
    as 'Order
        (
            Filter    
            (
                {
                    Descendants    
                    (
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели],
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Показатели 1],
                        SELF    
                    ) -    
                    {
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Несопоставленные данные]    
                    }    
                },
                not    
                (
                    [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Parent.DataMember    
                ) and
                (InStr([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Обозначение"), "Рейтинг") = 0) and
                (InStr([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Обозначение"), "Р") > 0)    
            ),
            StrToValue([Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Код"))
        )'     
    member [Показатели].[Оценка качества ФМ_Сопоставимый].[Аггрегированные показатели]    
    as 'Aggregate({ [<%indicator_set%>] })'    
    member [Показатели].[Оценка качества ФМ_Сопоставимый].[Код ГРБС]    
    as '[Администратор].[Сопоставим].CurrentMember.Properties("Код")'    
    member [Показатели].[Оценка качества ФМ_Сопоставимый].[Наименование ГРБС]    
    as '[Администратор].[Сопоставим].CurrentMember.Name'    
    member [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов]    
    as '[Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Оценка качества финансового менеджмента]'    
    
    member [Показатели].[Оценка качества ФМ_Сопоставимый].[№ п/п]  
    as '0'  
    
    member [Measures].[Оценка показателя ]    
    as 'IIF
       (
          [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов],
          100 * [Measures].[Оценка показателя],
          [Measures].[Оценка показателя]
       )'     

    member [Период].[Период].[Прошлый год]
    as 'IIF
        (
            (
                ([Measures].[Применим ли в оценке], [Период].[Период].[Данные всех периодов].[<%period_last_year%>]) = 0
            ) and not
            (
                [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов]
            ),
            -100500,
            ([Measures].[<%selected_maasure%>],[Период].[Период].[Данные всех периодов].[<%period_last_year%>])
        )'

    member [Период].[Период].[Текущий год]
    as 'IIF
        (
            (
                ([Measures].[Применим ли в оценке], [Период].[Период].[Данные всех периодов].[<%period_year%>]) = 0
            ) and not
            (
                [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов]
            ),
            -100500,
            ([Measures].[<%selected_maasure%>], [Период].[Период].[Данные всех периодов].[<%period_year%>] )
        )'
        
    member [Период].[Период].[Отклонение]
    as 'IIF
        (
            IsEmpty
            (
                [Период].[Период].[Текущий год]
            ) or
            (
                [Период].[Период].[Текущий год]
            ) = -100500 or
            IsEmpty
            (
                [Период].[Период].[Прошлый год]
            ) or
            (
                [Период].[Период].[Прошлый год]
            ) = -100500,
            null,
            (
                [Период].[Период].[Текущий год]
            ) -
            (
                [Период].[Период].[Прошлый год]
            )
        )'


    set [Периоды]  
    as '  
        {
            [Период].[Период].[Прошлый год],
            [Период].[Период].[Текущий год]
        }' 
        
        

select
    (
        {
            {
                [Показатели].[Оценка качества ФМ_Сопоставимый].[№ п/п],
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Код ГРБС],
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Наименование ГРБС]    
            }
            *
            {
                [Период].[Период].[Данные всех периодов].[<%period_year%>]
            }
        } + 
        {
            {
                Filter   
                (
                    {
                        [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов]    
                    } + [<%indicator_set%>],
                    not IsEmpty(([Администратор].[Сопоставим].[Аггрегированные администраторы], [Период].[Период].[Отклонение])) and
                    IIF    
                    (
                        [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].[Итоговая оценка качества финансового менеджмента, осуществляемого ГРБС, процентов],
                        [Measures].[<%selected_maasure%>] is [Measures].[Оценка показателя ],
                        true    
                    )    
                )   
            }   
            *   
            {
                [Периоды] +   
                {
                    [Период].[Период].[Отклонение]   
                }    
            } 
        } 
    )  on columns,
    { [Администраторы] } on rows    
from [ФО_Оценка качества ФМ_Показатели]                    
  ]]>
</query>

  <query id="FO_0042_0004_Omsk_indicatorDescription">
    <![CDATA[
-- FO_0042_0004_Omsk_indicatorDescription
With   
    set [Показатели]   
    as 'Filter   
        (
            Descendants   
            (
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели],
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Показатели 1],
                SELF   
            ) -   
            {
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Несопоставленные данные],
                [Показатели].[Оценка качества ФМ_Сопоставимый].[Все показатели].[Оценка качества финансового менеджмента]  
            },
            not   
            (
                [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember is [Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Parent.DataMember   
            )   
        ) '   
    member [Measures].[Единицы измерения]   
    as '[Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Единицы измерения")'   
    member [Measures].[Обозначение]   
    as '[Показатели].[Оценка качества ФМ_Сопоставимый].CurrentMember.Properties("Обозначение")'       
Select
    {
        [Measures].[Единицы измерения],
        [Measures].[Обозначение]
    } on columns,
    { [Показатели] } on rows   
From [ФО_Оценка качества ФМ_Показатели]   
  ]]>
  </query>  
  
</root>