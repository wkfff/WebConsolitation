<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="last_date">
    <![CDATA[ -- name: last_date  
      select
          { [Measures].[Цена] } on columns,
          {
              Tail 
              (
                  Filter 
                  (
                      [Период].[День].[День].Members,
                      [Measures].[Цена] > 0 
                  ) 
              ).Item(0) 
          } DIMENSION PROPERTIES MEMBER_UNIQUE_NAME on rows 
      from [ОРГАНИЗАЦИИ_Цены и тарифы] 
      where 
          (
              [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
              [Организации].[Предприятия производители].[Все организации].[Значение не указано],
              [Организации].[Тип цены].[Все типы цен].[Розничная цена],
              <%current_region%> 
          )          
	  ]]>
  </query>
  <query id="grid_master">
    <![CDATA[ -- name: grid_master
      with 
          member [Measures].[Среднее] 
          as  'AVG 
              (
                  [Организации].[Предприятия торговли].[Все организации].Children,
                  [Measures].[Цена] 
              )'
      select
          {[Measures].[Среднее]} on columns,
          non empty Except 
          (
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].children 
              },
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].DataMember 
              } 
          ) on rows 
      from [ОРГАНИЗАЦИИ_Цены и тарифы] 
      where 
          (
              [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
              [Организации].[Предприятия производители].[Все организации].[Значение не указано],
              [Организации].[Тип цены].[Все типы цен].[Розничная цена],
              <%last_date%>,
              <%current_region%> 
          ) 
    ]]>
  </query>
  <query id="grid_detail">
    <![CDATA[ -- name: grid_detail
      select
          { [Measures].[Цена] } on columns,
          NON EMPTY CrossJoin 
          (
              Except 
              (
                  {
                      [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].children 
                  },
                  {
                      [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].DataMember 
                  } 
              ),
              {
                  [Организации].[Предприятия торговли].[Все организации].children 
              } 
          )  on rows 
      from [ОРГАНИЗАЦИИ_Цены и тарифы] 
      where 
          (
              [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
              [Организации].[Предприятия производители].[Все организации].[Значение не указано],
              [Организации].[Тип цены].[Все типы цен].[Розничная цена],
              <%last_date%>,
              <%current_region%> 
          )       
    ]]>
  </query>
  <query id="chart">
    <![CDATA[ -- name: chart   
      select
          non empty Filter  
          (
              {
                  <%last_date%>: <%last_date%>.Lag(91)   
              },
              [Measures].[Цена] > 0   
          ) on columns,
          non empty Except  
          (
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].children   
              },
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].DataMember   
              }   
          ) on rows   
      from [ОРГАНИЗАЦИИ_Цены и тарифы]   
      where   
          (
              [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
              [Организации].[Предприятия производители].[Все организации].[Значение не указано],
              [Организации].[Тип цены].[Все типы цен].[Розничная цена],
              <%current_region%>,
              <%seller_name%>
          )            
	  ]]>
  </query>
  <query id="grid_chart">
    <![CDATA[ -- name: grid_chart  
      select
          non empty  
          {
              [Организации].[Предприятия торговли].[Все организации].children  
          } on rows,
          non empty Except  
          (
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].children  
              },
              {
                  [Организации].[Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].DataMember  
              }  
          )  on columns  
      from [ОРГАНИЗАЦИИ_Цены и тарифы]  
      where  
          (
              [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
              [Организации].[Предприятия производители].[Все организации].[Значение не указано],
              [Организации].[Тип цены].[Все типы цен].[Розничная цена],
              <%current_region%>,
              <%last_date%>,
              [Measures].[Цена] 
          )       
    ]]>
  </query>
</root>