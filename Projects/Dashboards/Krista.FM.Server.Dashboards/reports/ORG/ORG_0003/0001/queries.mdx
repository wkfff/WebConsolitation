<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="get_dates">
    <![CDATA[ -- name: get_dates
select
    {[Measures].[Средняя цена]} on columns,
    NON EMPTY {
        Order
        (
            {
                filter
                (
                    [Период].[День].members,
                    [Measures].[Средняя цена] > 0
                )
            },
            ([Период].[День]),
            asc
        )
    } on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        <%current_region%>,
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары] 
    )
    ]]>
  </query>

  <query id="last_date">
    <![CDATA[ -- name: last_date   
select
    { [Measures].[Средняя цена] } on columns,
    {
        Tail  
        (
            Filter  
            (
                [Период].[День].[День].Members,
                [Measures].[Средняя цена]>0  
            )  
        ).Item(0)  
    } DIMENSION PROPERTIES MEMBER_UNIQUE_NAME on rows  
from [ОРГАНИЗАЦИИ_Цены и тарифы]  
where  
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%current_region%>,
        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары]  
    )      
	  ]]>
  </query>

  <query id="prev_date">
    <![CDATA[ -- name: prev_date
select
    { [Measures].[Средняя цена] } on columns,
    {
        Tail
        (
            Filter
            (
                [Период].[День].[День].Members,
                [Measures].[Средняя цена]>0
            ), 3
        )
    } DIMENSION PROPERTIES MEMBER_UNIQUE_NAME on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]  
where  
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%current_region%>,
        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары]  
    )      
	  ]]>
  </query>

  <query id="new_grid">
    <![CDATA[ -- name: new_grid
select
    NON EMPTY CrossJoin({[Measures].[Средняя цена]},
        {Tail(
                Filter
                (
                    {<%on_date%>: <%first_date%>},
                    [Measures].[Средняя цена] > 0
                ),
                <%count_grid%>)
        }) on columns,
    NON EMPTY 
    {
        Descendants
        (
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
            [Уровень 3]
        )  
    } Dimension properties [Организации].[Товары и услуги].[Единица измерения] on rows 
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%current_region%>
    )
    ]]>
      </query>

      <query id="new_grid_month">
    <![CDATA[ -- name: new_grid_month
select
    NON EMPTY CrossJoin    
    (
        {[Measures].[Средняя цена]},
        {
        <%dates%>
        }        
    ) on columns,
    NON EMPTY 
    {
        Descendants
        (
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
            [Уровень 3]
        )  
    } Dimension properties [Организации].[Товары и услуги].[Единица измерения] on rows 
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%current_region%>
    )
    ]]>
  </query>

  <query id="grid">
    <![CDATA[ -- name: grid
      select
        { [Measures].[Средняя цена] } on columns,
        {
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Мясо].[Говядина на кости],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Мясо].[Кура-тушка 1 категории],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Мясо].[Колбаса вареная типа в/c (Русская, Любительская)],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Масло сливочное коровье (жир не менее 72%)],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Масло подсолнечное, рафинированное отечественное],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Молоко цельное разл. (3,2 % жирности.)],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Творог 5% жирности],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Кефир],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Молочная продукция].[Сыр "Российский", твердый],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Прочие продовольственные товары].[Яйцо куриное столовое диетическое],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Зерно, мука, хлеб].[Хлеб ржано-пшеничный],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Овощи].[Картофель свежий продовольственный 1кл],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Зерно, мука, хлеб].[Мука пшеничная в/с],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Прочие продовольственные товары].[Сахарный песок весовой],
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары].[Прочие продовольственные товары].[Соль поваренная, пищевая]
        } Dimension properties [Организации].[Товары и услуги].[Единица измерения] on rows
    from [ОРГАНИЗАЦИИ_Цены и тарифы]
    where
        (
            [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
            [Организации].[Предприятия производители].[Все организации].[Значение не указано],
            [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
            [Организации].[Тип цены].[Все типы цен].[Розничная цена],
            <%on_date%>,
            <%current_region%>
        ) 
    ]]>
  </query>

  <query id="new_chart">
    <![CDATA[ -- name: new_chart
select
    Tail
    (
        Filter
        (
            { <%on_date%>: <%first_date%> },
            [Measures].[Средняя цена]>0
        ),
        <%count_chart%>
    ) on columns,
    {[Measures].[Средняя цена]} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%food_stuff%>,
        <%current_region%>
    )
    ]]>
  </query>

  <query id="new_chart_month">
    <![CDATA[ -- name: new_chart_month
select
NON EMPTY Filter({<%dates_chart%>}, [Measures].[Средняя цена] > 0) on columns,
    {[Measures].[Средняя цена]} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации].[Предприятия производители].[Все организации].[Значение не указано],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%food_stuff%>,
        <%current_region%>
    )
    ]]>
  </query>
</root>