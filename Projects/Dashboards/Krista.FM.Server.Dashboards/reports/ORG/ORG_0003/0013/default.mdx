<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="ORG_0003_0013_list_of_dates">
    <![CDATA[ -- name: ORG_0003_0013_list_of_dates
select
    filter
    (
        except
        (
            {
                [Территории].[РФ].[Все территории].[Российская Федерация].[Северо-Западный федеральный округ].[Вологодская область].[Вологодская область].Children
            },
            {
                [Территории].[РФ].[Все территории].[Российская Федерация].[Северо-Западный федеральный округ].[Вологодская область].[Вологодская область].DataMember
            }
        ),
        (
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
            [Measures].[Средняя цена]
        ) > 0
    ) on columns,
    {
        filter
        (
            [Период].[День].[День].members,
            [Measures].[Средняя цена] > 0
        )
    } on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where 
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - МО Вологодской области],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
        [Measures].[Средняя цена]
    )
    ]]>
  </query>

  <query id ="ORG_0003_0013_list_of_regions">
    <![CDATA[ -- name:ORG_0003_0013_list_of_regions
select
    {[Measures].[Средняя цена]} on columns,
    filter
    (
        except
        (
            {
                [Территории].[РФ].[Все территории].[Российская Федерация].[Северо-Западный федеральный округ].[Вологодская область].[Вологодская область].Children
            },
            {
                [Территории].[РФ].[Все территории].[Российская Федерация].[Северо-Западный федеральный округ].[Вологодская область].[Вологодская область].DataMember
            }
        ),
        (
            [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
            [Measures].[Средняя цена]
        ) > 0
    ) on rows 
from [ОРГАНИЗАЦИИ_Цены и тарифы] 
where 
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - МО Вологодской области],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары] 
    )
    ]]>
  </query>

  <query id = "ORG_0003_0013_grid">
    <![CDATA[ -- ORG_0003_0013_grid
with
    set [Даты]
    as 'Tail
        (
            filter
            (
                {
                    <%first_date%>: <%selected_date%>
                },
                (
                    [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
                    [Measures].[Средняя цена]
                ) > 0
            ),
            12
        )'
    set [Показатели]
    as 'filter
        (
            descendants
            (
                [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
                [Организации].[Товары и услуги].[Уровень 3]
            ),
            [Measures].[Средняя цена] > 0
        )'
    member [Measures].[Текущее значение]
    as '
        (
            [Measures].[Средняя цена],
            [Период].[День].CurrentMember
        )'
    member [Measures].[Предыдущее значение]
    as '
        (
            [Measures].[Средняя цена],
            Tail
            (
                filter
                (
                    {
                        <%first_date%> : [Период].[День].CurrentMember
                    } - {[Период].[День].CurrentMember},
                    (
                        [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары],
                        [Measures].[Средняя цена]
                    ) > 0
                )
            ).Item(0)
        )'
    member [Measures].[Отклонение]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Текущее значение]
            ) or
            (
                [Measures].[Текущее значение]
            ) = 0 or
            IsEmpty
            (
                [Measures].[Предыдущее значение]
            ) or
            (
                [Measures].[Предыдущее значение]
            ) = 0,
            null,
            [Measures].[Текущее значение] - [Measures].[Предыдущее значение]
        )'
    member [Measures].[Темп роста]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Текущее значение]
            ) or
            (
                [Measures].[Текущее значение]
            ) = 0 or
            IsEmpty
            (
                [Measures].[Предыдущее значение]
            ) or
            (
                [Measures].[Предыдущее значение]
            ) = 0,
            null,
            [Measures].[Текущее значение] / [Measures].[Предыдущее значение]  - 1
        )'
    member [Measures].[UniqName]
    as '[Период].[День].CurrentMember.UniqueName'
    member [Период].[День].[Единица измерения]
    as '[Организации].[Товары и услуги].Properties("Единица измерения")'
    member [Период].[День].[Уникальное имя]
    as '[Организации].[Товары и услуги].CurrentMember.UniqueName'
select
    {[Даты] + {[Период].[День].[Единица измерения], [Период].[День].[Уникальное имя]}} on columns,
    {
        {
            {
                [Организации].[Товары и услуги].[Все товары и услуги].[Продовольственные товары]
            }
            *{[Measures].[UniqName]}
        } +
        {
            [Показатели]
            *
            {
                [Measures].[Текущее значение],
                [Measures].[Отклонение],
                [Measures].[Темп роста]
            }
        }
    } on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - МО Вологодской области],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%selected_region%>
    )
    ]]>
  </query>

  <query id = "ORG_0003_0013_chart1">
    <![CDATA[ -- ORG_0003_0013_chart1
select
    Tail
    (
        Filter
        (
            { <%first_date%> : <%selected_date%> },
            [Measures].[Средняя цена] > 0
        ),
        12
    ) on columns,
    {[Measures].[Средняя цена]} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - МО Вологодской области],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%selected_region%>,
        <%selected_food%>
    )
    ]]>
  </query>

  <query id = "ORG_0003_0013_chart1_names">
    <![CDATA[ -- ORG_0003_0013_chart1_names
with
member [Measures].[День]
as '[Период].[День].CurrentMember.UniqueName'
select
    Tail
    (
        Filter
        (
            { <%first_date%> : <%selected_date%> },
            [Measures].[Средняя цена] > 0
        ),
        12
    ) on columns,
    {[Measures].[День]} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - МО Вологодской области],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%selected_region%>,
        <%selected_food%>
    )
    ]]>
</query>

  <query id = "ORG_0003_0013_chart_by_previous_month">
    <![CDATA[ -- ORG_0003_0013_chart_by_previous_month
with 
    member Measures.[Цена (без учета прироста)]
    as 'IIF
        (
            Measures.[Снижение цены] < 0,
            (
                [Measures].[Средняя цена],
                <%previous_date%>
            ) - Measures.[Снижение цены ],
            (
                [Measures].[Средняя цена],
                <%previous_date%>
            )
        )'
    member Measures.[Цена на предыдущий период]
    as '
        (
            [Measures].[Средняя цена],
            <%previous_date%>
        )'
    member Measures.[Цена на текущий период] 
    as ' 
        (
            [Measures].[Средняя цена],
            <%selected_date%>
        )' 
    member Measures.[Отклонение цены] 
    as 'IIF 
        (
            IsEmpty 
            (
                Measures.[Цена на текущий период] 
            ),
            null,
            Measures.[Цена на текущий период] - Measures.[Цена на предыдущий период] 
        )' 
    member Measures.[Прирост цены, входящий в состав текущей цены] 
    as 'IIF 
        (
            (Measures.[Отклонение цены]) > 0,
            Measures.[Отклонение цены],
            null 
        )' 
    member Measures.[Снижение цены] 
    as 'IIF 
        (
            (Measures.[Отклонение цены]) < 0,
            Measures.[Отклонение цены],
            null
        )' 
    member Measures.[Снижение цены ]
    as 'IIF
        (
            (Measures.[Отклонение цены]) < 0,
            -Measures.[Отклонение цены],
            null
        )'
select
    Filter ({
        Measures.[Цена (без учета прироста)],
        Measures.[Прирост цены, входящий в состав текущей цены],
        Measures.[Снижение цены ]
    }, Measures.[Цена (без учета прироста)] > 0) on columns,
    {<%all_regions%>} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - Вологдастат],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%selected_food%>
    )
    ]]>
  </query>

  <query id = "ORG_0003_0013_chart_by_start_year">
    <![CDATA[ -- ORG_0003_0013_chart_by_start_year
with 
    member Measures.[Цена (без учета прироста)]
    as 'IIF
        (
            Measures.[Снижение цены] < 0,
            (
                [Measures].[Средняя цена],
                <%year_date%>
            ) - Measures.[Снижение цены ],
            (
                [Measures].[Средняя цена],
                <%year_date%>
            )
        )'
    member Measures.[Цена на начало года]
    as '
        (
            [Measures].[Средняя цена],
            <%year_date%>
        )'
    member Measures.[Цена на текущий период] 
    as ' 
        (
            [Measures].[Средняя цена],
            <%selected_date%>
        )' 
    member Measures.[Отклонение цены] 
    as 'IIF 
        (
            IsEmpty 
            (
                Measures.[Цена на текущий период] 
            ),
            null,
            Measures.[Цена на текущий период] - Measures.[Цена на начало года] 
        )' 
    member Measures.[Прирост цены, входящий в состав текущей цены] 
    as 'IIF 
        (
            (Measures.[Отклонение цены]) > 0,
            Measures.[Отклонение цены],
            null 
        )' 
    member Measures.[Снижение цены] 
    as 'IIF 
        (
            (Measures.[Отклонение цены]) < 0,
            Measures.[Отклонение цены],
            null
        )' 
    member Measures.[Снижение цены ]
    as 'IIF
        (
            (Measures.[Отклонение цены]) < 0,
            -Measures.[Отклонение цены],
            null
        )'
select
    Filter({
        Measures.[Цена (без учета прироста)],
        Measures.[Прирост цены, входящий в состав текущей цены],
        Measures.[Снижение цены ]
    }, Measures.[Цена (без учета прироста)] > 0) on columns,
    {<%all_regions%>} on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Все источники данных].[СТАТ Отчетность - Вологдастат],
        [Организации].[Предприятия торговли].[Все организации].[Значение не указано],
        [Организации].[Тип цены].[Все типы цен].[Розничная цена],
        <%selected_food%>
    )
    ]]>
  </query>

</root>