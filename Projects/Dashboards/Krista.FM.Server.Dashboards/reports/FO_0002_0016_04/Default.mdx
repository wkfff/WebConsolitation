<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0002_0016_04_grid">
    <![CDATA[
-- FO_0002_0016_04_grid
with
    set [Список МО]
    as 'Filter
        (
            Descendants
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 03],
                SELF
            ),
            not
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            )
        )'
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Итого]
    as 'Aggregate({[Список МО]})'
    set [Список КД]
    as 'Generate
        (
            {
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Иные межбюджетные трансферты]
            },
            {
                [КД__Сопоставимый].[КД__Сопоставимый].CurrentMember
            } + Filter
            (
                Descendants
                (
                    [КД__Сопоставимый].[КД__Сопоставимый].CurrentMember,
                    [КД__Сопоставимый].[КД__Сопоставимый].[Элемент подстатьи],
                    SELF_AND_BEFORE
                ),
                not
                (
                    [КД__Сопоставимый].[КД__Сопоставимый].CurrentMember is [КД__Сопоставимый].[КД__Сопоставимый].CurrentMember.Parent.DataMember
                )
            )
        )'
    member [КД__Сопоставимый].[КД__Сопоставимый].[Всего]
    as 'Aggregate
        (
            {
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Иные межбюджетные трансферты]
            }
        )'
    member [Уровни бюджета__СКИФ].[Уровни бюджета__СКИФ].[Уровень бюджета ]
    as 'Aggregate
        (
            {
                [Уровни бюджета__СКИФ].[Уровни бюджета__СКИФ].[Все].[Бюджет гор.округа],
                [Уровни бюджета__СКИФ].[Уровни бюджета__СКИФ].[Все].[Бюджет района],
                [Уровни бюджета__СКИФ].[Уровни бюджета__СКИФ].[Все].[Бюджет поселения]
            }
        )'
    member [Measures].[Утверждено на год]
    as '[Measures].[Годовые назначения] / 1000'
    member [Measures].[Профинансировано]
    as '[Measures].[Факт] / 1000'
    member [Measures].[Остаток финансирования от плана на год]
    as '[Measures].[Утверждено на год] - [Measures].[Профинансировано]'
    member [Measures].[Уровень]    
    as 'IIF   
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is [Районы__Сопоставимый].[Районы__Сопоставимый].[Итого],
            0,
            1 
        )' 
select
    non empty
    {
        {
            {
                [КД__Сопоставимый].[КД__Сопоставимый].[Всего]
            } + [Список КД]
        }
        *
        {
            [Measures].[Утверждено на год],
            [Measures].[Профинансировано],
            [Measures].[Остаток финансирования от плана на год]
        } +
        {[КД__Сопоставимый].[КД__Сопоставимый].[Все коды доходов]}
        *
        {[Measures].[Уровень]}
    } on columns,
    Filter
    (
        {
            {
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Итого]
            } + [Список МО]
        },
        not
        (
            IsEmpty
            (
                (
                    [Measures].[Аггрегированные меры],
                    [КД__Сопоставимый].[КД__Сопоставимый].[Всего]
                )
            )
        )
    ) on rows
from [ФО_МесОтч_Доходы]
where
    (
        <%selected_period%>,
        [ТипДокумента__СКИФ].[Все].[Данные конс. отчета субъекта в разрезе городов и районов (5+7+10)],
        [Уровни бюджета__СКИФ].[Уровни бюджета__СКИФ].[Уровень бюджета ],
        <%selected_admin%>
    )
  ]]>
  </query>

  <query id="FO_0002_0016_04_adminDigest">
    <![CDATA[
-- FO_0002_0016_04_adminDigest
with  
    set [Администраторы]  
    as '[Администратор__Сопоставим].[Администратор__Сопоставим].[Все администраторы] + [Администратор__Сопоставим].[Администратор__Сопоставим].[Все администраторы].Children'  
    member [Measures].[Имя] 
    as ' [Администратор__Сопоставим].[Администратор__Сопоставим].CurrentMember.Name '
    member [Measures].[Уникальное имя]  
    as '[Администратор__Сопоставим].[Администратор__Сопоставим].CurrentMember.UniqueName '
    member [Measures].[Уровень]  
    as 'IIF  
        (
            [Администратор__Сопоставим].[Администратор__Сопоставим] is [Администратор__Сопоставим].[Администратор__Сопоставим].[Все администраторы],
            0,
            1
        )'  
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень]
    } on columns,
    { [Администраторы] }  on rows
from [ФО_МесОтч_Доходы]   
  ]]>
  </query>
</root>