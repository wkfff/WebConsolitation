<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0021_0003_HMAO_date">
    <![CDATA[
-- FO_0021_0003_HMAO_date
with
    member [Measures].[ДанныеНа]
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                Descendants
                (
                    [Период__Период].[Период__Период].[Данные всех периодов],
                    [Период__Период].[Период__Период].[Год],
                    SELF
                ),
                not IsEmpty
                (
                    (
                        [Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].[Все показатели]
                    )
                )
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_ФПКУ_Показатели]
]]>
  </query>

  <query id="FO_0021_0003_HMAO_map_avg">
    <![CDATA[
-- FO_0021_0003_HMAO_map_avg
with 
    set [ГО] 
    as ' Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" 
        ) ' 
    set [МР] 
    as ' Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" 
        ) ' 
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Средняя оценка по ГО] 
    as 'Avg 
        (
            [ГО],
            <%selected_indicator%> 
        ) ' 
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Средняя оценка по МР] 
    as 'Avg 
        (
            [МР],
            <%selected_indicator%> 
        )' 
select
    {
        <%selected_indicator%> 
    } on columns,
    {
        [Районы__Сопоставимый].[Районы__Сопоставимый].[Средняя оценка по ГО]
        +
        Order 
        (
            Filter 
            (
                [ГО],
                not IsEmpty([Measures].[Оценка индикатора]) 
            ),
            <%selected_indicator%>,
            <%sorting_type%> 
        )
        +
        [Районы__Сопоставимый].[Районы__Сопоставимый].[Средняя оценка по МР]
        +
        Order
        (
            Filter
            (
                [МР],
                not IsEmpty([Measures].[Оценка индикатора])
            ),
            <%selected_indicator%>,
            <%sorting_type%>
        )
     } on rows 
from [ФО_ФПКУ_Показатели] 
where 
    (
        [Measures].[Оценка индикатора],
        [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>] 
    ) 
  ]]>
</query>

  <query id="FO_0021_0003_HMAO_map_rating">
    <![CDATA[
-- FO_0021_0003_HMAO_map_rating
with 
    set [ГО] 
    as ' Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" 
        ) ' 
    set [МР] 
    as ' Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" 
        ) ' 
select
    {
        <%selected_indicator%> 
    } on columns,
    {
        Order 
        (
            Filter 
            (
                [ГО],
                not IsEmpty([Measures].[Оценка индикатора]) 
            ),
            <%selected_indicator%>,
            <%sorting_type%>
        )
        +
        Order
        (
            Filter
            (
                [МР],
                not IsEmpty([Measures].[Оценка индикатора])
            ),
            <%selected_indicator%>,
            <%sorting_type%>
        )
     } on rows 
from [ФО_ФПКУ_Показатели] 
where 
    (
        [Measures].[Оценка индикатора],
        [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>] 
    ) 
  ]]>
  </query>

  <query id="FO_0021_0003_HMAO_map">
    <![CDATA[
-- FO_0021_0003_HMAO_map
with
    set [Список МО]
    as 'Filter
        (
            Descendants
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF
            ),
            not
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            )
        )'
select
    {
         <%selected_indicator%>
    } on columns,
    {
        Order
        (
            Filter
            (
                [Список МО],
                not IsEmpty([Measures].[Оценка индикатора])
            ),
            <%selected_indicator%>,
            <%sorting_type%>
        )
    } on rows
from [ФО_ФПКУ_Показатели]
where
    (
        [Measures].[Оценка индикатора],
        [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>]
    ) 
  ]]>
  </query>

  <query id="FO_0021_0003_HMAO_indicatorList">
    <![CDATA[
-- FO_0021_0003_HMAO_indicatorList
with
    set [Показатели]
    as '
        Descendants
            (
                [Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].[Все показатели],
                [Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].[Показатели],
                SELF
            )'

    member [Measures].[Имя]
    as '
			[Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].CurrentMember.Properties("Наименование")			
		'
    member [Measures].[Уникальное имя]
    as '[Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].CurrentMember.UniqueName'
    member [Measures].[Уровень]
    as '0'
    member [Measures].[Полное имя]
    as '		
			[Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].CurrentMember.Properties("Наименование")
		'
    member [Measures].[Краткое имя]
    as '[Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].CurrentMember.Name'
    member [Measures].[Тип]
    as '[Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].CurrentMember.Properties("Содержание")'

    set [Список районов]
    as 'Filter
        (
            Descendants
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF
            ),
            not
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО"
            )
        )'

    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Аггрегированные районы]
    as 'Aggregate({[Список районов]})'
select
    {
        [Measures].[Имя],
        [Measures].[Уникальное имя],
        [Measures].[Уровень],
        [Measures].[Полное имя],
        [Measures].[Краткое имя],
        [Measures].[Тип]
    } on columns,
    {
        Filter
        (
           [Показатели],
           not
           (
               IsEmpty
               (
                   ([Районы__Сопоставимый].[Районы__Сопоставимый].[Аггрегированные районы], 
                   [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>])
               )
           )
        )
    } on rows
from  [ФО_ФПКУ_Показатели] 
  ]]>
  </query>
  
  <query id="FO_0021_0003_HMAO_quality_limit">
        <![CDATA[
-- FO_0021_0003_HMAO_quality_limit
 with 
    set [Список районов] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" and <%selected_indicator%> 
        )' 
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Первая граница] 
    as ' Tail 
        (
            Head 
            (
                Order 
                (
                    [Список районов],
                    <%selected_indicator%>,
                    <%sorting_type%> 
                ),
                3 
            ) 
        ). Item(0)  ' 
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Вторая граница] 
    as ' Head 
        (
            Tail 
            (
                Order 
                (
                    [Список районов],
                    <%selected_indicator%>,
                    <%sorting_type%> 
                ),
                3 
            ) 
        ). Item(0)  ' 
select
    non empty 
    {
        [Районы__Сопоставимый].[Районы__Сопоставимый].[Первая граница],
        [Районы__Сопоставимый].[Районы__Сопоставимый].[Вторая граница] 
    } on columns,
    { <%selected_indicator%> }on rows 
from  [ФО_ФПКУ_Показатели] 
where 
    (
        [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>],
        [Measures].[Оценка индикатора] 
    ) 
  ]]>
  </query>

  <query id="FO_0021_0003_HMAO_avg_indicator">
        <![CDATA[
 -- FO_0021_0003_HMAO_avg_indicator
  with 
    set [Список МО] 
    as 'Filter 
        (
            Descendants 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы],
                [Районы__Сопоставимый].[Районы__Сопоставимый].[Уровень 02],
                SELF 
            ),
            not 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember 
            ) and 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР" or [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГО" 
            ) 
        )' 
    member [Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].[Среднее значение] 
    as 'Avg 
        (
            [Список МО],
            <%selected_indicator%>
        )' 
select
    { [Показатели__ФПКУ_Сопоставимый].[Показатели__ФПКУ_Сопоставимый].[Среднее значение] } on columns
  
from [ФО_ФПКУ_Показатели] 
where 
    (
        [Measures].[Оценка индикатора],
        [Период__Период].[Период__Период].[Данные всех периодов].[<%selected_period%>]
    ) 
    ]]>
      </query>
</root>