<?xml version="1.0" encoding="windows-1251"?>
<root>
  <query id="FK_0001_0001_date_budget">
    <![CDATA[
-- FK_0001_0001_compare_date_budget
-- <#[ФК_МесОтч_Расходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Расходы]
  ]]>
  </query>

  <query id="FK_0001_0001_compare_grid_budget">
<![CDATA[
-- FK_0001_0001_compare_grid_budget  
-- <#[ФК_МесОтч_Расходы]#>
    with    
    member [РзПр].[Сопоставимый].[ДРУГИЕ (Национальная оборона, Национальная безопасность и правоохранительная деятельность, Охрана окружающей среды, Целевые бюджетные фонды)] 
    as 'Aggregate 
        (
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ОБОРОНА],
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ БЕЗОПАСНОСТЬ И ПРАВООХРАНИТЕЛЬНАЯ ДЕЯТЕЛЬНОСТЬ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ЦЕЛЕВЫЕ БЮДЖЕТНЫЕ ФОНДЫ]
            } 
        )'     
    set [Разделы ФКР] 
    as '
        {
            [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБЩЕГОСУДАРСТВЕННЫЕ ВОПРОСЫ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ЭКОНОМИКА],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБРАЗОВАНИЕ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[КУЛЬТУРА, КИНЕМАТОГРАФИЯ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[СРЕДСТВА МАССОВОЙ ИНФОРМАЦИИ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ЗДРАВООХРАНЕНИЕ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ФИЗИЧЕСКАЯ КУЛЬТУРА И СПОРТ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[СОЦИАЛЬНАЯ ПОЛИТИКА],
            [РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ ОБЩЕГО ХАРАКТЕРА БЮДЖЕТАМ СУБЪЕКТОВ РОССИЙСКОЙ ФЕДЕРАЦИИ И МУНИЦИПАЛЬНЫХ ОБРАЗОВАНИЙ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБСЛУЖИВАНИЕ ГОСУДАРСТВЕННОГО И МУНИЦИПАЛЬНОГО ДОЛГА],
            [РзПр].[Сопоставимый].[ДРУГИЕ (Национальная оборона, Национальная безопасность и правоохранительная деятельность, Охрана окружающей среды, Целевые бюджетные фонды)] 
        }'   
    member Measures.[Исполнено млн]
    as '
            [Measures].[Исполнено] / 1000000
       '
    member Measures.[Доля]
    as '(
            [Measures].[Исполнено],
            [РзПр].[Сопоставимый].CurrentMember    
        )/    
        (
            [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
            [Measures].[Исполнено]    
        )'    
    member Measures.[Ранг ФО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ) or not([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ"),
            null,
            Rank    
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order    
                (
                    Filter    
                    (
                        [Территории].[Сопоставимый].CurrentMember.Siblings,
                        not IsEmpty ( [Measures].[Доля] )    
                    ),
                    [Measures].[Доля],
                    DESC    
                ),
                [Measures].[Доля]    
            )    
        )'    
    member Measures.[Худший ранг ФО]    
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля] ),
            null,
            max    
            (
                [Территории].[Сопоставимый].CurrentMember.Siblings,
                Measures.[Ранг ФО]    
            )    
        ) '    
    member Measures.[Ранг РФ]    
    as 'IIF    
        (
            IsEmpty ([Measures].[Доля]) or [Территории].[Сопоставимый].CurrentMember.Level.Name <> "Субъект РФ",
            null,
            Rank    
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order    
                (
                    Filter    
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].Members,
                        not IsEmpty ( [Measures].[Доля] )    
                    ),
                    [Measures].[Доля],
                    BDESC    
                ),
                [Measures].[Доля]    
            )    
        )'    
    member Measures.[Худший ранг РФ] 
    as 'IIF    
        (
            IsEmpty ( [Measures].[Доля]),
            null,
            max    
            (
                [Территории].[Сопоставимый].[Субъект РФ].Members,
                Measures.[Ранг РФ]    
            )    
        ) '  
    member Measures.[ShortName]
    as '[Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование")'
    member Measures.[ParentShortName]
    as '[Территории].[Сопоставимый].CurrentMember.Parent.Properties("Сокращенное наименование")'
    member Measures.[ФО]
    as 'IIF
        (
            (
                [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ" or [Территории].[Сопоставимый].CurrentMember.Level.Name = "Федеральный округ"
            ) and
            (
                (
                    Measures.[Исполнено],
                    [РзПр].[Сопоставимый].[Все коды ФКР]
                ) <> 0
            ),
            IIF
            (
                [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
                Measures.[ParentShortName],
                Measures.[ShortName]
            ),
            null
        )'    
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--                 
        
select
   {     {
            [РзПр].[Сопоставимый].[Все коды ФКР]
        }
        *{Measures.[ФО]} +
    {
        [Разделы ФКР] 
        * 
        {
            {
                Measures.[Исполнено млн],
                Measures.[Доля],
                Measures.[Ранг ФО],
                Measures.[Худший ранг ФО],
                Measures.[Ранг РФ] 
            } 
        } 
    } } on columns,
    non empty
    {
        {
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация]
        } + Generate
        (
            [Территории].[Сопоставимый].[Федеральный округ].Members,
            Descendants
            (
                [Территории].[Сопоставимый].CurrentMember,
                [Территории].[Сопоставимый].[Субъект РФ],
                SELF_AND_BEFORE
            )
        )
    }on rows
from [ФК_МесОтч_Расходы]    
where
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[<%skif_level%>]
    )    
  ]]>
</query>

<query id="FK_0001_0001_compare_chart1_budget">
<![CDATA[
-- FK_0001_0001_compare_chart1_budget
-- <#[ФК_МесОтч_Расходы]#>
with  
    member [РзПр].[Сопоставимый].[Другие] 
    as 'Aggregate 
        (
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ОБОРОНА],
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ БЕЗОПАСНОСТЬ И ПРАВООХРАНИТЕЛЬНАЯ ДЕЯТЕЛЬНОСТЬ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ЦЕЛЕВЫЕ БЮДЖЕТНЫЕ ФОНДЫ]
            } 
        )'      
    set [Разделы ФКР]  
    as 'Except  
        (
            [РзПр].[Сопоставимый].[Раздел].Members,
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[Несопоставленные данные],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Итого внутренних оборотов],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ВСЕГО]
            }  
        )' 
    member Measures.[Доля Empty]  
    as 'IIF (IsEmpty([Measures].[Исполнено]) or [Measures].[Исполнено] <= 0, null,   
        (
            [Measures].[Исполнено],
            [РзПр].[Сопоставимый].CurrentMember  
        )/Sum  
        (
            [Разделы ФКР],
            IIF([Measures].[Исполнено] < 0, 0, [Measures].[Исполнено])
        ))'  
    member Measures.[Сокращенное наименование] 
    as '[Территории].[Сопоставимый].CurrentMember.Properties("Сокращенное наименование")' 
    member Measures.[Доля] 
    as 'IIF 
        (
            [РзПр].[Сопоставимый].CurrentMember.Name = "Сокращенное наименование",
            Measures.[Сокращенное наименование],
            CoalesceEmpty  
            (
                Measures.[Доля Empty],
                0  
            ) 
        )'  
    member [РзПр].[Сопоставимый].[Общегосуд.вопросы]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБЩЕГОСУДАРСТВЕННЫЕ ВОПРОСЫ]'  
    member [РзПр].[Сопоставимый].[Национальная экономика_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ЭКОНОМИКА]'  
    member [РзПр].[Сопоставимый].[ЖКХ]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО]'  
    member [РзПр].[Сопоставимый].[Образование_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБРАЗОВАНИЕ]'  
    member [РзПр].[Сопоставимый].[Культура, кинематография_]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[КУЛЬТУРА, КИНЕМАТОГРАФИЯ]'
    member [РзПр].[Сопоставимый].[СМИ]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[СРЕДСТВА МАССОВОЙ ИНФОРМАЦИИ]'
    member [РзПр].[Сопоставимый].[Здравоохранение_]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ЗДРАВООХРАНЕНИЕ]'
    member [РзПр].[Сопоставимый].[Физическая культура, спорт]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ФИЗИЧЕСКАЯ КУЛЬТУРА И СПОРТ]'
    member [РзПр].[Сопоставимый].[Социальная политика_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[СОЦИАЛЬНАЯ ПОЛИТИКА]'  
    member [РзПр].[Сопоставимый].[Межбюджетные трансферты_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ]'
    member [РзПр].[Сопоставимый].[Межбюджетные трансферты общего характера]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ ОБЩЕГО ХАРАКТЕРА БЮДЖЕТАМ СУБЪЕКТОВ РОССИЙСКОЙ ФЕДЕРАЦИИ И МУНИЦИПАЛЬНЫХ ОБРАЗОВАНИЙ]'
    member [РзПр].[Сопоставимый].[Обслуживание гос. и муниц. долга]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБСЛУЖИВАНИЕ ГОСУДАРСТВЕННОГО И МУНИЦИПАЛЬНОГО ДОЛГА]'    
    set [Список субъектов]
    as '  
        {
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация<%subject_FO%>
        } + Filter
        (
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация<%subject_FO%>.Children,
            Measures.[Доля] > 0
        )' 
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--                 
select
    Filter  
    (
        {
          [РзПр].[Сопоставимый].[Общегосуд.вопросы],
          [РзПр].[Сопоставимый].[Национальная экономика_],
          [РзПр].[Сопоставимый].[ЖКХ],
          [РзПр].[Сопоставимый].[Образование_],
          [РзПр].[Сопоставимый].[Культура, кинематография_],
          [РзПр].[Сопоставимый].[СМИ],
          [РзПр].[Сопоставимый].[Здравоохранение_],
          [РзПр].[Сопоставимый].[Социальная политика_],
          [РзПр].[Сопоставимый].[Физическая культура, спорт],
          [РзПр].[Сопоставимый].[Межбюджетные трансферты_],
          [РзПр].[Сопоставимый].[Обслуживание гос. и муниц. долга],  
          [РзПр].[Сопоставимый].[Межбюджетные трансферты общего характера],
          [РзПр].[Сопоставимый].[Другие] 
        },
        Sum([Список субъектов]) > 0
    ) on columns,
    [Список субъектов] on rows
from [ФК_МесОтч_Расходы]  
where  
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        Measures.[Доля],
        [Уровни бюджета].[СКИФ].[<%skif_level%>]
    )   
  ]]>
      </query>

      <query id="FK_0001_0001_compare_chart2_budget">
        <![CDATA[
-- FK_0001_0001_compare_chart2_budget
-- <#[ФК_МесОтч_Расходы]#>
with
    member [РзПр].[Сопоставимый].[Другие] 
    as 'Aggregate 
        (
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ОБОРОНА],
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ БЕЗОПАСНОСТЬ И ПРАВООХРАНИТЕЛЬНАЯ ДЕЯТЕЛЬНОСТЬ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ЦЕЛЕВЫЕ БЮДЖЕТНЫЕ ФОНДЫ] 
            } 
        )'     
    set [Разделы ФКР]  
    as 'Except  
        (
            [РзПр].[Сопоставимый].[Раздел].Members,
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[Несопоставленные данные],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Итого внутренних оборотов],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ВСЕГО]  
            }  
        )'  
    member Measures.[Доля Empty]  
    as 'IIF 
        (
            IsEmpty([Measures].[Исполнено]) or [Measures].[Исполнено] <= 0,
            null,
            (
                [Measures].[Исполнено],
                [РзПр].[Сопоставимый].CurrentMember  
            )/Sum  
            (
                [Разделы ФКР],
                IIF([Measures].[Исполнено] < 0, 0, [Measures].[Исполнено])
            )
        )' 
    member Measures.[Факт]  
    as 'CoalesceEmpty  
        (
            Measures.[Доля Empty],
            0  
        )'  
    member Measures.[Доля план Empty]  
    as 'IIF  
        (
            IsEmpty([Measures].[Назначено]) or [Measures].[Назначено] = 0,
            null,
            (
                [Measures].[Назначено],
                [РзПр].[Сопоставимый].CurrentMember  
            )/Sum  
            (
                [Разделы ФКР],
                [Measures].[Назначено]  
            ) 
        )'  
    member Measures.[План]  
    as 'CoalesceEmpty  
        (
            Measures.[Доля план Empty],
            0  
        )'  
    member [РзПр].[Сопоставимый].[Общегосуд.вопросы]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБЩЕГОСУДАРСТВЕННЫЕ ВОПРОСЫ]'  
    member [РзПр].[Сопоставимый].[Национальная экономика_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ЭКОНОМИКА]'  
    member [РзПр].[Сопоставимый].[ЖКХ]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО]'  
    member [РзПр].[Сопоставимый].[Образование_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБРАЗОВАНИЕ]'  
    member [РзПр].[Сопоставимый].[Культура, кинематография_]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[КУЛЬТУРА, КИНЕМАТОГРАФИЯ]'
    member [РзПр].[Сопоставимый].[СМИ]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[СРЕДСТВА МАССОВОЙ ИНФОРМАЦИИ]'
    member [РзПр].[Сопоставимый].[Здравоохранение_]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ЗДРАВООХРАНЕНИЕ]'
    member [РзПр].[Сопоставимый].[Физическая культура, спорт]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ФИЗИЧЕСКАЯ КУЛЬТУРА И СПОРТ]'
    member [РзПр].[Сопоставимый].[Социальная политика_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[СОЦИАЛЬНАЯ ПОЛИТИКА]'  
    member [РзПр].[Сопоставимый].[Межбюджетные трансферты_]  
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ]'
    member [РзПр].[Сопоставимый].[Межбюджетные трансферты общего характера]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ ОБЩЕГО ХАРАКТЕРА БЮДЖЕТАМ СУБЪЕКТОВ РОССИЙСКОЙ ФЕДЕРАЦИИ И МУНИЦИПАЛЬНЫХ ОБРАЗОВАНИЙ]'
    member [РзПр].[Сопоставимый].[Обслуживание гос. и муниц. долга]
    as '[РзПр].[Сопоставимый].[Все коды ФКР].[ОБСЛУЖИВАНИЕ ГОСУДАРСТВЕННОГО И МУНИЦИПАЛЬНОГО ДОЛГА]'  
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--             
select
    {
          [РзПр].[Сопоставимый].[Общегосуд.вопросы],
          [РзПр].[Сопоставимый].[Национальная экономика_],
          [РзПр].[Сопоставимый].[ЖКХ],
          [РзПр].[Сопоставимый].[Образование_],
          [РзПр].[Сопоставимый].[Культура, кинематография_],
          [РзПр].[Сопоставимый].[СМИ],
          [РзПр].[Сопоставимый].[Здравоохранение_],
          [РзПр].[Сопоставимый].[Социальная политика_],
          [РзПр].[Сопоставимый].[Физическая культура, спорт],
          [РзПр].[Сопоставимый].[Межбюджетные трансферты_],
          [РзПр].[Сопоставимый].[Обслуживание гос. и муниц. долга],  
          [РзПр].[Сопоставимый].[Межбюджетные трансферты общего характера],
        [РзПр].[Сопоставимый].[Другие] 
    }  on columns,
    {
       Measures.[Факт], 
       Measures.[План] 
    } on rows
from [ФК_МесОтч_Расходы]  
where  
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[<%skif_level%>],
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация<%subject%>
    )   
  ]]>
</query>

<query id="FK_0001_0001_compare_rankRF_budget">
<![CDATA[
-- FK_0001_0001_compare_rankRF_budget
-- <#[ФК_МесОтч_Расходы]#>
with  
    member [РзПр].[Сопоставимый].[Другие] 
    as 'Aggregate 
        (
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ОБОРОНА],
                [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ БЕЗОПАСНОСТЬ И ПРАВООХРАНИТЕЛЬНАЯ ДЕЯТЕЛЬНОСТЬ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ОХРАНА ОКРУЖАЮЩЕЙ СРЕДЫ],
                [РзПр].[Сопоставимый].[Все коды ФКР].[ЦЕЛЕВЫЕ БЮДЖЕТНЫЕ ФОНДЫ] 
            } 
        )'     
    set [Разделы ФКР] 
    as '
        {
            [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБЩЕГОСУДАРСТВЕННЫЕ ВОПРОСЫ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[НАЦИОНАЛЬНАЯ ЭКОНОМИКА],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ЖИЛИЩНО-КОММУНАЛЬНОЕ ХОЗЯЙСТВО],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБРАЗОВАНИЕ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[КУЛЬТУРА, КИНЕМАТОГРАФИЯ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[СРЕДСТВА МАССОВОЙ ИНФОРМАЦИИ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ЗДРАВООХРАНЕНИЕ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ФИЗИЧЕСКАЯ КУЛЬТУРА И СПОРТ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[СОЦИАЛЬНАЯ ПОЛИТИКА],
            [РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ ОБЩЕГО ХАРАКТЕРА БЮДЖЕТАМ СУБЪЕКТОВ РОССИЙСКОЙ ФЕДЕРАЦИИ И МУНИЦИПАЛЬНЫХ ОБРАЗОВАНИЙ],
            [РзПр].[Сопоставимый].[Все коды ФКР].[ОБСЛУЖИВАНИЕ ГОСУДАРСТВЕННОГО И МУНИЦИПАЛЬНОГО ДОЛГА],
            [РзПр].[Сопоставимый].[Другие] 
        }'   
    member Measures.[Доля]  
    as '  
        (
            [Measures].[Исполнено],
            [РзПр].[Сопоставимый].CurrentMember  
        )/  
        (
            [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
            [Measures].[Исполнено]  
        )'  
    member Measures.[Ранг РФ]  
    as 'IIF  
        (
            IsEmpty ([Measures].[Доля]) or [Территории].[Сопоставимый].CurrentMember.Level.Name <> "Субъект РФ",
            null,
            Rank  
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order  
                (
                    Filter  
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].Members,
                        not IsEmpty ( [Measures].[Доля] )  
                    ),
                    [Measures].[Доля],
                    BDESC  
                ),
                [Measures].[Доля]  
            )  
        )'  
    member Measures.[Худший ранг РФ]  
    as 'IIF  
        (
            IsEmpty ( [Measures].[Доля]),
            null,
            max  
            (
                [Территории].[Сопоставимый].[Субъект РФ].Members,
                Measures.[Ранг РФ]  
            )  
        )'
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'
--                 
select
    {
        [Разделы ФКР]  
    }  on columns,
    non empty 
    {
        [Худший ранг РФ]
    } on rows 
from [ФК_МесОтч_Расходы]  
where  
    (
       [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
       [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
       [Уровни бюджета].[СКИФ].[<%skif_level%>]
    )  
  ]]>
  </query>
  
</root>