<?xml version="1.0" encoding="windows-1251"?>
<root>  
<query id="FK_0001_0003_date">
    <![CDATA[
-- FK_0001_0003_allocation_date
-- <#[ФК_МесОтч_Расходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Расходы]
  ]]>
  </query>

  <query id="FK_0001_0003_allocation_chart">
    <![CDATA[
-- FK_0001_0003_allocation_chart
-- <#[ФК_МесОтч_Расходы]#>
with
   member Measures.[Численность постоянного населения_Prev]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения_This]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения_This]
            ) or Measures.[Численность постоянного населения_This] = 0,
            Measures.[Численность постоянного населения_Prev],
            Measures.[Численность постоянного населения_This]
        ) '
    member Measures.[Исполнено_]
    as 'IIF
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
            Measures.[Исполнено],
            Sum
            (
                Filter
                (
                    [Территории].[Сопоставимый].Children,
                    (
                        Measures.[Численность постоянного населения] <> 0
                    )
                ),
                Measures.[Исполнено_]
            )
        ) '
    member Measures.[Другие субъекты РФ ]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения]
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            Measures.[Исполнено_]/
            (
                Measures.[Численность постоянного населения]
                *1000
            )
        )'
    set [Список субъектов]
    as 'Filter
        (
            [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
            (
                not
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember
                ) and
                (
                    Measures.[Исполнено]
                ) <> 0
                and
                (
                    Measures.[Численность постоянного населения]
                ) <> 0
            ) <%filter%>
        )'
select
    {
        Measures.[Численность постоянного населения],
        Measures.[Другие субъекты РФ ]
    } on columns,
    [Список субъектов] on rows
from [ФК_МесОтч_Расходы]
where
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
        <%fkr_filter%>
    )
  ]]>
</query>

  <query id="FK_0001_0003_allocation_avg">
    <![CDATA[
-- FK_0001_0003_allocation_avg
-- <#[ФК_МесОтч_Расходы]#>
with    
    member Measures.[Численность постоянного населения_Prev]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения_This]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения_This]
            ) or Measures.[Численность постоянного населения_This] = 0,
            Measures.[Численность постоянного населения_Prev],
            Measures.[Численность постоянного населения_This]
        ) '
    member Measures.[Расходы всего]    
    as 'Sum    
        (
            [Список субъектов],
            Measures.[Исполнено]    
        )'    
    member Measures.[Численность постоянного населения всего]    
    as 'IIF  
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "РФ",
            1000
            *Measures.[Численность постоянного населения],
            Sum 
            (
                [Список субъектов],
                1000   
                *Measures.[Численность постоянного населения]   
            ) 
        )'  
    member Measures.[Расходы среднее]    
    as '  
        (
            Measures.[Расходы всего]   / Measures.[Численность постоянного населения всего]    
        )'    
    set [Список субъектов]    
    as 'Filter   
        (
            {<%selectedItem%>},
            (
                not   
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember   
                ) and   
                (
                    Measures.[Исполнено] <> 0  
                ) and   
                (
                    Measures.[Численность постоянного населения] <> 0  
                )   
            ) 
        )'   
select
    {
        Measures.[Расходы среднее]  
    } on columns
from [ФК_МесОтч_Расходы]    
where        
    (
       [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
       [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта],
       <%fkr_filter%>
    )     
  ]]>
  </query>  
  
</root>