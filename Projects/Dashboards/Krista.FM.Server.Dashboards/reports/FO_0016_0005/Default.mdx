<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="FO_0016_0005_date">
    <![CDATA[
-- FO_0016_0005_date
with
    member [Measures].[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                <%period_dimension%>.Members,
                not IsEmpty( ([Measures].[Значение], [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Данные всех источников].[У 4]) ) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФО_БККУ_Показатели]
]]>
  </query>

  <query id="FO_0016_0005_grid">
    <![CDATA[
-- FO_0016_0005_grid
With     
    set [Индикаторы]
    as 'Order
        (
            Filter
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Данные всех источников].Children,
                StrToValue
                (
                    [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
                ) >= 50 and
                StrToValue
                (
                    [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
                ) < 100
            ),
            StrToValue
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
            ),
            BASC
        ) '
    set [Районы с поселениями]   
    as 'Filter
        (
            Generate 
            (
                Descendants  
                (
                    [Районы__Сопоставимый].[Районы__Сопоставимый].[Все районы].[Новосибирская область (Консолидированный)],
                    <%region_level%>,
                    SELF  
                ),
                {
                    [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember 
                } + Descendants  
                (
                    [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember,
                    <%settlement_level%>,
                    SELF  
                )  
            ),
            not 
            (
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember is  [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.DataMember
            ) and
            ([Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "МР" or
             [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "ГО" or
             [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "СП" or
             [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "ГП") and
             not IsEmpty([Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Общее количество нарушений]) and
             <%selected_mo_group%>
        )' 
    member [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Группа МО ]
    as 'IIF 
        (
            [Период__Период].[Период__Период].CurrentMember.Parent.Parent is [Период__Период].[Период__Период].[2009],
            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Данные всех источников].[БК 1],
            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Данные всех источников].[Группа МО]
        )'
    member [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Общее количество нарушений]
    as 'Sum
        (
            [Индикаторы],
            [Measures].[Количество нарушений ]
        )'
    member [Measures].[Значение ]  
    as 'IIF  
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР",
            (
                [Measures].[Значение],
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.DataMember
            ),
            [Measures].[Значение] 
        )'  
        
    member [Measures].[Значение  ]   
    as 'IIF   
        (
            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Единицы измерения") = "ДА/НЕТ",
            IIF   
            (
                IsEmpty([Measures].[Значение ]),
                null,
                IIF  
                (
                    [Measures].[Значение ] = 1,
                    "Да",
                    IIF   
                    (
                        [Measures].[Значение ] = 0,
                        "Нет",
                        null   
                    )   
                )
            ),
            [Measures].[Значение ]      
        )'   
        
    member [Measures].[Количество нарушений ]
    as 'IIF
        (
            [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "МР",
            (
                [Measures].[Количество нарушений],
                [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.DataMember
            ),
            [Measures].[Количество нарушений]
        )'       
        
    member [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] 
    as '[Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории")'
    member [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Район]
    as 'IIF
        (
           [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "СП" or
           [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Properties("Тип территории") = "ГП",
           [Районы__Сопоставимый].[Районы__Сопоставимый].CurrentMember.Parent.Name,
           null
        )'
        
    member [Районы__Сопоставимый].[Районы__Сопоставимый].[Аггрегированные районы]
    as 'Aggregate({[Районы с поселениями] })'
    
    member [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Уровень] 
    as 'IIF
        (
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "МР"
            ) or 
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Тип территории] = "ГО"
            ),
            0,
            1
        )'     
Select
    {
        {
            {
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Район],
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Группа МО ],
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Общее количество нарушений] 
            } 
            * { [Measures].[Значение ] }
        } + 
        {
            Filter
            (
                {  [Индикаторы] },
                not IsEmpty
                (
                    (
                        [Районы__Сопоставимый].[Районы__Сопоставимый].[Аггрегированные районы],
                        [Measures].[Значение]
                    )
                )
            ) 
            * 
            {
                [Measures].[Значение  ],
                [Measures].[Количество нарушений ] 
            }
        }  + 
        {
            {
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Уровень]
            } 
            * { [Measures].[Значение] } 
        } 
    } on columns,
    NON EMPTY     (  [Районы с поселениями]  )  on rows  
From [ФО_БККУ_Показатели]     
Where     
    (
        [Период__Период].[Период__Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>]
    )      
  ]]>
  </query>

  <query id="FO_0016_0005_indicatorDescription">
    <![CDATA[
-- FO_0016_0005_indicatorDescription
With  
    set [Индикаторы]
    as 'Order
        (
            Filter
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].[Данные всех источников].Children,
                StrToValue
                (
                    [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
                ) >= 50 and
                StrToValue
                (
                    [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
                ) < 100
            ),
            StrToValue
            (
                [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code")
            ),
            BASC
        ) '
   
    member [Measures].[Наименование]    
    as 'IIF    
        (
            [Measures].[Код] = 80 or [Measures].[Код] = 81,
            "всего",
            IIF    
            (
                [Measures].[Код] = 82 or [Measures].[Код] = 83,
                "НДФЛ",
                IIF    
                (
                    [Measures].[Код] = 84 or [Measures].[Код] = 85,
                    "налог на совокупный доход",
                    IIF  
                    (
                        [Measures].[Код] = 86,
                        "земельный налог",
                        IIF 
                        (
                            [Measures].[Код] = 87,
                            "налог на имущество физ.лиц",
                            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Наименование") 
                        ) 
                    )  
                )    
            )    
        )'   
        
    member [Measures].[Пороговое значение]
    as 'IIF
        (
            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Единицы измерения") = "ДА/НЕТ",
            "Да",
            [Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Пороговое значение") + "_"
        )   '
    member [Measures].[Условие проверки]
    as '[Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Условия проверки")'
    member [Measures].[Код]
    as 'StrToValue([Показатели__БККУ_Сопоставимый].[Показатели__БККУ_Сопоставимый].CurrentMember.Properties("Code"))'    
    
    member [Measures].[Группа]  
    as 'IIF 
        (
            [Measures].[Код] >= 50 and [Measures].[Код] < 80,
            "Индикаторы соблюдения основных условий предоставления МБТ",
            IIF 
            (
                [Measures].[Код] >= 80 and [Measures].[Код] < 88,
                "Индикаторы, характеризующие эффективность использования бюджетных средств;Сокращение недоимки по платежам в  бюджет, в том числе:",
                IIF 
                (
                    [Measures].[Код] >= 88 and [Measures].[Код] < 100,
                    "Индикаторы, характеризующие эффективность использования бюджетных средств",
                    " " 
                ) 
            ) 
        )'  
        
    member [Measures].[Подгруппа]    
    as 'IIF    
        (
            [Measures].[Код] = 80 or [Measures].[Код] = 82 or [Measures].[Код] = 84,
            "областной бюджет",
            IIF    
            (
                [Measures].[Код] = 81 or [Measures].[Код] = 83 or [Measures].[Код] = 85 or [Measures].[Код] = 86 or [Measures].[Код] = 87,
                "местный бюджет",
                ""
            )    
        )'        
Select
    {
       [Measures].[Наименование],
       [Measures].[Пороговое значение],
       [Measures].[Условие проверки],
       [Measures].[Код],
       [Measures].[Группа],
       [Measures].[Подгруппа] 
    } on columns,
    { [Индикаторы] }  on rows 
From [ФО_БККУ_Показатели]    
  ]]>
  </query>

</root>