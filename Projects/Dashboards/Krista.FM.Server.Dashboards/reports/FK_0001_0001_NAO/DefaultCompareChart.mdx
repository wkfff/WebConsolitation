<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FK_0001_0001_NAO_date">
    <![CDATA[
-- FK_0001_0001_NAO_compare_date
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Расходы]
  ]]>
</query>

<query id="FK_0001_0001_NAO_compare_chart">
<![CDATA[
-- FK_0001_0001_NAO_compare_chart
with
    set [Разделы ФКР]  
    as 'Except  
        (
            [РзПр].[Сопоставимый].[Раздел].Members,
            {
                [РзПр].[Сопоставимый].[Все коды ФКР].[Несопоставленные данные],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Итого внутренних оборотов],
                [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ВСЕГО]  
            }  
        ) '  
    member Measures.[Доля Empty]  
    as 'IIF 
        (
            IsEmpty([Measures].[Исполнено]) or [Measures].[Исполнено] <= 0,
            null,
            (
                [Measures].[Исполнено],
                [РзПр].[Сопоставимый].CurrentMember  
            )/Sum  
            (
                [Разделы ФКР],
                IIF([Measures].[Исполнено] < 0, 0, [Measures].[Исполнено])
            )
        )' 
    member Measures.[Факт]  
    as 'CoalesceEmpty  
        (
            Measures.[Доля Empty],
            0  
        )'  
    member Measures.[Доля план Empty]  
    as 'IIF  
        (
            IsEmpty([Measures].[Назначено]) or [Measures].[Назначено] = 0,
            null,
            (
                [Measures].[Назначено],
                [РзПр].[Сопоставимый].CurrentMember  
            )/Sum  
            (
                [Разделы ФКР],
                [Measures].[Назначено]  
            ) 
        )'  
    member Measures.[План]  
    as 'CoalesceEmpty  
        (
            Measures.[Доля план Empty],
            0  
        )'  
-- Уровни бюджета
    member [Уровни бюджета].[СКИФ].[Консолидированный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Собственный бюджет субъекта]
    as '[Уровни бюджета].[СКИФ].[Бюджет субъекта]'
    
    member [Уровни бюджета].[СКИФ].[Местные бюджеты]
    as '[Уровни бюджета].[СКИФ].[Конс.бюджет МО]'
    
    member [Уровни бюджета].[СКИФ].[Городские округа]
    as '[Уровни бюджета].[СКИФ].[Бюджет гор.округа]'

    member [Уровни бюджета].[СКИФ].[Муниципальные районы]
    as 'Aggregate
        (
            {
                [Уровни бюджета].[СКИФ].[Бюджет района],
                [Уровни бюджета].[СКИФ].[Бюджет поселения]
            }
        )'

    member [Уровни бюджета].[СКИФ].[Собственные бюджеты районов]
    as '[Уровни бюджета].[СКИФ].[Бюджет района]'
    
    member [Уровни бюджета].[СКИФ].[Городские и сельские поселения]
    as '[Уровни бюджета].[СКИФ].[Бюджет поселения]'

    set [5 лучших разделов ФКР]    
    as 'Head  
        (
            Order   
            (
                [Разделы ФКР],
                Measures.[Факт] + Measures.[План],
                BDESC 
            ),
            5  
        )'   
    member [РзПр].[Сопоставимый].[Прочие]
    as 'Aggregate
        (
            [Разделы ФКР] - [5 лучших разделов ФКР]
        )' 

select
    {
         [5 лучших разделов ФКР] + 
        {
            [РзПр].[Сопоставимый].[Прочие]
        } 
    }  on columns,
    {
       Measures.[Факт], 
       Measures.[План] 
    } on rows
from [ФК_МесОтч_Расходы]  
where  
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>],
        [Уровни бюджета].[СКИФ].[<%selected_level%>]
    )   
  ]]>
</query>

</root>