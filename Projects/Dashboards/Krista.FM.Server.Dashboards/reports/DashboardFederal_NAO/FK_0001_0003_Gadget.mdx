<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FK_0001_0003_date">
    <![CDATA[
-- FK_0001_0003_date    
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Расходы]
	]]>
  </query>

  <query id="FK_0001_0003">
    <![CDATA[
-- FK_0001_0003
with
   member Measures.[Численность постоянного населения_Prev]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения_This]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения_This]
            ) or Measures.[Численность постоянного населения_This] = 0,
            Measures.[Численность постоянного населения_Prev],
            Measures.[Численность постоянного населения_This]
        ) '
    member Measures.[Исполнено_]
    as 'IIF
        (
            (
                (
                    [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ"
                ) or
                (
                    [Территории].[Сопоставимый].CurrentMember.Level.Name = "РФ"
                )
            ),
            Measures.[Исполнено],
            Sum
            (
                Filter
                (
                    [Территории].[Сопоставимый].Children,
                    (
                        Measures.[Численность постоянного населения] <> 0
                    )
                ),
                Measures.[Исполнено_]
            )
        ) '
    member Measures.[Коэффициент бюджетной обеспеченности населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения]
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            Measures.[Исполнено_]/
            (
                Measures.[Численность постоянного населения]
                *1000
            )
        )'
   member Measures.[Ранг процент]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Процент выполнения назначений]
            ),
            null,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order
                (
                    Filter
                    (
                        [Территории].[Сопоставимый].CurrentMember.Siblings,
                        not IsEmpty
                        (
                            [Measures].[Процент выполнения назначений]
                        )
                    ),
                    [Measures].[Процент выполнения назначений],
                    DESC
                ),
                [Measures].[Процент выполнения назначений]
            )
        )'
    member Measures.[Худший ранг процент]
    as 'max
        (
            [Территории].[Сопоставимый].CurrentMember.Siblings,
            Measures.[Ранг процент]
        )'
    member Measures.[Ранг процент РФ]
    as 'IIF
        (
            IsEmpty
            (
                [Measures].[Процент выполнения назначений]
            ),
            null,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order
                (
                    Filter
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].Members,
                        not IsEmpty
                        (
                            [Measures].[Процент выполнения назначений]
                        )
                    ),
                    [Measures].[Процент выполнения назначений],
                    BDESC
                ),
                [Measures].[Процент выполнения назначений]
            )
        )'
    member Measures.[Худший ранг процент РФ]
    as 'max
        (
            [Территории].[Сопоставимый].[Субъект РФ].Members,
            Measures.[Ранг процент РФ]
        )'
    member Measures.[Ранг бюдж.обесп.]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Коэффициент бюджетной обеспеченности населения]
            ),
            null,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order
                (
                    Filter
                    (
                        [Территории].[Сопоставимый].CurrentMember.Siblings,
                        not IsEmpty
                        (
                            Measures.[Коэффициент бюджетной обеспеченности населения]
                        )
                    ),
                    Measures.[Коэффициент бюджетной обеспеченности населения],
                    DESC
                ),
                Measures.[Коэффициент бюджетной обеспеченности населения]
            )
        )'
    member Measures.[Худший ранг бюдж.обесп.]
    as 'max
        (
            [Территории].[Сопоставимый].CurrentMember.Siblings,
            Measures.[Ранг бюдж.обесп.]
        )'
    member Measures.[Ранг бюдж.обесп. РФ]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Коэффициент бюджетной обеспеченности населения]
            ),
            null,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                Order
                (
                    Filter
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].Members,
                        not IsEmpty
                        (
                            Measures.[Коэффициент бюджетной обеспеченности населения]
                        )
                    ),
                    Measures.[Коэффициент бюджетной обеспеченности населения],
                    BDESC
                ),
                Measures.[Коэффициент бюджетной обеспеченности населения]
            )
        )'
    member Measures.[Худший ранг бюдж.обесп. РФ]
    as 'max
        (
            [Территории].[Сопоставимый].[Субъект РФ].Members,
            Measures.[Ранг бюдж.обесп. РФ]
        )'
    member Measures.[Средний процент исполнения ФО]
    as 'AVG
        (
            Filter
            (
                [Территории].[Сопоставимый].CurrentMember.Siblings,
                not IsEmpty
                (
                    [Measures].[Процент выполнения назначений]
                )
            ),
            [Measures].[Процент выполнения назначений]
        ) '
    member Measures.[Средний процент исполнения РФ]
    as 'AVG
        (
            Filter
            (
                [Территории].[Сопоставимый].[Субъект РФ].Members,
                not IsEmpty
                (
                    [Measures].[Процент выполнения назначений]
                )
            ),
            [Measures].[Процент выполнения назначений]
        ) '
select
    {
        Measures.[Процент выполнения назначений],
        Measures.[Исполнено],
        Measures.[Назначено],
        Measures.[Ранг процент],
        Measures.[Худший ранг процент],
        Measures.[Ранг процент РФ],
        Measures.[Худший ранг процент РФ],
        Measures.[Коэффициент бюджетной обеспеченности населения],
        Measures.[Ранг бюдж.обесп.],
        Measures.[Худший ранг бюдж.обесп.],
        Measures.[Ранг бюдж.обесп. РФ],
        Measures.[Худший ранг бюдж.обесп. РФ],
        Measures.[Средний процент исполнения ФО],
        Measures.[Средний процент исполнения РФ],
        Measures.[Численность постоянного населения]
    } on columns
from [ФК_МесОтч_Расходы]
where
    (
        <%period_day_fk%>,
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>],
        [РзПр].[Сопоставимый].[Все коды ФКР].[Расходы бюджета - ИТОГО],
        [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта]
    )  
	]]>
  </query>
  
</root>