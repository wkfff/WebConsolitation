<?xml version="1.0" encoding="Windows-1251"?>
<root>

    <query id="fo_0003_0001_date">
        <![CDATA[
-- fo_0003_0001_date
with
    member Measures.[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
select
    {Measures.[ДанныеНа]} on columns,
    {
        Tail
        (
            NonEmptyCrossjoin
            (
                {
                    Filter
                    (
                        [Период].[Период].Members,
                        [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                        [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                        [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                        [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                        [Период].[Период].CurrentMember.Name <> "Данные года"
                    )
                }
            )
        )
    } on rows
from  [ФК_Паспорт субъекта]
  ]]>
    </query>

    <query id="fo_0003_0001_indicator">
        <![CDATA[
-- fo_0003_0001_indicator
with      
    set [Субъекты]      
    as 'Filter      
        (
            [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
            (
                not      
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                )        and not isEmpty      
                (
                    (
                        [Measures].[Темп к прошлому году],
                        [Период].[Период].CurrentMember      
                    )      
                )      
            )      
        )'      
    set [Субъекты нормализованные]      
    as 'Filter      
        (
            [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
            (
                not      
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                )        and not isEmpty      
                (
                    (
                        [Measures].[Темп нормализованный]      
                    )      
                )      
            )      
        )'      
    member [Measures].[всего субъектов нормализованных]      
    as 'count      
        (
            {
                {
                    Filter      
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                        (
                            not      
                            (
                                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                            )        and not isEmpty      
                            (
                                (
                                    [Measures].[Темп нормализованный],
                                    [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>]      
                                )      
                            )      
                        )      
                    )      
                }      
            }      
        ) + count      
        (
            {
                {
                    Filter      
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                        (
                            not      
                            (
                                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                            )        and not isEmpty      
                            (
                                (
                                    [Measures].[Темп нормализованный],
                                    [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>]      
                                )      
                            )      
                        )      
                    )      
                }      
            }      
        ) + count      
        (
            {
                {
                    Filter      
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                        (
                            not      
                            (
                                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                            )        and not isEmpty      
                            (
                                (
                                    [Measures].[Темп нормализованный],
                                    [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>]      
                                )      
                            )      
                        )      
                    )      
                }      
            }      
        ) + count      
        (
            {
                {
                    Filter      
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                        (
                            not      
                            (
                                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                            )        and not isEmpty      
                            (
                                (
                                    [Measures].[Темп нормализованный],
                                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                                )      
                            )      
                        )      
                    )      
                }      
            }      
        )'      
    member [Measures].[всего субъектов]      
    as 'count      
        (
            {
                {
                    Filter      
                    (
                        [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                        (
                            not      
                            (
                                [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                            )        and not isEmpty      
                            (
                                (
                                    [Measures].[Темп к прошлому году],
                                    [Период].[Период].CurrentMember      
                                )      
                            )      
                        )      
                    )      
                }      
                *      
                {
                    [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                    [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                    [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                }      
            }      
        )'      
    member [Территории].[Сопоставимый].[Все субъекты]      
    as 'aggregate      
        (
            Filter      
            (
                [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                (
                    not      
                    (
                        [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember      
                    )        and not isEmpty      
                    (
                        (
                            [Measures].[Темп к прошлому году]      
                        )      
                    )      
                )      
            )      
        )'      
    member [Measures].[Средний темп]      
    as 'round     
        (
            (
                Sum      
                (
                    {[Субъекты]}      
                    *      
                    {
                        [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                    } ,
                    [Measures].[Темп к прошлому году]      
                )/ [Measures].[всего субъектов]      
            ),
            2     
        )'      
    member [Measures].[Средний темп нормализованный]      
    as 'round     
        (
            (
                Sum      
                (
                    {
                        [Территории].[Сопоставимый].CurrentMember      
                    }      
                    *      
                    {
                        [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                        [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                    } ,
                    [Measures].[Темп нормализованный]      
                )/  count      
                (
                    {
                        {
                            Filter      
                            (
                                {
                                    [Территории].[Сопоставимый].CurrentMember      
                                }      
                                *      
                                {
                                    [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                                    [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                                    [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                                },
                                (
                                    not isEmpty      
                                    (
                                        (
                                            [Measures].[Темп нормализованный]      
                                        )      
                                    )      
                                )      
                            )      
                        }      
                    }      
                )      
            ),
            2    
        )'     
    member [Measures].[Отклонение]      
    as '[Measures].[Средний темп] - [Measures].[Темп к прошлому году]'      
    member [Measures].[Отклонение от нормализованных]      
    as 'IIF      
        (
            isEmpty      
            (
                (
                    [Период].[Период].CurrentMember,
                    [Территории].[Сопоставимый].CurrentMember,
                    [Measures].[Темп нормализованный]      
                )      
            ),
            null,
            [Measures].[Средний темп нормализованный] - [Measures].[Темп к прошлому году]      
        )'      
    member [Measures].[Квадрат отклонений ]      
    as '[Measures].[Отклонение]      
        *[Measures].[Отклонение] '      
    member [Measures].[Квадрат отклонений от нормализованных]      
    as '[Measures].[Отклонение от нормализованных] 
            *[Measures].[Отклонение от нормализованных]' 
    member [Measures].[Сумма отклонений нормальзованных]      
    as 'Sum   
        (
            {
                [Территории].[Сопоставимый].CurrentMember      
            }      
            *      
            {
                [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
            } ,
            [Measures].[Квадрат отклонений от нормализованных]      
        )'   
    member [Measures].[непустые темпы]      
    as 'count      
        (
            {
                {
                    Filter      
                    (
                        {
                            [Территории].[Сопоставимый].CurrentMember      
                        }      
                        *      
                        {
                            [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                            [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                            [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                            [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
                        },
                        (
                            not isEmpty      
                            (
                                (
                                    [Measures].[Темп нормализованный]      
                                )      
                            )      
                        )      
                    )      
                }      
            }      
        )'      
    member [Measures].[Сигма нормализованных]      
    as ' IIF      
        (
            [Measures].[непустые темпы] > 1,
            Round
            (
                sqr 
                (
                    [Measures].[Сумма отклонений нормальзованных] /      
                    (
                        [Measures].[непустые темпы] - 1      
                    )      
                ),
                2
            ),
            null      
        )'      
    member [Measures].[Сумма отклонений]      
    as 'Sum      
        (
            {[Субъекты]}      
            *      
            {
                [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
            } ,
            [Measures].[Квадрат отклонений ]      
        )'      
    member [Measures].[Сигма]      
    as 'round  
        (
            sqr  
            (
                [Measures].[Сумма отклонений] /      
                (
                    [Measures].[всего субъектов] - 1      
                )      
            ),
            2 
        )'  
    member [Measures].[Темп нормализованный]      
    as 'IIF      
        (
            [Measures].[Темп к прошлому году] > 0 and [Measures].[Темп к прошлому году] <= [Measures].[Средний темп] + ( 2      
            * [Measures].[Сигма] ) and [Measures].[Темп к прошлому году] >= [Measures].[Средний темп] - ( 2      
            * [Measures].[Сигма] ),
            [Measures].[Темп к прошлому году ],
            null      
        )'      
    member [Measures].[Темп уточненного плана к прошлому году ]      
    as 'Round
        (
            (
                [Период].[Период].[Данные всех периодов].[<%period_year%>],
                [Measures].[Темп уточненного плана к исполнению прошлого года]      
            ),
            2
        )' 
    member [Measures].[Верхняя граница]      
    as '[Measures].[Средний темп нормализованный] + [Measures].[Сигма нормализованных] '      
    member [Measures].[Нижняя граница]      
    as '[Measures].[Средний темп нормализованный] - [Measures].[Сигма нормализованных] '      
    member [Measures].[Внимание]  
    as 'IIF  
        (
            isEmpty  
            (
                (
                    [Период].[Период].CurrentMember,
                    [Территории].[Сопоставимый].CurrentMember,
                    [Measures].[Сигма нормализованных]  
                )  
            ),
            "Пусто в сигме",
            IIF 
            (
                isEmpty 
                (
                    [Measures].[Темп уточненного плана к прошлому году ] 
                ) or 
                (
                    [Measures].[Темп уточненного плана к прошлому году ] = 0 
                ),
                "Пусто в плане",
                 IIF  
                (
                    [Measures].[Темп уточненного плана к прошлому году ] > [Measures].[Верхняя граница],
                    "Завышение",
                    IIF  
                    (
                        [Measures].[Темп уточненного плана к прошлому году ] < [Measures].[Нижняя граница],
                        "Занижение",
                        ""  
                    )  
                )  
            )  
        )'      
    member [Период].[Период].[Четыре года]      
    as 'aggregate      
        (
            {
                [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
                [Период].[Период].[Данные всех периодов].[<%period_last_year%>]      
            }      
        )'      
    member [Measures].[Исполнено за прошлый год ]      
    as '      
        (
            [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
            [Measures].[Исполнение консолидированного бюджета]      
        ) / 1000'      
   member [Measures].[Исполнено за прошлый год всего ] 
    as ' 
        (
            [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
            [Measures].[Исполнение консолидированного бюджета],
            [Показатели].[Паспорт субъекта].[Все].[ИТОГО ДОХОДОВ]
        ) / 1000' 
    member [Measures].[Уточненный план ]
    as '
        (
            [Период].[Период].[Данные всех периодов].[<%period_year%>],
            [Measures].[Уточненный план консолидированного бюджета]
        ) / 1000'
    member [Measures].[Уточненный план всего ]
    as '
        (
            [Период].[Период].[Данные всех периодов].[<%period_year%>],
            [Measures].[Уточненный план консолидированного бюджета],
            [Показатели].[Паспорт субъекта].[Все].[ИТОГО ДОХОДОВ]
        ) / 1000'
    member [Measures].[Темп к прошлому году ]   
    as 'Round   
        (
            [Measures].[Темп к прошлому году],
            2   
        )'   
    member [Measures].[Доля в исполнении ] 
    as '[Measures].[Исполнено за прошлый год ] / [Measures].[Исполнено за прошлый год всего ]' 
    member [Measures].[Доля в уточненном плане ]
    as '[Measures].[Уточненный план ] /[Measures].[Уточненный план всего ]'
select
    {
        [Measures].[Темп к прошлому году ],
        [Measures].[Средний темп],
        [Measures].[Сигма],
        [Measures].[Темп нормализованный],
        [Measures].[всего субъектов нормализованных],
        [Measures].[Средний темп нормализованный],
        [Measures].[Квадрат отклонений от нормализованных],
        [Measures].[Сигма нормализованных],
        [Measures].[Внимание],
        [Measures].[Темп уточненного плана к прошлому году ],
        [Measures].[Верхняя граница],
        [Measures].[Нижняя граница],
        [Measures].[Исполнено за прошлый год ],
        [Measures].[Уточненный план ],
        [Measures].[Доля в исполнении ],
        [Measures].[Исполнено за прошлый год всего ],
        [Measures].[Доля в уточненном плане ]
    }on columns,
    {
        {
            [Период].[Период].[Данные всех периодов].[<%period_4_last_year%>],
            [Период].[Период].[Данные всех периодов].[<%period_3_last_year%>],
            [Период].[Период].[Данные всех периодов].[<%period_last_last_year%>],
            [Период].[Период].[Данные всех периодов].[<%period_last_year%>]   
        } 
        *   
        {
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>]    
        } 
    }
    on rows                                 
from  [ФК_Паспорт субъекта]             
where             
    (
        [Показатели].[Паспорт субъекта].[Все].[<%control%>]            
    )
    ]]>
    </query>

<query id="fo_0003_0001_indicator_outcomes">
  <![CDATA[
-- fo_0003_0001_indicator
with    
    set [Субъекты]    
    as 'Filter    
        (
            [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
            (
                not    
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember    
                )        and not isEmpty    
                (
                    (
                        [Measures].[Темп к прошлому году],
                        <%period_cur_date%>    
                    )    
                )    
            )    
        )'    
    member [Территории].[Сопоставимый].[Все субъекты]    
    as 'aggregate    
        (
            Filter    
            (
                [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
                (
                    not    
                    (
                        [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember    
                    )        and not isEmpty    
                    (
                        (
                            [Measures].[Темп к прошлому году]    
                        )    
                    )    
                )    
            )    
        )'    
    member [Measures].[всего субъектов]    
    as 'count ( {[Субъекты]} )'    
    member [Measures].[Средний темп по рф]    
    as '  round  
        (
            (
                [Measures].[Темп к прошлому году],
                [Территории].[Сопоставимый].[Все субъекты]    
            )/  [Measures].[всего субъектов] ,
            2 
        ) '  
    member [Measures].[Отклонение]    
    as 'IIF    
        (
            [Measures].[Темп к прошлому году] - [Measures].[Средний темп по рф] > 0,
            [Measures].[Темп к прошлому году] - [Measures].[Средний темп по рф],
            [Measures].[Средний темп по рф] - [Measures].[Темп к прошлому году]    
        )'    
    member [Measures].[Квадрат отклонений ]    
    as '[Measures].[Отклонение]    
        *[Measures].[Отклонение] '    
    member [Measures].[Сумма отклонений]    
    as 'Sum    
        (
            {[Субъекты]},
            [Measures].[Квадрат отклонений ]    
        )'    
    member [Measures].[Сигма]    
    as 'round    
        (
            sqr    
            (
                [Measures].[Сумма отклонений] /    
                (
                    [Measures].[всего субъектов] - 1    
                )    
            ),
            2   
        )'    
    member [Measures].[Среднее отклонение по рф]    
    as '    round
        (
            (
                [Measures].[Сумма отклонений]    
            )/  [Measures].[всего субъектов],
            2
        )' 
    member [Measures].[Верхняя граница]    
    as '[Measures].[Средний темп по рф] + [Measures].[Сигма]'    
    member [Measures].[Нижняя граница]    
    as '[Measures].[Средний темп по рф] - [Measures].[Сигма]'    
    member [Measures].[Внимание]    
    as 'IIF    
        (
            isEmpty    
            (
                [Measures].[Темп к прошлому году]    
            ) or    
            (
                [Measures].[Темп к прошлому году] = 0    
            ),
            "Пусто в темпе",
            IIF    
            (
                [Measures].[Темп к прошлому году] > [Measures].[Верхняя граница],
                "Завышение",
                IIF    
                (
                    [Measures].[Темп к прошлому году] < [Measures].[Нижняя граница],
                    "Занижение",
                    ""    
                )    
            )    
        )'    
    member [Measures].[Исполнено за прошлый год ]    
    as '    
        (
            [Период].[Период].[Данные всех периодов]<%period_last_date%>,
            [Measures].[Исполнение консолидированного бюджета]    
        ) / 1000'    
    member [Measures].[Исполнено за этот год ]    
    as '    
        (
            <%period_cur_date%>,
            [Measures].[Исполнение консолидированного бюджета]    
        ) / 1000'    
select
    {
        [Measures].[Сигма],
        [Measures].[Темп к прошлому году],
        [Measures].[Среднее отклонение по рф],
        [Measures].[Средний темп по рф],
        [Measures].[Внимание],
        [Measures].[Верхняя граница],
        [Measures].[Нижняя граница],
        [Measures].[Исполнено за прошлый год ],
        [Measures].[Исполнено за этот год ]    
    } on columns,
    { [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>] } on rows
from  [ФК_Паспорт субъекта]
where
    (
        <%period_cur_date%>,
        [Показатели].[Паспорт субъекта].[Все].[<%control%>]
    )
    ]]>
    </query>

    <query id="fo_0003_0001_241">
        <![CDATA[
-- fo_0003_0001_241 
    with                                
    member [Measures].[Исполнено]         
    as '         
        (
            [Показатели].[Паспорт субъекта].[Все нужные],
            [Measures].[Исполнение консолидированного бюджета],
            [Территории].[Сопоставимый].CurrentMember,
            <%period_cur_date%>
        )'         
    member [Measures].[Исполнено прошлый год]         
    as '         
        (
            [Показатели].[Паспорт субъекта].[Все нужные],
            [Measures].[Исполнение консолидированного бюджета],
            [Территории].[Сопоставимый].CurrentMember,
            [Период].[Период].[Данные всех периодов]<%period_last_date%>         
        )'          
    member [Measures].[Темп к прошлому году ]  
    as 'IIF  
        (
            not isEmpty  
            (
                [Measures].[Исполнено прошлый год]  
            ) and not  
            (
                [Measures].[Исполнено прошлый год] = 0  
            ),
            round 
            (
                ([Measures].[Исполнено] )/  
                (
                    [Measures].[Исполнено прошлый год]  
                ),
                2 
            ),
            null  
        )'  
    member [Measures].[Темп к прошлому году по безвозмездным]  
    as '  round
        (
            (
                [Период].[Период].[Данные всех периодов].[<%period_year%>],
                [Measures].[Темп к прошлому году],
                [Показатели].[Паспорт субъекта].[Все].[безвозмездные перечисления государственным и муниципальным предприятиям (КОСГУ 241)]  
            ),
            2
        )' 
    member [Measures].[Внимание ]  
    as 'IIF  
        (
            ([Measures].[Отклонение] > 0) and  
            (
                [Measures].[Отклонение безвозмездных]  > 0  
            ),
            1,
            IIF  
            (
                ([Measures].[Отклонение] < 0) and  
                (
                    [Measures].[Отклонение безвозмездных]  > 0  
                ) and  
                (
                    (
                        [Measures].[Отклонение безвозмездных]  
                    ) >= (-1  
                    * [Measures].[Отклонение])  
                ),
                2,
                IIF  
                (
                    ([Measures].[Отклонение] < 0) and  
                    (
                        [Measures].[Отклонение безвозмездных] < 0  
                    ),
                    3,
                    0  
                )  
            )  
        )'  
    member [Measures].[Отклонение]  
    as '[Measures].[Темп к прошлому году ] - 1'  
    member [Measures].[Отклонение безвозмездных]  
    as '[Measures].[Темп к прошлому году по безвозмездным] - 1'  
    member  [Показатели].[Паспорт субъекта].[Все нужные]  
    as 'aggregate  
        (
            {
                [Показатели].[Паспорт субъекта].[Все].[Заработная плата и начисления на неё (КОСГУ 211, 213)] ,
                [Показатели].[Паспорт субъекта].[Все].[Оплата коммунальных услуг (КОСГУ 223)] ,
                [Показатели].[Паспорт субъекта].[Все].[услуги связи (КОСГУ 221)] ,
                [Показатели].[Паспорт субъекта].[Все].[арендная плата за пользование имуществом (КОСГУ 224)]  
            }  
        )'  
select
    {
        [Measures].[Темп к прошлому году ],
        [Measures].[Отклонение],
        [Measures].[Темп к прошлому году по безвозмездным],
        [Measures].[Отклонение безвозмездных],
        [Measures].[Внимание ]
    }on columns,
    { [Территории].[Сопоставимый].[Все территории].[Российская  Федерация].[<%region%>].[<%state_area%>]  } on rows                 
from  [ФК_Паспорт субъекта] 
  ]]>
    </query>
    
</root>