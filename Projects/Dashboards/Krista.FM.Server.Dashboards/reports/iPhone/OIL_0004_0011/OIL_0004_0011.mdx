<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="OIL_0004_0011_date">
    <![CDATA[
-- OIL_0004_0011_date
with 
    member [Measures].[ДанныеНа] 
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName' 
    set [NonEmptySet] 
    as ' Head 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__Период].[Период__Период].[Данные всех периодов],
                    [Период__Период].[Период__Период].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                ) = 0 and 
                (
                    [Период__Период].[Период__Период].CurrentMember.Parent.Parent.Parent.Parent.Name = tail 
                    (
                        Filter 
                        (
                            Descendants 
                            (
                                [Период__Период].[Период__Период].[Данные всех периодов],
                                [Период__Период].[Период__Период].[День],
                                SELF_AND_AFTER 
                            ) ,
                            not IsEmpty 
                            (
                                (
                                    [Measures].[Цена],
                                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                                ) 
                            ) and not 
                            (
                                [Measures].[Цена],
                                [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                            ) = 0 
                        ),
                        1 
                    ).Item(0).Parent.Parent.Parent.Parent.Properties("Name") 
                ) 
            ),
            1 
        ) + tail 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__Период].[Период__Период].[Данные всех периодов],
                    [Период__Период].[Период__Период].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                ) = 0 
            ),
            2 
        )' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from   [ФСГС_Цены РФ] 
where 
    (
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Средняя розничная цена],
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[Бензин автомобильный марки А-76 (АИ-80)] 
    ) 
  ]]>
</query>

<query id="OIL_0004_0011_Grid">
    <![CDATA[
-- OIL_0004_0011_Grid 
with        
    member [Measures].[Уровень ]     
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name'     
    member [Measures].[Цена ]        
    as 'IIF       
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name = "РФ" or [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name = "Федеральный округ",
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.DataMember,
                [Measures].[Цена]      
            ),
            [Measures].[Цена]     
        )'      
    set [Территории]        
    as 'filter        
        (
            descendants       
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории],
                [Территории__Сопоставимый].[Территории__Сопоставимый].[РФ],
                self_and_after       
            )  ,
            not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember  and  not isEmpty ([Measures].[Цена ])       
        )'    
    member measures.[Текущая цена]     
    as ' IIF     
        (
            (
                <%period_cur_date%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            ) = 0,
            null,
            (
                <%period_cur_date%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            )     
        ) '     
    member measures.[Прошлая цена]     
    as ' IIF     
        (
            (
                <%period_last_date%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            ) = 0,
            null,
            (
                <%period_last_date%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            )     
        ) '     
    member measures.[Начало года цена]     
    as ' IIF     
        (
            (
                <%period_first_year%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            ) = 0,
            null,
            (
                <%period_first_year%>,
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Measures].[Цена ]    
            )     
        ) '     
    member measures.[Абсолютное отклонение к прошлой дате]     
    as 'measures.[Текущая цена]  - measures.[Прошлая цена]'     
    member measures.[Темп прироста (динамика к предыдущему периоду)]     
    as 'IIF     
        (
            not IsEmpty(measures.[Прошлая цена]) and not (measures.[Прошлая цена] = 0),
            (
                measures.[Текущая цена] / measures.[Прошлая цена] - 1     
            ) ,
            null     
        )'     
    member measures.[Темп прироста (динамика за период с начала года) ]     
    as 'IIF     
        (
            not IsEmpty(measures.[Начало года цена]) and not     
            (
                measures.[Начало года цена] = 0     
            ),
            (
                measures.[Текущая цена] / measures.[Начало года цена] - 1     
            ) ,
            null     
        )'     
    member measures.[Абсолютное отклонение к началу года]     
    as 'IIF     
        (
            isEmpty(measures.[Начало года цена]),
            null,
            measures.[Текущая цена]  - measures.[Начало года цена]     
        )'   
    member [Measures].[Ранг]   
    as 'IIF  
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name = "РФ" or [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Level.Name = "Федеральный округ",
            null,
            Rank  
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                Order  
                (
                    filter  
                    (
                        Descendants  
                        (
                            [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация],
                            [Территории__Сопоставимый].[Территории__Сопоставимый].[Субъект РФ],
                            self  
                        ),
                        not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember and not IsEmpty (measures.[Текущая цена])  
                    ),
                    measures.[Текущая цена],
                    BDESC
                ),
                measures.[Текущая цена]  
            ) 
        ) '  
    member Measures.[Худший ранг] 
    as 'max 
        (
            filter 
            (
                Descendants 
                (
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация],
                    [Территории__Сопоставимый].[Территории__Сопоставимый].[Субъект РФ],
                    self 
                ),
                not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember and not IsEmpty (measures.[Текущая цена]) 
            )   ,
            Measures.[Ранг] 
        )' 
select
    {
        measures.[Текущая цена],
        [Measures].[Ранг],
        measures.[Абсолютное отклонение к прошлой дате],
        measures.[Темп прироста (динамика к предыдущему периоду)],
        measures.[Абсолютное отклонение к началу года],
        measures.[Темп прироста (динамика за период с начала года) ],
        Measures.[Худший ранг] 
    }  on columns,
    {  [Территории] } on rows        
from   [ФСГС_Цены РФ]        
where        
    (
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[<%oil_federal%>] 
    )  
  ]]>
  </query>
  
</root>