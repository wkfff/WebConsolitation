<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="Oil_0009_0002_04_incomes_regional_date">
    <![CDATA[ -- Oil_0009_0002_04_incomes_regional_date
with
    member [Measures].[ДанныеНа]
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Union
        (
            Tail
            (
                Filter
                (
                    Descendants
                    (
                        [Период__Период].[Период__Период].[Данные всех периодов],
                        [Период__Период].[Период__Период].[День],
                        SELF_AND_AFTER
                    ) ,
                    not IsEmpty([Measures].[Розничная цена]) and not [Measures].[Розничная цена] = 0 and
                    (
                        Ancestor
                        (
                            [Период__Период].[Период__Период].CurrentMember,
                            [Период__Период].[Период__Период].[Год]
                        ).Name = tail
                        (
                            Filter
                            (
                                [Период__Период].[Период__Период].[Год].Members,
                                not IsEmpty
                                (
                                    (
                                        [Measures].[Розничная цена],
                                        [Организации__Виды ГСМ].[Организации__Виды ГСМ].CurrentMember
                                    )
                                ) and not
                                (
                                    [Measures].[Розничная цена],
                                    [Организации__Виды ГСМ].[Организации__Виды ГСМ].CurrentMember
                                ) = 0
                            ),
                            2
                        ).Item(0).Properties("Name")
                    )
                ),
                1
            ),
            tail
            (
                Filter
                (
                    Descendants
                    (
                        [Период__Период].[Период__Период].[Данные всех периодов],
                        [Период__Период].[Период__Период].[День],
                        SELF_AND_AFTER
                    ) ,
                    not IsEmpty
                    (
                        (
                            [Measures].[Розничная цена],
                            [Организации__Виды ГСМ].[Организации__Виды ГСМ].CurrentMember
                        )
                    ) and not
                    (
                        [Measures].[Розничная цена],
                        [Организации__Виды ГСМ].[Организации__Виды ГСМ].CurrentMember
                    ) = 0
                ),
                2
            ),
            All
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [Организации_Цены на ГСМ]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены на ГСМ],
        [Организации__Виды ГСМ].[Организации__Виды ГСМ].[АИ-92]
    )
    ]]>
  </query>

  <query id="Oil_0009_0002_04_incomes_federal_date">
    <![CDATA[ -- Oil_0009_0002_04_incomes_federal_date
with
    member [Measures].[ДанныеНа]
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Union
        (
            Tail
            (
                Filter
                (
                    Descendants
                    (
                        [Период__Период].[Период__Период].[Данные всех периодов],
                        [Период__Период].[Период__Период].[День],
                        SELF_AND_AFTER
                    ) ,
                    not IsEmpty
                    (
                        (
                            [Measures].[Цена],
                            [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                        )
                    ) and not
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                    ) = 0 and
                    (
                        [Период__Период].[Период__Период].CurrentMember.Parent.Parent.Parent.Parent.Name = tail
                        (
                            Filter
                            (
                                [Период__Период].[Период__Период].[Год].Members,
                                not IsEmpty
                                (
                                    (
                                        [Measures].[Цена],
                                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                                    )
                                ) and not
                                (
                                    [Measures].[Цена],
                                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                                ) = 0
                            ),
                            2
                        ).Item(0).Properties("Name")
                    )
                ),
                1
            ),
            tail
            (
                Filter
                (
                    Descendants
                    (
                        [Период__Период].[Период__Период].[Данные всех периодов],
                        [Период__Период].[Период__Период].[День],
                        SELF_AND_AFTER
                    ) ,
                    not IsEmpty
                    (
                        (
                            [Measures].[Цена],
                            [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                        )
                    ) and not
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember
                    ) = 0
                ),
                2
            ),
            All
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФСГС_Цены РФ]
where
    (
        [Источники данных].[Источники данных].[Все источники данных],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Средняя розничная цена],
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[Бензин автомобильный марки АИ-92 (АИ-93 и т.п.)]
    )
    ]]>
  </query>

  <query id="Oil_0009_0002_04_table1">
    <![CDATA[ -- Oil_0009_0002_04_table1
with      
    member [Организации__АЗС].[Организации__АЗС].[sumregion]
    as 'Aggregate
        (
            Filter
            (
                [Организации__АЗС].[Организации__АЗС].[АЗС].members,
                not isempty
                (
                    [Организации__АЗС].[Организации__АЗС].currentmember
                ) and [Организации__АЗС].[Организации__АЗС].currentmember > 0
            )
        )/ Filter
        (
            [Организации__АЗС].[Организации__АЗС].[АЗС].members,
            not isempty
            (
                [Организации__АЗС].[Организации__АЗС].currentmember
            ) and [Организации__АЗС].[Организации__АЗС].currentmember > 0
        ).count'
    set [Предприятия] 
    as ' 
        {
            [Организации__АЗС].[Организации__АЗС].[Итого] 
        } + Filter 
        (
            [Организации__АЗС].[Организации__АЗС].[АЗС].members,
            not isempty 
            (
                ([Организации__АЗС].[Организации__АЗС].currentmember, measures.[Текущая цена])
            ) and ([Организации__АЗС].[Организации__АЗС].currentmember, measures.[Текущая цена] )> 0
        ) '  
    member [Организации__АЗС].[Организации__АЗС].[Итого]
    as '
        (
            [Measures].CurrentMember,
            [Территории__РФ].[Территории__РФ].currentmember,
            [Организации__АЗС].[Организации__АЗС].[sumregion]
        )'
    set [Территории]
    as 'Filter
        (
            Generate  
            (
                Filter   
                (
                    {
                        [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра]
                    } + Descendants   
                    (
                        [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра],
                        [Территории__РФ].[Территории__РФ].[МР ГО],
                        SELF   
                    ),
                    [Территории__РФ].[Территории__РФ].CurrentMember.Name = "<%selected_subject%>" 
                ),
                IIF
                (
                    [Территории__РФ].[Территории__РФ].CurrentMember is [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра],
                    Descendants
                    (
                        [Территории__РФ].[Территории__РФ].CurrentMember ,
                        [Территории__РФ].[Территории__РФ].[МР ГО],
                        SELF
                    ),
                    {
                        [Территории__РФ].[Территории__РФ].CurrentMember   
                    } + Descendants    
                    (
                        [Территории__РФ].[Территории__РФ].CurrentMember ,
                        [Территории__РФ].[Территории__РФ].[МР ГО],
                        SELF    
                    )
                ) 
            ),
            not [Территории__РФ].[Территории__РФ].currentmember.is_datamember and not IsEmpty (measures.[Текущая цена] )    
        )'
    member [Measures].[Имя]
    as 'IIF
        (
            [Организации__АЗС].[Организации__АЗС].CurrentMember is [Организации__АЗС].[Организации__АЗС].[ХМАО],
            [Организации__АЗС].[Организации__АЗС].currentmember.Name,
            IIF
            (
                [Организации__АЗС].[Организации__АЗС].CurrentMember is [Организации__АЗС].[Организации__АЗС].[Итого],
                [Территории__РФ].[Территории__РФ].currentmember.Name,
                [Организации__АЗС].[Организации__АЗС].CurrentMember.Properties("Краткое наименование") + " (" +
                filter([Организации__Владельцы АЗС].[Организации__Владельцы АЗС].[Владелец].Members,
                not IsEmpty(measures.[Текущая цена])).Item(0).Name + ")"
            )
        )    '
    member [Measures].[Уровень]  
    as ' IIF  
        (
            [Организации__АЗС].[Организации__АЗС].CurrentMember is [Организации__АЗС].[Организации__АЗС].[Итого] or
            [Организации__АЗС].[Организации__АЗС].CurrentMember is [Организации__АЗС].[Организации__АЗС].[ХМАО],
            1,
            2  
        ) '  
    member measures.[Текущая цена]
    as ' IIF
        (
            (
                <%period_cur_date%>,
                [Measures].[Розничная цена]
            ) = 0,
            null,
            Round
            (
                (
                  <%period_cur_date%>,
                  [Measures].[Розничная цена]
                ),
                2
            )
        ) '
    member measures.[Прошлая цена]
    as ' IIF
        (
            (
                <%period_last_date%>,
                [Measures].[Розничная цена]
            ) = 0,
            null,
            Round
            (
                (
                  <%period_last_date%>,
                  [Measures].[Розничная цена]
                ),
                2
            )
        ) '
    member measures.[Начало года цена]
    as ' IIF
        (
            (
                <%period_first_year%>,
                [Measures].[Розничная цена]
            ) = 0,
            null,
            (
                <%period_first_year%>,
                [Measures].[Розничная цена]
            )
        ) '
    member measures.[Абсолютное отклонение к прошлой дате]      
    as 'IIF      
        (
            isEmpty( measures.[Прошлая цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Прошлая цена]   
        )'  
    member measures.[Абсолютное отклонение к началу года]   
    as 'IIF   
        (
            isEmpty(measures.[Начало года цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Начало года цена]   
        )'   
    member measures.[Темп прироста (динамика к предыдущему периоду)]      
    as 'IIF
        (
            IsEmpty(measures.[Прошлая цена]) or
            (
                measures.[Прошлая цена] = 0
            ),
            null,
            IIF
            (
                (
                    measures.[Текущая цена] = measures.[Прошлая цена]
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Прошлая цена] - 1
                )
            )
        )'
    member measures.[Темп прироста (динамика за период с начала года) ]      
    as 'IIF      
        (
            IsEmpty(measures.[Начало года цена]) or
            (
                measures.[Начало года цена] = 0      
            ),
            null,
            IIF     
            (
                (
                    measures.[Текущая цена] = measures.[Начало года цена]      
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Начало года цена] - 1      
                )      
            )     
        )'    	      

    set [Строки]           
    as '  
        {
            {
                [Территории__РФ].[Территории__РФ].[Все территории]
            }
            *
            {
                [Организации__АЗС].[Организации__АЗС].[ХМАО]
            }
        } +     filter  
        (
            {
                { [Территории] }     
                * [Предприятия]   
            },
            not isEmpty ([Measures].[Розничная цена])       
        )'
    member [Территории__РФ].[Территории__РФ].[Аггрегированные территории]     
    as 'aggregate ([Территории])'     
    member [Территории__РФ].[Территории__РФ].[ХМАО-Югра]   
    as '   
        (
            [Территории__РФ].[Территории__РФ].[Аггрегированные территории]   
        ) / [Территории].Count' 
        
    set [Территории ХМАО]
    as 'Filter
        (
            Descendants
            (
                [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ханты-Мансийский автономный округ - Югра],
                [Территории__РФ].[Территории__РФ].[МР ГО],
                SELF
            ),
            not
            (
                [Территории__РФ].[Территории__РФ].CurrentMember is [Территории__РФ].[Территории__РФ].CurrentMember.Parent.DataMember
            )
        )'
    set [Организации]
    as 'Descendants
        (
            [Организации__АЗС].[Организации__АЗС].[Все].[ОРГАНИЗАЦИИ Цены на ГСМ],
            [Организации__АЗС].[Организации__АЗС].[АЗС],
            SELF
        )'
    member [Организации__АЗС].[Организации__АЗС].[ХМАО]
    as 'AVG
        (
            {
                [Территории ХМАО]
                * [Организации]
            }
        )'        
select
    {
        [Measures].[Имя],
        measures.[Текущая цена],
        measures.[Абсолютное отклонение к прошлой дате],
        measures.[Темп прироста (динамика к предыдущему периоду)],
        measures.[Абсолютное отклонение к началу года],
        measures.[Темп прироста (динамика за период с начала года) ],
        [Measures].[Уровень]
    }  on columns,
    {[Строки]} on rows
from [Организации_Цены на ГСМ]
where      
    (
        [Организации__Виды ГСМ].[Организации__Виды ГСМ].[Все].[ОРГАНИЗАЦИИ Цены на ГСМ].[Дизельное топливо]
    )
    ]]>
  </query>

  <query id="Oil_0009_0002_04_table2">
    <![CDATA[ -- Oil_0009_0002_04_table2
WITH  
    member [Measures].[Текущая средняя цена ]  
    as 'measures.[Текущая цена]'  
   member measures.[Текущая цена] 
    as ' IIF 
        (
            (
                <%period_cur_date%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_cur_date%>,
                [Measures].[Цена] 
            ) 
        ) ' 
    member measures.[Прошлая цена] 
    as ' IIF 
        (
            (
                <%period_last_date%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_last_date%>,
                [Measures].[Цена] 
            ) 
        ) ' 
    member measures.[Начало года цена] 
    as ' IIF 
        (
            (
                <%period_first_year%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_first_year%>,
                [Measures].[Цена] 
            ) 
        ) ' 
     member measures.[Абсолютное отклонение к прошлой дате]      
    as 'IIF      
        (
            isEmpty( measures.[Прошлая цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Прошлая цена]   
        )'  
    member measures.[Абсолютное отклонение к началу года]   
    as 'IIF   
        (
            isEmpty(measures.[Начало года цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Начало года цена]   
        )'   
    member measures.[Темп прироста (динамика к предыдущему периоду)]      
    as 'IIF
        (
            IsEmpty(measures.[Прошлая цена]) or
            (
                measures.[Прошлая цена] = 0
            ),
            null,
            IIF
            (
                (
                    measures.[Текущая цена] = measures.[Прошлая цена]
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Прошлая цена] - 1
                )
            )
        )'
    member measures.[Темп прироста (динамика за период с начала года) ]      
    as 'IIF      
        (
            IsEmpty(measures.[Начало года цена]) or
            (
                measures.[Начало года цена] = 0      
            ),
            null,
            IIF     
            (
                (
                    measures.[Текущая цена] = measures.[Начало года цена]      
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Начало года цена] - 1      
                )      
            )     
        )'    	      
    set [Территории]  
    as 'filter  
        (
            Descendants  
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Субъект РФ],
                LEAVES  
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember and not IsEmpty ([Measures].[Цена])  
        )'  
   
   
    member [Measures].[Имя]  
    as '  [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.Name'  
    member [Measures].[Уровень] 
    as '1' 
   member [Территории__Сопоставимый].[Территории__Сопоставимый].[ХМАО]
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ]'

SELECT
    {
        [Measures].[Имя],
        measures.[Текущая цена],
        measures.[Абсолютное отклонение к прошлой дате],
        measures.[Темп прироста (динамика к предыдущему периоду)],
        measures.[Абсолютное отклонение к началу года],
        measures.[Темп прироста (динамика за период с начала года) ],
        [Measures].[Уровень]
    } on columns,
    {
    [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].DataMember,
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].DataMember,
         [Территории__Сопоставимый].[Территории__Сопоставимый].[ХМАО]
    } on rows  
from [ФСГС_Цены РФ]  
where  
    (
        [Источники данных].[Источники данных].[Все источники данных],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Средняя розничная цена],
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[Дизельное топливо]  
    )  
    ]]>
  </query>
</root>