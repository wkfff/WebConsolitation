<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="EO_0001_0001_lastDate">
    <![CDATA[ 
-- EO_0001_0001_lastDate
with
    member [Measures].[ДанныеНа] 
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName' 
    set [NonEmptySet] 
    as 'Tail 
        (
            Filter 
            (
                [Период__Период].[Период__Период].[Месяц].AllMembers,
                not IsEmpty( Measures.[Отчет] ) and Str
                (
                    [Период__Период].[Период__Период].CurrentMember.Properties("MEMBER_KEY")
                ) > 0 
            ),
            1 
        )' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from [ЭО_Мониторинг строительства_Объекты строительства]      
    ]]>
  </query>

  <query id="EO_0001_0001_commonGrid">
    <![CDATA[ 
-- EO_0001_0001_commonGrid
with       
    set [Заказчики]       
    as '[Строительство__Заказчики].[Строительство__Заказчики].[Все заказчики].Children'    
    member [Строительство__Заказчики].[Строительство__Заказчики].[Всего по АИП]       
    as 'Aggregate({[Заказчики]})'        
    member [Строительство__Ход работ].[Строительство__Ход работ].[Количество объектов]       
    as 'Count       
        (
            Filter       
            (
                [Строительство__Характеристика объектов].[Строительство__Характеристика объектов].[Все контракты].Children,
                not IsEmpty      
                (
                    (
                        Measures.[Отчет],
                        [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников],
                        <%current_period%>    
                    )      
                )       
            )       
        )'       
    member [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.]       
    as '[Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Сметная стоимость].[в прогнозном уровне цен или предполагаемая (предельная) стоимость строительства]'       
    member [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.]       
    as 'Aggregate       
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Финансирование за отчётный период текущего года].DataMember,
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем финансирования с начала строительства на 01.01.11 года].DataMember       
            }       
        )'       
    member [Строительство__Ход работ].[Строительство__Ход работ].[Освоено с начала строительства, млн.р.]       
    as 'Aggregate       
        (
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Освоено капитальных вложений в текущих ценах за отчетный период текущего года].DataMember,
                [Строительство__Ход работ].[Строительство__Ход работ].[Данные всех источников].[Объем незавершенного строительства в текущих ценах на 01.01.11 г.].[ВСЕГО:]       
            }       
        )'       
    member Measures.[Колонка для индикации]     
    as 'IIF      
        (
            [Строительство__Ход работ].[Строительство__Ход работ].CurrentMember is [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.],
            IIF   
            (
                IsEmpty   
                (
                    (
                        Measures.[Отчет],
                        [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.]
                    )   
                ) or    
                (
                    (
                        Measures.[Отчет],
                       [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.]
                    )   
                ) = 0,
                null,
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.]
                )/   
                (
                    Measures.[Отчет],
                   [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.]
                )   
            ),
            IIF  
            (
                [Строительство__Ход работ].[Строительство__Ход работ].CurrentMember is [Строительство__Ход работ].[Строительство__Ход работ].[Освоено с начала строительства, млн.р.],
                Str(Measures.[Процент от финансирования]) + ";" + Str(Measures.[Процент от стоимости строительства]),
                " "
            )   
        )'  
    member Measures.[Процент от финансирования] 
    as 'IIF 
        (
            IsEmpty 
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.] 
                ) 
            ) or 
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.] 
                ) 
            ) = 0,
            null,
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено с начала строительства, млн.р.] 
            )/ 
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.] 
            ) 
        )'  
    member Measures.[Процент от стоимости строительства] 
    as 'IIF 
        (
            IsEmpty 
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.] 
                ) 
            ) or 
            (
                (
                    Measures.[Отчет],
                    [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.] 
                ) 
            ) = 0,
            null,
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено с начала строительства, млн.р.]
            )/ 
            (
                Measures.[Отчет],
                [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.] 
            ) 
        )' 
        
    member Measures.[Тип строки]     
    as 'IIF      
        (
            [Строительство__Ход работ].[Строительство__Ход работ].CurrentMember is [Строительство__Ход работ].[Строительство__Ход работ].[Количество объектов],
            0,
            IIF     
            (
                [Строительство__Ход работ].[Строительство__Ход работ].CurrentMember is [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.],
                1,
                IIF     
                (
                    [Строительство__Ход работ].[Строительство__Ход работ].CurrentMember is [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.],
                    2,
                    3    
                )     
            )     
        )'    
    member Measures.[Заказчик]     
    as '[Строительство__Заказчики].[Строительство__Заказчики].CurrentMember.Name' 
    member Measures.[Показатель]     
    as '[Строительство__Ход работ].[Строительство__Ход работ].CurrentMember.Name'       
select
    {
        Measures.[Заказчик],
        Measures.[Показатель],
        Measures.[Отчет],
        Measures.[Колонка для индикации],
        Measures.[Тип строки]     
    } on columns,
    Filter       
    (
        {
            {{[Строительство__Заказчики].[Строительство__Заказчики].[Всего по АИП]} + [Заказчики]}
            *       
            {
                [Строительство__Ход работ].[Строительство__Ход работ].[Количество объектов],
                [Строительство__Ход работ].[Строительство__Ход работ].[Предполагаемая стоимость строительства, млн.р.],
                [Строительство__Ход работ].[Строительство__Ход работ].[Профинансировано с начала строительства, млн.р.],
                [Строительство__Ход работ].[Строительство__Ход работ].[Освоено с начала строительства, млн.р.]       
            }       
        },
        (
            [Строительство__Ход работ].[Строительство__Ход работ].[Количество объектов]      
        ) <> 0      
    ) on rows       
from [ЭО_Мониторинг строительства_Объекты строительства]       
where       
    (
        <%current_period%>,
        [Территории__РФ].[Территории__РФ].[Все территории].[Российская Федерация].[Уральский федеральный округ].[Тюменская область с Ханты-Мансийским автономным округом, Ямало-Ненецким автономным округом].[Ямало-Ненецкий автономный округ]       
    )       
    ]]>
  </query>

</root>