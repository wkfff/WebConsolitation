<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="Oil_0007_0004_incomes_regional_date">
    <![CDATA[ -- Oil_0007_0004_incomes_regional_date
with 
    member [Measures].[ДанныеНа] 
    as '[Период__День].[Период__День].CurrentMember.UniqueName'
    set [NonEmptySet] 
    as 'Union(Head 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__День].[Период__День].[Данные всех периодов],
                    [Период__День].[Период__День].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                ) = 0 and 
                (
                    [Период__День].[Период__День].CurrentMember.Parent.Parent.Parent.Parent.Name = tail
                    (
                        Filter 
                        (
                            Descendants 
                            (
                                [Период__День].[Период__День].[Данные всех периодов],
                                [Период__День].[Период__День].[День],
                                SELF_AND_AFTER 
                            ) ,
                            not IsEmpty 
                            (
                                (
                                    [Measures].[Цена],
                                    [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                                ) 
                            ) and not 
                            (
                                [Measures].[Цена],
                                [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                            ) = 0 
                        ),
                        1 
                    ).Item(0).Parent.Parent.Parent.Parent.Properties("Name") 
                ) 
            ),
            1 
        ),
        tail 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__День].[Период__День].[Данные всех периодов],
                    [Период__День].[Период__День].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Организации__Товары и услуги].[Организации__Товары и услуги].CurrentMember
                ) = 0 
            ),
            2 
        ), All)' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from [Организации_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации__Тип цены].[Организации__Тип цены].[Тип цены].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
    )
    ]]>
  </query>

  <query id="Oil_0007_0004_incomes_federal_date">
    <![CDATA[ -- Oil_0007_0004_incomes_federal_date
with 
    member [Measures].[ДанныеНа] 
    as '[Период__Период].[Период__Период].CurrentMember.UniqueName'
    set [NonEmptySet] 
    as 'Union(Head 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__Период].[Период__Период].[Данные всех периодов],
                    [Период__Период].[Период__Период].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                ) = 0 and 
                (
                    [Период__Период].[Период__Период].CurrentMember.Parent.Parent.Parent.Parent.Name = tail 
                    (
                        Filter 
                        (
                            Descendants 
                            (
                                [Период__Период].[Период__Период].[Данные всех периодов],
                                [Период__Период].[Период__Период].[День],
                                SELF_AND_AFTER 
                            ) ,
                            not IsEmpty 
                            (
                                (
                                    [Measures].[Цена],
                                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                                ) 
                            ) and not 
                            (
                                [Measures].[Цена],
                                [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                            ) = 0 
                        ),
                        1 
                    ).Item(0).Parent.Parent.Parent.Parent.Properties("Name") 
                ) 
            ),
            1 
        ),
        tail 
        (
            Filter 
            (
                Descendants 
                (
                    [Период__Период].[Период__Период].[Данные всех периодов],
                    [Период__Период].[Период__Период].[День],
                    SELF_AND_AFTER 
                ) ,
                not IsEmpty 
                (
                    (
                        [Measures].[Цена],
                        [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                    ) 
                ) and not 
                (
                    [Measures].[Цена],
                    [Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember 
                ) = 0 
            ),
            2 
        ), All)' 
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows 
from   [ФСГС_Цены РФ] 
where 
    (
        [Источники данных].[Источники данных].[Все источники данных],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Средняя розничная цена],
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ханты-Мансийский автономный округ],
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[<%oil_federal%>] 
    )
    ]]>
  </query>
    
  <query id="Oil_0007_0004_table1">
    <![CDATA[ -- Oil_0007_0004_table1
with
    member [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО]
    as 'null'
    set [Организации]
    as ' [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО] + [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].Children - [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Значение не указано]'
    set [Все организации]
    as '[Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации]'
    set [Территории]
    as '[Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ямало-Ненецкий автономный округ].Children -
        {
            [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ямало-Ненецкий автономный округ].[Бюджет субъекта ЯНАО],
            [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ямало-Ненецкий автономный округ].DATAMEMBER
        }'
    set [ЯНАО]
    as '
        {
            [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].[Ямало-Ненецкий автономный округ]
        }'
    member [Measures].[Текущая цена Организация]
    as '
        (
            <%period_cur_date%>,
            [Measures].[Цена]
        )'
    member [Measures].[Прошлая цена Организация]
    as '
        (
            <%period_last_date%>,
            [Measures].[Цена]
        )'
    member [Measures].[Начало года цена Организация]
    as '
        (
            <%period_first_year%>,
            [Measures].[Цена]
        )'
    member [Measures].[Текущая цена МО]
    as 'avg
        (
            [Организации],
            [Measures].[Текущая цена Организация]
        )'
    member [Measures].[Прошлая цена МО]
    as 'avg
        (
            [Организации],
            [Measures].[Прошлая цена Организация]
        )'
    member [Measures].[Начало года цена МО]
    as 'avg
        (
            [Организации],
            [Measures].[Начало года цена Организация]
        )'
    member [Measures].[Текущая цена ЯНАО]
    as 'avg
        (
            [Организации] * [Территории],
            [Measures].[Текущая цена Организация]
        )'
    member [Measures].[Прошлая цена ЯНАО]
    as 'avg
        (
            [Организации] * [Территории],
            [Measures].[Прошлая цена Организация]
        )'
    member [Measures].[Начало года цена ЯНАО]
    as 'avg
        (
            [Организации] * [Территории],
            [Measures].[Начало года цена Организация]
        )'
    member [Measures].[Абсолютное отклонение к прошлой дате]
    as '[Measures].[Текущая цена] - [Measures].[Прошлая цена]'
    member [Measures].[Темп прироста (динамика к предыдущему периоду)]
    as 'iif
        (
            not IsEmpty([Measures].[Прошлая цена]) and not ([Measures].[Прошлая цена] = 0),
            (
                [Measures].[Текущая цена] / [Measures].[Прошлая цена] - 1
            ),
            null
        )'
    member [Measures].[Темп прироста (динамика за период с начала года) ]
    as 'iif
        (
            not IsEmpty([Measures].[Начало года цена]) and not
            (
                [Measures].[Начало года цена] = 0
            ),
            (
                [Measures].[Текущая цена] / [Measures].[Начало года цена] - 1
            ),
            null
        )'
    member [Measures].[Абсолютное отклонение к началу года]
    as 'iif
        (
            isEmpty([Measures].[Начало года цена]),
            null,
            [Measures].[Текущая цена] - [Measures].[Начало года цена]
        )'
    member [Measures].[Текущая цена]
    as 'iif
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Name = "Ямало-Ненецкий автономный округ",
            [Measures].[Текущая цена ЯНАО],
            iif
            (
                [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
                [Measures].[Текущая цена МО],
                [Measures].[Текущая цена Организация]
            )
        )'
    member [Measures].[Прошлая цена]
    as 'iif
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Name = "Ямало-Ненецкий автономный округ",
            [Measures].[Прошлая цена ЯНАО],
            iif
            (
                [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
                [Measures].[Прошлая цена МО],
                [Measures].[Прошлая цена Организация]
            )
        )'
    member [Measures].[Начало года цена]
    as 'iif
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Name = "Ямало-Ненецкий автономный округ",
            [Measures].[Начало года цена ЯНАО],
            iif
            (
                [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
                [Measures].[Начало года цена МО],
                [Measures].[Начало года цена Организация]
            )
        )'
    member [Measures].[Фильтр]
    as 'iif
        (
            not  IsEmpty
            (
                [Measures].[Текущая цена Организация]
            ) or [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
            1,
            0
        )'
    member [Measures].[Уровень]
    as 'iif
        (
            [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
            1,
            2
        )'
    member [Measures].[Имя]
    as 'iif
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember.Name = "Ямало-Ненецкий автономный округ",
            "ЯНАО",
            iif
            (
                [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember is [Организации__Предприятия торговли].[Организации__Предприятия торговли].[Все организации].[Среднее по МО],
                [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.Name,
                [Организации__Предприятия торговли].[Организации__Предприятия торговли].CurrentMember.Name
            )
        )'
select
    {
        [Measures].[Имя],
        [Measures].[Текущая цена],
        [Measures].[Абсолютное отклонение к прошлой дате],
        [Measures].[Темп прироста (динамика к предыдущему периоду)],
        [Measures].[Абсолютное отклонение к началу года],
        [Measures].[Темп прироста (динамика за период с начала года) ],
        [Measures].[Уровень]
    } on columns,
    filter
    (
        {
            {[ЯНАО]
            * [Все организации]} + {[Территории]
            * [Организации]}
        },
        [Measures].[Фильтр] = 1
    ) on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where
    (
        [Источники данных].[Источники данных].[Все источники данных].[ОРГАНИЗАЦИИ Цены и тарифы],
        [Организации__Тип цены].[Организации__Тип цены].[Тип цены].[Розничная цена],
        [Организации__Товары и услуги].[Организации__Товары и услуги].[Все товары и услуги].[Непродовольственные товары].[Горюче-смазочные материалы].[<%oil%>]
    )
    ]]>
  </query>

  <query id="Oil_0007_0004_table2">
    <![CDATA[ -- Oil_0007_0004_table2
WITH  
    member [Measures].[Текущая средняя цена ]  
    as 'measures.[Текущая цена]'  
   member measures.[Текущая цена] 
    as ' IIF 
        (
            (
                <%period_cur_date%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_cur_date%>,
                [Measures].[Цена] 
            ) 
        ) ' 
    member measures.[Прошлая цена] 
    as ' IIF 
        (
            (
                <%period_last_date%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_last_date%>,
                [Measures].[Цена] 
            ) 
        ) ' 
    member measures.[Начало года цена] 
    as ' IIF 
        (
            (
                <%period_first_year%>,
                [Measures].[Цена] 
            ) = 0,
            null,
            (
                <%period_first_year%>,
                [Measures].[Цена] 
            ) 
        ) ' 
     member measures.[Абсолютное отклонение к прошлой дате]      
    as 'IIF      
        (
            isEmpty( measures.[Прошлая цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Прошлая цена]   
        )'  
    member measures.[Абсолютное отклонение к началу года]   
    as 'IIF   
        (
            isEmpty(measures.[Начало года цена]) or isEmpty( measures.[Текущая цена]),
            null,
            measures.[Текущая цена]  - measures.[Начало года цена]   
        )'   
    member measures.[Темп прироста (динамика к предыдущему периоду)]      
    as 'IIF
        (
            IsEmpty(measures.[Прошлая цена]) or
            (
                measures.[Прошлая цена] = 0
            ),
            null,
            IIF
            (
                (
                    measures.[Текущая цена] = measures.[Прошлая цена]
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Прошлая цена] - 1
                )
            )
        )'
    member measures.[Темп прироста (динамика за период с начала года) ]      
    as 'IIF      
        (
            IsEmpty(measures.[Начало года цена]) or
            (
                measures.[Начало года цена] = 0      
            ),
            null,
            IIF     
            (
                (
                    measures.[Текущая цена] = measures.[Начало года цена]      
                ),
                0,
                (
                    measures.[Текущая цена] / measures.[Начало года цена] - 1      
                )      
            )     
        )'    	      
    set [Территории]  
    as 'filter  
        (
            Descendants  
            (
                [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
                [Территории__Сопоставимый].[Территории__Сопоставимый].[Субъект РФ],
                LEAVES  
            ),
            not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember and not IsEmpty ([Measures].[Цена])  
        )'  
   
   
    member [Measures].[Имя]  
    as '  [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.Name'  
    member [Measures].[Уровень] 
    as '1' 
    member Measures.[Ранг цена]
    as '0'
    member Measures.[Худший ранг цена]
    as '100'
SELECT
    {
        [Measures].[Имя],
        measures.[Текущая цена],
        measures.[Абсолютное отклонение к прошлой дате],
        measures.[Темп прироста (динамика к предыдущему периоду)],
        measures.[Абсолютное отклонение к началу года],
        measures.[Темп прироста (динамика за период с начала года) ],
        [Measures].[Уровень]
    } on columns,
    {
    [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].DataMember,
        [Территории__Сопоставимый].[Территории__Сопоставимый].[Все территории].[Российская  Федерация].[Уральский федеральный округ].DataMember
         
    } on rows  
from [ФСГС_Цены РФ]  
where  
    (
        [Источники данных].[Источники данных].[Все источники данных],
        [Организации__Тип цены].[Организации__Тип цены].[Все типы цен].[Средняя розничная цена],
        [Продукция__Сопоставимый].[Продукция__Сопоставимый].[Все виды продукции].[<%oil_federal%>]  
    )  
    ]]>
  </query>

</root>