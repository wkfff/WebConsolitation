<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="Oil_0006_0004_03_lastDate">
    <![CDATA[
-- Oil_0006_0004_03_lastDate
with
    member Measures.[ДанныеНа]
    as '[Период].[День].CurrentMember.UniqueName'
select
    {Measures.[ДанныеНа]} on columns,
    Tail
    (
        Filter
        (
            OpeningPeriod
            (
                [Период].[День].[День],
                [Период].[День].[Данные всех периодов].[2008]
            ) : ClosingPeriod
            (
                [Период].[День].[День],
                [Период].[День].[Данные всех периодов].[2012]
            ),
            not IsEmpty([Measures].[Цена])
        )
    ) on rows
from [ОРГАНИЗАЦИИ_Цены и тарифы]
where                        
    (
         [Организации].[Реестр продукции сопоставимый].[Вся продукуция].[Дизельное топливо]
    )                        
  ]]>
  </query>

  <query id="OIL_0006_0004_03_Grid">
    <![CDATA[
-- OIL_0006_0004_03_Grid 
with  
    member [Период].[День].[Отчетная дата]  
    as '<%period_cur_date%>'             
    member [Период].[День].[30 декабря прошлого года]                  
    as '<%period_last_date%>'
    member [Период].[День].[абсолютное откл] 
    as 'IIF 
        (
            isEmpty 
            (
                [Период].[День].[Отчетная дата] 
            )or isEmpty 
            (
                [Период].[День].[30 декабря прошлого года] 
            ),
            null,
            IIF
            (
                (
                    [Период].[День].[Отчетная дата] = 0
                ),
                null,
                [Период].[День].[Отчетная дата]-[Период].[День].[30 декабря прошлого года] 
            )
        )' 
    member [Период].[День].[темп прироста] 
    as 'IIF 
        (
            IsEmpty
            (
                [Период].[День].[30 декабря прошлого года]
            ) or 
            (
                [Период].[День].[30 декабря прошлого года]
            ) = 0,
            null,
            [Период].[День].[абсолютное откл] / [Период].[День].[30 декабря прошлого года] 
        ) '   
    set [Организации] 
    as 'filter 
        (
            descendants 
            (
                [Организации].[Предприятия торговли].[Все организации],
                [Организации].[Предприятия торговли].[Все организации].Level ,
                AFTER 
            )  ,
            not 
            (
                [Организации].[Предприятия торговли].Currentmember is [Организации].[Предприятия торговли].Currentmember.Parent.DataMember
            ) and not isEmpty ([Measures].[Цена]) 
        )' 
    set [Территории] 
    as 'Filter      
        (
            Generate       
            (
                Descendants            
                (
                    [Территории].[РФ].[Все территории],
                    [Территории].[РФ].[Субъект РФ],
                    SELF            
                ),
                {
                    [Территории].[РФ].CurrentMember,
                    [Территории].[РФ].CurrentMember.DataMember        
                }  + Filter  
                  (
                      Descendants 
                      (
                          [Территории].[РФ].CurrentMember,
                          [Территории].[РФ].[МР ГО],
                          SELF 
                      ),
                      not ([Территории].[РФ].CurrentMember is [Территории].[РФ].CurrentMember.Parent.DataMember)
                  )       
            ) ,
            IIF      
            (
                [Территории].[РФ].CurrentMember is [Территории].[РФ].CurrentMember.Parent.DataMember,
                [Территории].[РФ].CurrentMember is [Территории].[РФ].[Все территории].[Российская Федерация].[Южный федеральный округ].[Краснодарский край].DATAMEMBER,
                true      
            )      
        ) -     
        {
            [Территории].[РФ].[Все территории].[Российская Федерация].[Южный федеральный округ].[Краснодарский край]   
        }'             
    set [Территории ФО] 
    as 'Filter      
        (
            Generate       
            (
                Descendants            
                (
                    [Территории].[РФ].[<%fullRegionName%>],
                    [Территории].[РФ].[Субъект РФ],
                    SELF            
                ),
                {
                    [Территории].[РФ].CurrentMember,
                    [Территории].[РФ].CurrentMember.DataMember        
                }  + Filter  
                  (
                      Descendants 
                      (
                          [Территории].[РФ].CurrentMember,
                          [Территории].[РФ].[МР ГО],
                          SELF 
                      ),
                      not ([Территории].[РФ].CurrentMember is [Территории].[РФ].CurrentMember.Parent.DataMember)
                  )       
            ) ,
            IIF      
            (
                [Территории].[РФ].CurrentMember is [Территории].[РФ].CurrentMember.Parent.DataMember,
                [Территории].[РФ].CurrentMember is [Территории].[РФ].[Все территории].[Российская Федерация].[Южный федеральный округ].[Краснодарский край].DATAMEMBER,
                true      
            )      
        ) -     
        {
            [Территории].[РФ].[Все территории].[Российская Федерация].[Южный федеральный округ].[Краснодарский край]   
        }' 
SET [NonFilterRowSet]                  
    AS ' 
        {
            {
                [Территории].[РФ].[Все территории].[Российская Федерация]
            }*
            {
                [Организации].[Предприятия торговли].[Среднее по РФ] 
            }  
        }+{
            {
                [Территории].[РФ].[<%fullRegionName%>]
            }*
            Filter
            (
            {
                [Организации].[Предприятия торговли].[Среднее по ФО]
            }, "<%fullRegionName%>" <> "Российская Федерация"
            )
        }+
        {
            [Территории ФО]  
            *                  
            {
                {
                    [Организации].[Предприятия торговли].[Все организации]   
                } + [Организации]     
            }   
        } '    
    member [Период].[День].[Наименование] 
    as 'IIF 
        (
            [Организации].[Предприятия торговли].CurrentMember is [Организации].[Предприятия торговли].[Все организации],
            [Территории].[РФ].CurrentMember.Name,
            [Организации].[Предприятия торговли].CurrentMember.Name 
        )'  
    member [Measures].[Не считаем ранг] 
    as ' 
        (
            [Организации].[Предприятия торговли].CurrentMember is [Организации].[Предприятия торговли].[Все организации] 
        ) or 
        (
            [Организации].[Предприятия торговли].CurrentMember is [Организации].[Предприятия торговли].[Среднее по РФ] 
        ) or 
        (
            [Организации].[Предприятия торговли].CurrentMember is [Организации].[Предприятия торговли].[Среднее по ФО] 
        )' 
    member [Период].[День].[Уровень] 
    as 'IIF 
        (
            [Measures].[Не считаем ранг],
            0,
            1 
        )'  
    member [Период].[День].[Отчетная дата не областей] 
    as 'IIF 
        (
            [Период].[День].[Уровень]=0,
            null,
            [Период].[День].[Отчетная дата] 
        )' 
    member [Период].[День].[Макс Ранг] 
    as 'IIF 
        (
            [Measures].[Не считаем ранг] ,
            null,
            max 
            (
                Filter
                (
                    [NonFilterRowSet],
                    [Период].[День].[Отчетная дата не областей] <> 0
                ),
                [Период].[День].[Отчетная дата не областей] 
            ) 
        )' 
    member [Период].[День].[Мин Ранг] 
    as 'IIF 
        (
            [Measures].[Не считаем ранг] ,
            null,
            min 
            (
                Filter
                (
                    [NonFilterRowSet],
                    [Период].[День].[Отчетная дата не областей] <> 0
                ),
                [Период].[День].[Отчетная дата не областей] 
            ) 
        )  ' 
    member [Период].[День].[Абсл откл не областей] 
    as 'IIF 
        (
            [Период].[День].[Уровень]=0,
            null,
            [Период].[День].[абсолютное откл] 
        )' 
    member [Период].[День].[Мин Ранг откл] 
    as 'IIF 
        (
            [Measures].[Не считаем ранг] ,
            null,
            min 
            (
                Filter
                (
                    [NonFilterRowSet],
                    [Период].[День].[Абсл откл не областей] <> 0
                ),
                [Период].[День].[Абсл откл не областей] 
            ) 
        )    ' 
    member [Период].[День].[Макс Ранг откл] 
    as 'IIF 
        (
            [Measures].[Не считаем ранг] ,
            null,
            max 
            (
                Filter
                (
                    [NonFilterRowSet],
                    [Период].[День].[Абсл откл не областей] <> 0
                ),
                [Период].[День].[Абсл откл не областей] 
            ) 
        )    ' 
    member [Организации].[Предприятия торговли].[Среднее по РФ] 
    as 'AVG ( [Территории] 
        * [Организации] )' 
    member [Организации].[Предприятия торговли].[Среднее по ФО] 
    as 'AVG 
        (
            [Территории ФО] 
            * [Организации] 
        )'  
    member [Период].[День].[Предел] 
    as ' 
        (
            [Measures].[Значение],
            [Организации].[Предприятия торговли].DefaultMember,
            [Период].[День].DefaultMember,
            [Организации].[Тип цены].DefaultMember,
            [Организации].[Реестр продукции сопоставимый].[Вся продукуция].[Дизельное топливо]
        )'  
    member [Measures].[Цена ] 
    as 'IIF
        (
            [Организации].[Предприятия торговли].CurrentMember is [Организации].[Предприятия торговли].[Все организации] and
            ([Период].[День].CurrentMember is [Период].[День].[Отчетная дата]),
            ([Период].[День].[Предел], [Measures].[Значение]),
            [Measures].[Цена]
        )' 
select
    {
        [Период].[День].[Наименование],
        [Период].[День].[Отчетная дата],
        [Период].[День].[30 декабря прошлого года],
        [Период].[День].[абсолютное откл] ,
        [Период].[День].[темп прироста] ,
        [Период].[День].[Уровень],
        [Период].[День].[Макс Ранг]    ,
        [Период].[День].[Мин Ранг] ,
        [Период].[День].[Мин Ранг откл] ,
        [Период].[День].[Макс Ранг откл],
        [Период].[День].[Предел] 
    } on columns,
    {
        Filter 
        (
            [NonFilterRowSet],
            not isEmpty 
            (
                [Период].[День].[Отчетная дата] 
            ) 
        ) 
    } on rows 
from [ОРГАНИЗАЦИИ_Цены и тарифы] 
where 
    (
        [Организации].[Реестр продукции сопоставимый].[Вся продукуция].[Дизельное топливо]
    )     
     ]]>
  </query>


</root>