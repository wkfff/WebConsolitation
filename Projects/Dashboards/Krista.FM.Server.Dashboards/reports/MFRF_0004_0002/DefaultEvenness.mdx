<?xml version="1.0" encoding="Windows-1251"?>
<root>

  <query id="MFRF_0004_0002_date">
    <![CDATA[
-- MFRF_0004_0002_date
-- <#МФ РФ_Расходы ФБ]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                [Период].[Период].Members,
                not IsEmpty([Measures].[Факт за период]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца" and
                [Период].[Период].CurrentMember.Name <> "Заключительные обороты"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
  from [МФ РФ_Расходы ФБ] 
  ]]>
  </query>

  <query id="MFRF_0004_0002_grid_yearValuation">
    <![CDATA[
-- MFRF_0004_0003_grid_yearValuation
-- <#МФ РФ_Расходы ФБ]#>
WITH    
    member [Measures].[Код]    
    as '[МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Properties("Код")'    
    member [Measures].[Кассовое исполнение квартал 1]    
    as '    
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 1].[Квартал 1]    
        )'    
    member [Measures].[Кассовое исполнение квартал 2]    
    as '    
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 1].[Квартал 2]    
        )'    
    member [Measures].[Кассовое исполнение квартал 3]    
    as '    
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 2].[Квартал 3]    
        )'    
    member [Measures].[Кассовое исполнение квартал 4]    
    as '    
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 2].[Квартал 4]    
        )'    
    member [Measures].[Среднее кассовое исполнение]    
    as 'IIF    
        (
            IsEmpty   
            (
                [Measures].[Кассовое исполнение квартал 4]   
            ) or [Measures].[Кассовое исполнение квартал 4] <= 0,
            null,
            (
                [Measures].[Кассовое исполнение квартал 1] + [Measures].[Кассовое исполнение квартал 2] + [Measures].[Кассовое исполнение квартал 3]    
            ) / 3 
        )'    
    member [Measures].[Равномерность расходов]    
    as 'IIF    
        (
            IsEmpty 
            (
                [Measures].[Кассовое исполнение квартал 4] 
            ) or 
            (
                [Measures].[Кассовое исполнение квартал 4] <= 0
            ) or IsEmpty    
            (
                [Measures].[Среднее кассовое исполнение]    
            ) or 
            (
                [Measures].[Среднее кассовое исполнение] = 0
            ),
            null,
            (
                [Measures].[Кассовое исполнение квартал 4] - [Measures].[Среднее кассовое исполнение]    
            ) / [Measures].[Среднее кассовое исполнение]    
        ) '    
    member [Measures].[Оценка равномерности расходов (Приказ 123н)]
    as 'IIF    
        (
            IsEmpty
            (
                [Measures].[Кассовое исполнение квартал 4]
            ) or [Measures].[Кассовое исполнение квартал 4] <= 0,
            "Не оценено",
            IIF    
            (
                IsEmpty([Measures].[Равномерность расходов]) or [Measures].[Равномерность расходов] > 1,
                "Не соответствует",
                IIF
                (
                    [Measures].[Равномерность расходов] < 0.2,
                    "Соответствует",
                    "В разрешенном интервале"
                )
            )    
        ) '    
    member [Measures].[Оценка равномерности расходов (Приказ 34н)]
    as 'IIF    
        (
            IsEmpty
            (
                [Measures].[Кассовое исполнение квартал 4]
            ) or [Measures].[Кассовое исполнение квартал 4] <= 0,
            "Не оценено",
            IIF
            (
                IsEmpty([Measures].[Равномерность расходов]) or [Measures].[Равномерность расходов] > 1,
                "Не соответствует",
                IIF
                (
                    [Measures].[Равномерность расходов] < 0.5,
                    "Соответствует",
                    "В разрешенном интервале"
                )
            )
        ) '    
    set [Список ГРБС]    
    as ' [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].Children -    
        {
            [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].[Несопоставленные данные]    
        } '    
SELECT
    {
        [Measures].[Код],
        [Measures].[Кассовое исполнение квартал 1],
        [Measures].[Кассовое исполнение квартал 2],
        [Measures].[Кассовое исполнение квартал 3],
        [Measures].[Кассовое исполнение квартал 4],
        [Measures].[Среднее кассовое исполнение],
        [Measures].[Равномерность расходов],
        [Measures].[Оценка равномерности расходов (Приказ 123н)],
        [Measures].[Оценка равномерности расходов (Приказ 34н)]
    } on columns,
    { [Список ГРБС] } on rows    
FROM  [МФ РФ_Расходы ФБ]    
WHERE ( [МФ РФ].[КОСГУ].[Все] )    
  ]]>
  </query>

  <query id="MFRF_0004_0002_grid_quarterValuation">
    <![CDATA[
-- MFRF_0004_0003_grid_quarterValuation  
-- <#МФ РФ_Расходы ФБ]#>
WITH
    member [Measures].[Код]
    as '[МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Properties("Код")'
    member [Measures].[Равномерность расходов]
    as 'IIF
        (
            IsEmpty    ( [Measures].[План] ) or [Measures].[План] = 0,
            null,
            [Measures].[Факт за период] / [Measures].[План]
        ) '
    member [Measures].[Оценка равномерности расходов (Приказ 34н)]
    as 'IIF
        (
            [Measures].[Равномерность расходов] < 0.889,
            "В разрешенном интервале",
            IIF
            (
               [Measures].[Равномерность расходов] > 1.111,
               "В разрешенном интервале",
               "Соответствует"
            )
        ) '
    set [Список ГРБС]
    as 'Filter
        (
            [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].Children -
            {
                [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].[Несопоставленные данные]
            },
            [Measures].[План] <> 0 and [Measures].[Факт] <> 0
        )'
SELECT
    {
        [Measures].[Код],
        [Measures].[План],
        [Measures].[Факт за период],
        [Measures].[Равномерность расходов],
        [Measures].[Оценка равномерности расходов (Приказ 34н)]
    } on columns,
    { [Список ГРБС] } on rows
FROM  [МФ РФ_Расходы ФБ]      
WHERE 
    (
        [МФ РФ].[КОСГУ].[Все],
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>]
    )   
  ]]>
  </query>

  <query id="MFRF_0004_0002_details_yearValuation">
    <![CDATA[
-- MFRF_0004_0002_details_yearValuation
-- <#МФ РФ_Расходы ФБ]#>
WITH
    member [Measures].[Кассовое исполнение квартал 1]
    as '
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 1].[Квартал 1]
        )'
    member [Measures].[Кассовое исполнение квартал 2]
    as '
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 1].[Квартал 2]
        )'
    member [Measures].[Кассовое исполнение квартал 3]
    as '
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 2].[Квартал 3]
        )'
    member [Measures].[Кассовое исполнение квартал 4]
    as '
        (
            [Measures].[Факт за период],
            [Период].[Период].[Данные всех периодов].[<%period_year%>].[Полугодие 2].[Квартал 4]
        )'
    member [Measures].[Среднее кассовое исполнение]    
    as 'IIF    
        (
            IsEmpty   
            (
                [Measures].[Кассовое исполнение квартал 4]   
            ) or [Measures].[Кассовое исполнение квартал 4] <= 0,
            null,
            (
                [Measures].[Кассовое исполнение квартал 1] + [Measures].[Кассовое исполнение квартал 2] + [Measures].[Кассовое исполнение квартал 3]    
            ) / 3 
        )'    
    member [Measures].[Равномерность расходов]    
    as 'IIF    
        (
            IsEmpty 
            (
                [Measures].[Кассовое исполнение квартал 4] 
            ) or 
            (
                [Measures].[Кассовое исполнение квартал 4] <= 0
            ) or IsEmpty    
            (
                [Measures].[Среднее кассовое исполнение]    
            ) or 
            (
                [Measures].[Среднее кассовое исполнение] = 0
            ),
            null,
            (
                [Measures].[Кассовое исполнение квартал 4] - [Measures].[Среднее кассовое исполнение]    
            ) / [Measures].[Среднее кассовое исполнение]    
        ) '
    member [Measures].[Количество нарушителей согласно Приказу 123н]
    as 'Count
        (
            Filter
            (
                [Список ГРБС],
                not
                (
                    IsEmpty 
                    (
                        [Measures].[Кассовое исполнение квартал 4] 
                    ) or [Measures].[Кассовое исполнение квартал 4] <= 0
                ) and (
                         [Measures].[Равномерность расходов] > 1
                      ) or (IsEmpty([Measures].[Равномерность расходов]))
            )
        )'

    member [Measures].[Количество нарушителей согласно Приказу 34н]
    as 'Count
        (
            Filter
            (
                [Список ГРБС],
                not
                (
                    IsEmpty 
                    (
                        [Measures].[Кассовое исполнение квартал 4] 
                    ) or [Measures].[Кассовое исполнение квартал 4] <= 0
                ) and (
                         [Measures].[Равномерность расходов] > 1
                      ) or (IsEmpty([Measures].[Равномерность расходов]))
            )
        )'
    member [Measures].[Количество оцененных]
    as 'Count
        (
            [Список ГРБС]
        )'        
    member [Measures].[Средняя равномерность расходов]
    as 'AVG
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
   member [Measures].[Минимальная равномерность расходов]
    as 'MIN
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
    member [Measures].[ГРБС с минимальной равномерностью расходов]
    as 'Generate
        (
            HEAD
            (
                Order
                (
                    [Список ГРБС],
                    [Measures].[Равномерность расходов],
                    BASC
                ),
                1
            ),
            [МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Name,
            " "
        )'
   member [Measures].[Максимальная равномерность расходов]
    as 'MAX
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
    member [Measures].[ГРБС с максимальной равномерностью расходов]
    as 'Generate
        (
            TAIL
            (
                Order
                (
                    [Список ГРБС],
                    [Measures].[Равномерность расходов],
                    BASC
                ),
                1
            ),
            [МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Name,
            " "
        )'
    set [Список ГРБС]   
    as 'Filter( [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].Children -   
        {
            [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].[Несопоставленные данные]   
        },
        not(            IsEmpty
            (
                [Measures].[Кассовое исполнение квартал 4]
            ) or [Measures].[Кассовое исполнение квартал 4] <= 0)
        ) ' 
SELECT
    {
        [Measures].[Количество нарушителей согласно Приказу 34н],
        [Measures].[Средняя равномерность расходов],
        [Measures].[Минимальная равномерность расходов],
        [Measures].[ГРБС с минимальной равномерностью расходов],
        [Measures].[Максимальная равномерность расходов],
        [Measures].[ГРБС с максимальной равномерностью расходов],
        [Measures].[Количество оцененных],
        [Measures].[Количество нарушителей согласно Приказу 123н]
    } on columns
FROM  [МФ РФ_Расходы ФБ]
WHERE ( [МФ РФ].[КОСГУ].[Все] )
  ]]>
  </query>

  <query id="MFRF_0004_0002_details_quarterValuation">
    <![CDATA[
-- MFRF_0004_0002_details_quarterValuation
-- <#МФ РФ_Расходы ФБ]#>
WITH
    member [Measures].[Равномерность расходов]
    as 'IIF
        (
            IsEmpty    ( [Measures].[План] ) or [Measures].[План] = 0,
            null,
            [Measures].[Факт за период] / [Measures].[План]
        ) '
    member [Measures].[Количество ненарушителей согласно Приказу 34н]
    as 'Count
        (
            Filter
            (
                [Список ГРБС],
                ([Measures].[Равномерность расходов]) >= 0.889 and ([Measures].[Равномерность расходов] <= 1.111)
            )
        )'

    member [Measures].[Средняя равномерность расходов]
    as 'AVG
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
   member [Measures].[Минимальная равномерность расходов]
    as 'MIN
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
    member [Measures].[ГРБС с минимальной равномерностью расходов]
    as 'Generate
        (
            HEAD
            (
                Order
                (
                    [Список ГРБС],
                    [Measures].[Равномерность расходов],
                    BASC
                ),
                1
            ),
            [МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Name,
            " "
        )'
   member [Measures].[Максимальная равномерность расходов]
    as 'MAX
        (
            [Список ГРБС],
            [Measures].[Равномерность расходов]
        )'
    member [Measures].[ГРБС с максимальной равномерностью расходов]
    as 'Generate
        (
            TAIL
            (
                Order
                (
                    [Список ГРБС],
                    [Measures].[Равномерность расходов],
                    BASC
                ),
                1
            ),
            [МФ РФ].[ГРБС ФБ Сопоставимый].CurrentMember.Name,
            " "
        )'

    set [Список ГРБС]
    as '
            [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].Children -
            {
                [МФ РФ].[ГРБС ФБ Сопоставимый].[Все].[Несопоставленные данные]
            }
        '
    member [Measures].[Количество оцененных]
    as 'Count
        (
            [Список ГРБС]
        )'          
SELECT
    {
        [Measures].[Количество ненарушителей согласно Приказу 34н],
        [Measures].[Средняя равномерность расходов],
        [Measures].[Минимальная равномерность расходов],
        [Measures].[ГРБС с минимальной равномерностью расходов],
        [Measures].[Максимальная равномерность расходов],
        [Measures].[ГРБС с максимальной равномерностью расходов],
        [Measures].[Количество оцененных]
    } on columns
FROM  [МФ РФ_Расходы ФБ]
WHERE
    (
        [МФ РФ].[КОСГУ].[Все],
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>]
    )
  ]]>
  </query>

</root>