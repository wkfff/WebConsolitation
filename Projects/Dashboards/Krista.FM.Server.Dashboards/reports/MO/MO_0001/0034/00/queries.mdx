<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="last_date">
    <![CDATA[ -- name: last_date   
      select
          { 
    filter( except
    (
    {[Паспорт МО].[Показатели].[Все показатели].[Торговля и общественное питание].children}
    ,{<%marks%>}
    ),not isempty([Measures].[Значение]))
          }  on rows,
          non empty{[Период].[Год Квартал Месяц].[Год].Members
               
          }   on columns
      from  [МО_Паспорт МО] 
      where  
          (   [Measures].[Значение],
              <%CurrentRegion%>
           )           
	  ]]>
  </query>
  
  <query id ="G">
    <![CDATA[WITH
    MEMBER [Measures].[Единица измерения]
    AS  '[Паспорт МО].[Показатели].CurrentMember.Properties("Единица измерения")'
    select
    { [Measures].[Значение],
    [Measures].[Единица измерения]} on columns,
    { 
  filter(  except
    (
    {[Паспорт МО].[Показатели].[Все показатели].[Торговля и общественное питание].children}
    ,{<%marks%>}
    ),not isempty([Measures].[Значение]))
     
    } on rows
from [МО_Паспорт МО] 
where (<%CurrentPeriod%>,<%CurrentRegion%>) ]]>
  </query>
  
  <query id="G2">
    <![CDATA[ WITH
    MEMBER [Measures].[Единица измерения]
    AS  '[Паспорт МО].[Показатели].CurrentMember.Properties("Единица измерения")'
    select
    { [Measures].[Значение],
    [Measures].[Единица измерения]} on columns,
    { filter
        (
            {
                <%marks%>
            },
             Right
            (
                [Паспорт МО].[Показатели].Currentmember.UniqueName,
                10
            ) <> "DATAMEMBER"
        )
    } on rows
from [МО_Паспорт МО]
where (<%CurrentPeriod%>
,<%CurrentRegion%>
)
    ]]>    
  </query>
  
  <query id="chart_dinamic">
    <![CDATA[ -- name: chart_avg_count
select
    {<%marks%>  } on rows,
    non empty 
    {
        <%LastPeriod%>: <%LastPeriod%>.Lag(9)
    } on columns
from  [МО_Паспорт МО] 
where 
    (           
        <%CurrentRegion%>,
        [Measures].[Значение]
        ,
        [Источники данных].[Все источники данных].[МО Паспорт МО] 
    )       
    ]]>
  </query>
  
  <query id="chart_pie">
    <![CDATA[ -- name: chart_pie
select
    { Filter 
    (
        <%marks%>.children,
        [Measures].[Значение] > 0 and not 
        (
            [Паспорт МО].[Показатели].CurrentMember is [Паспорт МО].[Показатели].CurrentMember.Parent.DataMember 
        ) 
    )} on rows,
    { [Measures].[Значение] } on columns  
from [МО_Паспорт МО] 
where 
    (
        [Источники данных].[Все источники данных].[МО Паспорт МО],
        <%CurrentPeriod%>,
        <%CurrentRegion%>
    )
  ]]>
</query>
    
</root>
