<?xml version="1.0" encoding="windows-1251"?>
<root>
  <query id="FK_0001_0002_date">
    <![CDATA[
-- FK_0001_0002_allocation_date
-- <#[ФК_МесОтч_Доходы]#>
with
    member [Measures].[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
    set [NonEmptySet]
    as 'Tail
        (
            Filter
            (
                OpeningPeriod 
                (
                    [Период].[Период].[Месяц],
                    [Период].[Период].[Данные всех периодов].[2010]
                ) : ClosingPeriod 
                (
                    [Период].[Период].[Месяц],
                    [Период].[Период].[Данные всех периодов].[2020]
                ),
                not IsEmpty([Measures].[Исполнено]) and
                [Период].[Период].CurrentMember.Name <> "Остатки на начало года" and
                [Период].[Период].CurrentMember.Name <> "Данные квартала" and
                [Период].[Период].CurrentMember.Name <> "Данные полугодия" and
                [Период].[Период].CurrentMember.Name <> "Данные года" and
                [Период].[Период].CurrentMember.Name <> "Данные месяца"
            ),
            1
        )'
select
    { [Measures].[ДанныеНа] } on columns,
    { [NonEmptySet] } on rows
from [ФК_МесОтч_Доходы]
  ]]>
  </query>

  <query id="FK_0001_0002_chart">
    <![CDATA[
-- FK_0001_0002_allocation_chart
-- <#[ФК_МесОтч_Доходы]#>
with 
   member Measures.[Численность постоянного населения_Prev]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения_This]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения_This]
            ) or Measures.[Численность постоянного населения_This] = 0,
            Measures.[Численность постоянного населения_Prev],
            Measures.[Численность постоянного населения_This]
        ) '
    member Measures.[Исполнено_]
    as 'IIF 
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
            Measures.[Исполнено],
            Sum 
            (
                Filter 
                (
                    [Территории].[Сопоставимый].Children,
                    (
                        Measures.[Численность постоянного населения] <> 0 
                    ) 
                ),
                Measures.[Исполнено_] 
            ) 
        ) ' 
    member Measures.[Доходы]
    as '
        (
            [Measures].[Исполнено_],
            [КД].[Сопоставимый].[Все коды доходов].[Доходы - всего в том числе:]
        )'
    member Measures.[Другие субъекты РФ] 
    as 'IIF 
        (
            IsEmpty 
            (
                Measures.[Численность постоянного населения] 
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            Measures.[Доходы]/
            (
                Measures.[Численность постоянного населения] 
                *1000 
            ) 
        )' 
    member Measures.[Дотации] 
    as ' 
        (
            [Measures].[Исполнено_],
            [КД].[Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований].[Дотации на выравнивание бюджетной обеспеченности] 
        )' 
    member Measures.[Другие субъекты РФ ] 
    as 'IIF 
        (
            IsEmpty 
            (
                Measures.[Численность постоянного населения] 
            ) or Measures.[Численность постоянного населения] = 0,
            null,
            (
                Measures.[Доходы]-Measures.[Дотации]
            )/ 
            (
                Measures.[Численность постоянного населения] 
                *1000 
            ) 
        )' 
    set [Список субъектов] 
    as 'Filter
        (
            [Территории].[Сопоставимый].[Субъект РФ].AllMembers,
            (
                not 
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember 
                ) and
                (
                    Measures.[Исполнено]
                ) <> 0
                and
                (
                    Measures.[Численность постоянного населения]
                ) <> 0                
            ) <%filter%>
        )'        
   member Measures.[Пустая серия]
   as '(
            null
       )'
	
select
    {
	    Measures.[Численность постоянного населения],
        Measures.[Другие субъекты РФ],
        Measures.[Другие субъекты РФ ]
    } on columns,
    [Список субъектов] on rows 
from [ФК_МесОтч_Доходы] 
where 
    (
        [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
        [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта]
    )
  ]]>
  </query>

  <query id="FK_0001_0002_avg">
    <![CDATA[
-- FK_0001_0002_allocation_avg
-- <#[ФК_МесОтч_Доходы]#>
with    
   member Measures.[Численность постоянного населения_Prev]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_last_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения_This]
    as 'LookupCube
            (
                "[ФСГС_Численность населения]",
                "
                (
                    [Measures].[Факт],
                    [Период].[Период].[Данные всех периодов].[<%period_year%>],
                    [ФСГС].[Численность населения].[Все].[Все население],
                    [Вариант].[ФСГС Население].[Все].[Численность населения на 1 января],
                    " + MemberToStr
                    (
                        [Территории].[Сопоставимый].CurrentMember
                    ) + "
                )"
            ) / 1000'
    member Measures.[Численность постоянного населения]
    as 'IIF
        (
            IsEmpty
            (
                Measures.[Численность постоянного населения_This]
            ) or Measures.[Численность постоянного населения_This] = 0,
            Measures.[Численность постоянного населения_Prev],
            Measures.[Численность постоянного населения_This]
        ) '
    member Measures.[Доходы]    
    as '    
        (
            [Measures].[Исполнено],
            [КД].[Сопоставимый].[Все коды доходов].[Доходы - всего в том числе:]    
        )'    
    member Measures.[Дотации]    
    as '    
        (
            [Measures].[Исполнено],
            [КД].[Сопоставимый].[Все коды доходов].[БЕЗВОЗМЕЗДНЫЕ ПОСТУПЛЕНИЯ].[Безвозмездные поступления от других бюджетов бюджетной системы Российской Федерации].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований].[Дотации на выравнивание бюджетной обеспеченности]    
        )'    
    member Measures.[Доходы всего]    
    as 'Sum    
        (
            [Список субъектов],
            Measures.[Доходы]    
        )'    
    member Measures.[Доходы без дотаций всего]    
    as 'Sum    
        (
            [Список субъектов],
            Measures.[Доходы] - Measures.[Дотации]  
        )'    
    member Measures.[Численность постоянного населения всего]    
    as 'IIF  
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "РФ",
            1000
            *Measures.[Численность постоянного населения],
            Sum 
            (
                [Список субъектов],
                1000   
                *Measures.[Численность постоянного населения]   
            ) 
        )'  
    member Measures.[Доходы среднее]    
    as '  
        (
            Measures.[Доходы всего] / Measures.[Численность постоянного населения всего]    
        )'    
    member Measures.[Доходы без дотаций среднее]    
    as '    
        (
            Measures.[Доходы без дотаций всего] / Measures.[Численность постоянного населения всего]    
        )'    
    set [Список субъектов]    
    as 'Filter   
        (
            {<%selectedItem%>},
            (
                not   
                (
                    [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember   
                ) and   
                (
                    Measures.[Исполнено] <> 0  
                ) and   
                (
                    Measures.[Численность постоянного населения] <> 0  
                )   
            ) 
        )'   
select
    {
        Measures.[Доходы среднее],
        Measures.[Доходы без дотаций среднее]    
    } on columns
from [ФК_МесОтч_Доходы]    
where        
    (
       [Период].[Период].[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>],
       [Уровни бюджета].[СКИФ].[Все].[Конс.бюджет субъекта]
    )     
  ]]>
  </query>
</root>