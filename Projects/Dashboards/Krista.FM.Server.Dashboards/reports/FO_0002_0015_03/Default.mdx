<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FO_0002_0015_03_date">
    <![CDATA[
-- FO_0002_0015_03_date
-- <#[ФО_АС Бюджет_КазнИсп_Факт расхода]#>
with
    member Measures.[ДанныеНа]
    as '<%period_dimension%>.CurrentMember.UniqueName'
select
    {Measures.[ДанныеНа]} on columns,
    Tail
    (
        NonEmptyCrossjoin
        (
            OpeningPeriod
            (
                <%period_dimension%>.[Месяц],
                <%period_dimension%>.[Данные всех периодов].[2008]
            ) : ClosingPeriod
            (
                <%period_dimension%>.[Месяц],
                <%period_dimension%>.[Данные всех периодов].[2012]
            )
        )
    ) on rows
from [ФО_АС Бюджет_КазнИсп_Факт расхода]
  ]]>
  </query>

  <query id="FO_0002_0015_03_grid_fact">
    <![CDATA[
-- FO_0002_0015_03_grid_fact
-- <#[ФО_АС Бюджет_КазнИсп_Факт расхода]#>
with         
    Member [Расходы].[Базовый].[Итого]         
    as 'Aggregate         
        (
            {
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Иные межбюджетные трансферты]         
            }         
        )'         
    set [Расходы]         
    as '         
        {
            [Расходы].[Базовый].[Итого]         
        }+ Generate         
        (
            {
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Иные межбюджетные трансферты]         
            },
            {
                {
                    [Расходы].[Базовый].CurrentMember         
                } + Generate         
                (
                    Descendants         
                    (
                        [Расходы].[Базовый].CurrentMember,
                        [Расходы].[Базовый].[Расходы уровень 3],
                        SELF         
                    ),
                    {
                        Generate     
                        (
                            Descendants     
                            (
                                [Расходы].[Базовый].CurrentMember,
                                [Расходы].[Базовый].[Расходы уровень 4],
                                SELF     
                            ),
                            {
                                [Расходы].[Базовый].CurrentMember     
                            } + Descendants     
                            (
                                [Расходы].[Базовый].CurrentMember,
                                [Расходы].[Базовый].[Расходы уровень 5],
                                SELF     
                            )     
                        )    
                    }     
                )         
            }         
        )'         
    Member <%fkr_dimension%>.[Фильтр по ФКР]         
    as 'Aggregate         
        (
            {
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Иные межбюджетные трансферты]         
            }         
        )'         
    Member <%ekr_dimension%>.[Фильтр по ЭКР]         
    as 'Aggregate         
        (
            {
                <%ekr_dimension%>.[Все коды ЭКР].[Расходы].[Безвозмездные перечисления бюджетам].[Перечисления другим бюджетам бюджетной системы Российской Федерации]         
            }         
        )'         
    Member [Measures].[Факт]    
    as 'IIF   
        (
            [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].[Итого],
            Sum  
            (
                [Мероприятия],
                [Measures].[Факт] 
            ),
            [Measures].[Расход с возвратом нараст итог] 
        )'       
    Member [Measures].[План]         
    as 'IIF 
         (
           [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].[Код],
           IIF 
           (
             [Расходы].[Базовый].CurrentMember is [Расходы].[Базовый].[Итого],
             0,
             [Расходы].[Базовый].CurrentMember.Properties("Код")
            ),  
            0
         )'         
    Member [Measures].[Уровень]         
    as '[Расходы].[Базовый].CurrentMember.Level.Name' 
    set [Мероприятия] 
    as 'Filter 
        (
            Descendants 
            (
                [Мероприятия].[Сопоставимый].[Все мероприятия],
                [Мероприятия].[Сопоставимый].[Мероприятия уровень 3],
                SELF 
            ),
            not 
            (
               [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and [Мероприятия].[Сопоставимый].CurrentMember.Properties("Мероприятия__Сопоставимый") = "Бюджеты муниципальных образований Оренбургской области"
        )' 
    Member [Мероприятия].[Сопоставимый].[Итого]   
    as '[Мероприятия].[Сопоставимый].[Все мероприятия]' 
    Member [Мероприятия].[Сопоставимый].[Код]         
    as 'IIF ( [Расходы].[Базовый].CurrentMember is [Расходы].[Базовый].[Итого], 0, [Расходы].[Базовый].CurrentMember.Properties("Код"))'        
SELECT
    {
        Filter   
        (
            [Расходы],
            not    
            (
                IsEmpty([Measures].[Факт]) 
            )   
        )  
        *  
        {
            [Measures].[План],
            [Measures].[Факт]
        }  
    } on columns,
   Filter( {{ [Мероприятия].[Сопоставимый].[Код] } + VisualTotals 
        (
            {[Мероприятия].[Сопоставимый].[Все мероприятия].[БЮДЖЕТ СУБЪЕКТА РФ].[Бюджеты муниципальных образований Оренбургской области]} + [Мероприятия],
            "
            * Итого" 
        )}, [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].[Код] or not IsEmpty([Measures].[Факт] )  ) on rows
FROM [ФО_АС Бюджет_КазнИсп_Факт расхода]         
WHERE         
    (
        <%fkr_dimension%>.[Фильтр по ФКР],
        <%ekr_dimension%>.[Фильтр по ЭКР],
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[<%period_half_year%>].[<%period_quater%>].[<%period_month%>]
    )          
  ]]>
  </query>

  <query id="FO_0002_0015_03_grid_plan">
    <![CDATA[
-- FO_0002_0015_03_grid_plan
-- <#[ФО_АС Бюджет_План расходов]#>
with         
    Member [Расходы].[Базовый].[Итого]         
    as 'Sum     
        (
            {
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Иные межбюджетные трансферты]         
            },
            [Measures].[План]
        )'         
    set [Расходы]         
    as '         
        {
            [Расходы].[Базовый].[Итого]         
        }+ Generate         
        (
            {
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                [Расходы].[Базовый].[Все].[Межбюджетные трансферты].[Иные межбюджетные трансферты]         
            },
            {
                {
                    [Расходы].[Базовый].CurrentMember         
                } + Generate         
                (
                    Descendants         
                    (
                        [Расходы].[Базовый].CurrentMember,
                        [Расходы].[Базовый].[Расходы уровень 3],
                        SELF         
                    ),
                    {
                        Generate     
                        (
                            Descendants     
                            (
                                [Расходы].[Базовый].CurrentMember,
                                [Расходы].[Базовый].[Расходы уровень 4],
                                SELF     
                            ),
                            {
                                [Расходы].[Базовый].CurrentMember     
                            } + Descendants     
                            (
                                [Расходы].[Базовый].CurrentMember,
                                [Расходы].[Базовый].[Расходы уровень 5],
                                SELF     
                            )     
                        )    
                    }     
                )         
            }         
        )'         
    Member <%fkr_dimension%>.[Фильтр по ФКР]         
    as 'Aggregate         
        (
            {
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Дотации бюджетам субъектов Российской Федерации и муниципальных образований],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Субсидии бюджетам субъектов Российской Федерации и муниципальных образований (межбюджетные субсидии)],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Субвенции бюджетам субъектов Российской Федерации и муниципальных образований],
                <%fkr_dimension%>.[Все коды ФКР].[МЕЖБЮДЖЕТНЫЕ ТРАНСФЕРТЫ].[Иные межбюджетные трансферты]         
            }         
        )'         
    Member <%ekr_dimension%>.[Фильтр по ЭКР]         
    as 'Aggregate         
        (
            {
                <%ekr_dimension%>.[Все коды ЭКР].[Расходы].[Безвозмездные перечисления бюджетам].[Перечисления другим бюджетам бюджетной системы Российской Федерации]         
            }         
        )'         
    Member [Measures].[План]    
    as 'IIF   
        (
            [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].[Итого],
            Sum  
            (
                [Мероприятия],
                [Measures].[План] 
            ),
            [Measures].[Ассигнования]
        )'       

    set [Мероприятия] 
    as 'Filter 
        (
            Descendants 
            (
                [Мероприятия].[Сопоставимый].[Все мероприятия],
                [Мероприятия].[Сопоставимый].[Мероприятия уровень 3],
                SELF 
            ),
            not 
            (
               [Мероприятия].[Сопоставимый].CurrentMember is [Мероприятия].[Сопоставимый].CurrentMember.Parent.DataMember
            ) and [Мероприятия].[Сопоставимый].CurrentMember.Properties("Мероприятия__Сопоставимый") = "Бюджеты муниципальных образований Оренбургской области"
        )' 
        
    Member [Мероприятия].[Сопоставимый].[Итого]   
    as '[Мероприятия].[Сопоставимый].[Все мероприятия]' 
   
SELECT
    {
        Filter   
        (
            [Расходы],
            not    
            (
                IsEmpty([Measures].[План])    
            )   
        )  
        *  
        {
            [Measures].[План]  
        }  
    } on columns,
    Filter( 
        VisualTotals 
        (
            {[Мероприятия].[Сопоставимый].[Все мероприятия].[БЮДЖЕТ СУБЪЕКТА РФ].[Бюджеты муниципальных образований Оренбургской области]} + [Мероприятия],
            "
            * Итого" 
        ),  not IsEmpty([Measures].[План] )  ) on rows
FROM [ФО_АС Бюджет_План расходов]
WHERE         
    (
        <%fkr_dimension%>.[Фильтр по ФКР],
        <%ekr_dimension%>.[Фильтр по ЭКР],
        <%period_dimension%>.[Данные всех периодов].[<%period_year%>].[Данные года],
        [Период].[Дата принятия].[Данные всех периодов].[<%period_year%>]
    )          
  ]]>
  </query>
</root>