<?xml version="1.0" encoding="Windows-1251"?>
<root>
  <query id="FK_0004_0008_lastDate">
    <![CDATA[
-- FK_0004_0008_lastDate
with
    member Measures.[ДанныеНа]
    as '[Период].[Период].CurrentMember.UniqueName'
select
    {Measures.[ДанныеНа]} on columns,
    Tail
    (
        Filter
        (
            [Период].[Период].[День].Members,
            not IsEmpty([Measures].[Кассовое исполнение])
        )
    ) on rows
from   [ФК_КПЭ]
where
    (
        [Уровни бюджета].[СКИФ].[Все].[Фед.бюджет]
    )
  ]]>
  </query>
  
  <query id="FK_0004_0008_grid">
    <![CDATA[
-- FK_0004_0008_grid
with  
    member [Показатели].[КПЭ].[Итого]  
    as 'aggregate ([Администраторы])'  
    set [Администраторы]  
    as '  
        {
            order  
            (
                filter  
                (
                    descendants  
                    (
                        [Показатели].[КПЭ].[Все показатели],
                        [Показатели].[КПЭ].[Показатель],
                        SELF  
                    ) ,
                    not  
                    (
                        isEmpty  
                        (
                            [Measures].[Уточненные годовые назначения]  
                        )  
                    ) and strToValue 
                    (
                        [Показатели].[КПЭ].CurrentMember.Properties("Уровень вложения показателя") 
                    ) > 0 and strToValue
                    (
                        [Показатели].[КПЭ].CurrentMember.Properties("Уровень вложения показателя")
                    ) < 4
                ) ,
                strToValue  
                (
                    [Показатели].[КПЭ].CurrentMember.Properties("Порядковый номер") 
                )  
            )  
        }'      
    Member [Measures].[Имя]       
    as '[Показатели].[КПЭ].CurrentMember.Properties("Краткое наименование")'           
    Member [Measures].[Кассовое исполнение ]    
    as '[Measures].[Кассовое исполнение] / <%rub_multiplier%>'   
    Member [Measures].[Прирост за месяц ]   
    as '[Measures].[Прирост за месяц] / <%rub_multiplier%>' 
    Member [Measures].[Уровень вложения]
    as '[Показатели].[КПЭ].CurrentMember.Properties("Уровень вложения показателя")' 
    member Measures.[Ранг процент]    
    as 'IIF    
        (
            IsEmpty    
            (
                [Measures].[Процент исполнения годовых назначений]   
            ),
            null,
            Rank    
            (
                [Показатели].[КПЭ].CurrentMember,
                Order    
                (
                    [Администраторы],
                    [Measures].[Процент исполнения годовых назначений],
                    BDESC    
                ),
                [Measures].[Процент исполнения годовых назначений]   
            )    
        )'    
    member Measures.[Худший ранг процент]    
    as 'max    
        (
            [Администраторы] ,
            Measures.[Ранг процент]    
        )'    
    member Measures.[Доля] 
    as 'IIF 
        (
            IsEmpty 
            (
                (
                    [Показатели].[КПЭ].[Итого],
                    [Measures].[Кассовое исполнение ]
                ) 
            ) or 
            (
                [Показатели].[КПЭ].[Итого],
                [Measures].[Кассовое исполнение ]
            ) = 0,
            null,
            (
                [Показатели].[КПЭ].CurrentMember,
                [Measures].[Кассовое исполнение ]
            ) / 
            (
                [Показатели].[КПЭ].[Итого],
                [Measures].[Кассовое исполнение ]
            ) 
        )' 
select
    {
        [Measures].[Имя],
        [Measures].[Первоначальный план],
        [Measures].[Уточненные годовые назначения],
        [Measures].[Кассовое исполнение ],
        [Measures].[Процент исполнения годовых назначений],
        Measures.[Ранг процент],
        [Measures].[Прирост за месяц ],
        Measures.[Доля],
        Measures.[Худший ранг процент],
        [Measures].[Уровень вложения]
    } on columns,
    {
        [Администраторы]
    } on rows  
from  [ФК_КПЭ]     
where               
    (
        <%selected_period%>,
        [Уровни бюджета].[СКИФ].[Все].[Фед.бюджет],
        [Территории].[КПЭ].[Все территории].[Не указано],
        [Администратор].[КПЭ].[Все администраторы].[Не определено]
    )
 
  ]]>
  </query>

    <query id="FK_0004_0008_chart">
        <![CDATA[
-- FK_0004_0008_grid
with   
    Member [Measures].[Имя]  
    as '[Показатели].[КПЭ].CurrentMember.Properties("Краткое наименование")'  
    Member [Measures].[Кассовое исполнение ]  
    as '[Measures].[Кассовое исполнение] / <%rub_multiplier%>'   
select
    {
        [Measures].[Имя],
        [Measures].[Кассовое исполнение ] 
    } on columns,
    {
        [Показатели].[КПЭ].[Все показатели].[нефтегазовые, всего],
        [Показатели].[КПЭ].[Все показатели].[ненефтегазовые, всего] 
    } on rows  
from  [ФК_КПЭ]  
where  
    (
        <%selected_period%>,
        [Уровни бюджета].[СКИФ].[Все].[Фед.бюджет],
        [Территории].[КПЭ].[Все территории].[Не указано],
        [Администратор].[КПЭ].[Все администраторы].[Не определено]  
    )  
  ]]>
    </query>

    <query id="Prog_0002_0001_top">
        <![CDATA[ 
   -- Prog_0002_0001_top
   with
     set [Администраторы]
    as '
        {
            filter  
                (
                    descendants  
                    (
                        [Показатели].[КПЭ].[Все показатели],
                        [Показатели].[КПЭ].[Показатель],
                        SELF  
                    ) ,
                    not  
                    (
                        isEmpty  
                        (
                            [Measures].[Уточненные годовые назначения]  
                        )  
                    ) and strToValue 
                    (
                        [Показатели].[КПЭ].CurrentMember.Properties("Уровень вложения показателя") 
                    ) > 0 and strToValue
                    (
                        [Показатели].[КПЭ].CurrentMember.Properties("Уровень вложения показателя")
                    ) < 4
                )
        }'
    Member [Measures].[Имя]
    as '[Показатели].[КПЭ].CurrentMember.Properties("Краткое наименование")'
    set [Исполнение топ ]
    as 'TopCount
        (
            [Администраторы],
            5,
            [Measures].[Процент исполнения годовых назначений]
        )'
    set [Исполнение боттом ]
    as 'BottomCount
        (
            [Администраторы],
            5,
            [Measures].[Процент исполнения годовых назначений]
        )'
select
    {
        [Measures].[Имя],
        [Measures].[Процент исполнения годовых назначений]
    } on columns,
    {
    [Исполнение боттом ],
        [Исполнение топ ]

    } on rows
from  [ФК_КПЭ]
where               
    (
        <%selected_period%>,
        [Уровни бюджета].[СКИФ].[Все].[Фед.бюджет],
        [Территории].[КПЭ].[Все территории].[Не указано],
        [Администратор].[КПЭ].[Все администраторы].[Не определено]
    )
    ]]>
    </query>

    <query id="FK_0004_0008_grid1">
        <![CDATA[
-- FK_0004_0008_grid1
with 
    member [Администратор].[КПЭ].[Итого] 
    as 'aggregate ([Администраторы])' 
    set [Администраторы] 
    as ' 
        {
            order 
            (
                filter 
                (
                    descendants 
                    (
                        [Администратор].[КПЭ].[Все администраторы],
                        [Администратор].[КПЭ].[Администратор],
                        SELF 
                    ) ,
                    not 
                    (
                        isEmpty 
                        (
                            [Measures].[Уточненные годовые назначения] 
                        ) 
                    ) 
                )   - 
                {
                    [Администратор].[КПЭ].[Все администраторы].[Не определено] 
                },
                strToValue ([Администратор].[КПЭ].CurrentMember.Properties("Порядковый номер"))
            ) 
        }' 
    Member [Measures].[Имя] 
    as '[Администратор].[КПЭ].CurrentMember.Properties("Краткое наименование")' 
    Member [Measures].[Код] 
    as '[Администратор].[КПЭ].CurrentMember.Properties("Код")' 
    Member [Measures].[Уровень вложения]
    as '[Администратор].[КПЭ].CurrentMember.Properties("Уровень вложения показателя")'   
    Member [Measures].[Кассовое исполнение ] 
    as '[Measures].[Кассовое исполнение] / <%rub_multiplier%>' 
    Member [Measures].[Прирост за месяц ]
    as '[Measures].[Прирост за месяц] / <%rub_multiplier%>'     
     Member [Measures].[Первоначальный план ] 
    as '
        (
            [Measures].[Первоначальный план],
            Tail 
            (
                Filter 
                (
                    [Период].[Период].[День].Members,
                    not IsEmpty
                    (
                        [Measures].[Первоначальный план]
                    ) and not ([Measures].[Первоначальный план] = 0)
                ) 
            ).Item(0)
        )/  <%rub_multiplier%>' 
    Member [Measures].[Уточненные годовые назначения ] 
    as '
        (
            [Measures].[Уточненные годовые назначения],
            Tail 
            (
                Filter 
                (
                    [Период].[Период].[День].Members,
                    not IsEmpty
                    (
                        [Measures].[Уточненные годовые назначения]
                    )  and not ([Measures].[Уточненные годовые назначения] = 0)
                ) 
            ).Item(0)
        ) /  <%rub_multiplier%>' 
    member Measures.[Ранг процент] 
    as 'IIF 
        (
            IsEmpty 
            (
                [Measures].[Процент исполнения годовых назначений] 
            ),
            null,
            Rank 
            (
                [Администратор].[КПЭ].CurrentMember,
                Order 
                (
                    [Администраторы],
                    [Measures].[Процент исполнения годовых назначений],
                    BDESC 
                ),
                [Measures].[Процент исполнения годовых назначений] 
            ) 
        )' 
    member Measures.[Худший ранг процент] 
    as 'max 
        (
            [Администраторы] ,
            Measures.[Ранг процент] 
        )' 
    member Measures.[Доля] 
    as 'IIF 
        (
            IsEmpty 
            (
                (
                    [Администратор].[КПЭ].[Итого],
                    [Measures].[Кассовое исполнение ] 
                ) 
            ) or 
            (
                [Администратор].[КПЭ].[Итого],
                [Measures].[Кассовое исполнение ] 
            ) = 0,
            null,
            (
                [Администратор].[КПЭ].CurrentMember,
                [Measures].[Кассовое исполнение ] 
            ) / 
            (
                [Администратор].[КПЭ].[Итого],
                [Measures].[Кассовое исполнение ] 
            ) 
        )' 
select
    {
        [Measures].[Код],
        [Measures].[Имя],
        [Measures].[Первоначальный план ],
        [Measures].[Уточненные годовые назначения ],
        [Measures].[Кассовое исполнение ],
        [Measures].[Процент исполнения годовых назначений],
        Measures.[Ранг процент],
        [Measures].[Прирост за месяц ],
        Measures.[Доля],
        Measures.[Худший ранг процент],
        [Measures].[Уровень вложения]
    } on columns,
    { [Администраторы] } on rows 
from  [ФК_КПЭ] 
where               
    (
        <%selected_period%>,
        [Уровни бюджета].[СКИФ].[Все].[Фед.бюджет],
        [Показатели].[КПЭ].[Все показатели].[доходы],
        [Территории].[КПЭ].[Все территории].[Не указано]      
    ) 
  ]]>
    </query>
</root>
