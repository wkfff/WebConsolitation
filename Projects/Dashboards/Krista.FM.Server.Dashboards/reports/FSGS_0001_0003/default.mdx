<?xml version="1.0" encoding="windows-1251"?>
<root>

  <query id="FSGS_0001_0003_list_of_dates">
    <![CDATA[ -- Query name: FSGS_0001_0003_list_of_dates
with
    member [Measures].[Год]
    as 'Ancestor([Период].[Период].CurrentMember, [Период].[Период].[Год]).Name'
    member [Measures].[Месяц]
    as 'Ancestor([Период].[Период].CurrentMember, [Период].[Период].[Месяц]).Name'
    member [Measures].[День]
    as 'Ancestor([Период].[Период].CurrentMember, [Период].[Период].[День]).Name'
    member [Measures].[MDX имя]
    as '[Период].[Период].CurrentMember.UniqueName'
select
    {[Measures].[Год], [Measures].[Месяц], [Measures].[День], [Measures].[MDX имя]} on columns,
    {
        filter
        (
            [Период].[Период].[День].Members,
             [Measures].[Цена] > 0 and [Период].[Период].currentmember.name <> "Данные месяца"
        )
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена]
    )
    ]]>
  </query>

  <query id ="FSGS_0001_0003_list_of_regions">
    <![CDATA[ -- Query name: FSGS_0001_0003_list_of_regions
with
    member [Measures].[MDX имя]
    as '[Территории].[Сопоставимый].CurrentMember.UniqueName'
    member [Measures].[Имя]
    as '[Территории].[Сопоставимый].CurrentMember.Name'
    member [Measures].[Уровень]
    as '[Территории].[Сопоставимый].CurrentMember.Level.Name'
select
    {
        [Measures].[Имя],
        [Measures].[MDX имя],
        [Measures].[Уровень]
    } on columns,
    {
        filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Федеральный округ],
                SELF_AND_BEFORE
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена] > 0 and not IsEmpty([Measures].[Цена])
        )
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена]
    )
    ]]>
  </query>

  <query id ="FSGS_0001_0003_list_of_food">
    <![CDATA[ -- Query name: FSGS_0001_0003_list_of_food
with
    member [pr]
    as '[Продукция__Сопоставимый].[Продукция__Сопоставимый].CurrentMember.Properties("Примечание")'
    member [Measures].[MDX имя]
    as '[Продукция].[Сопоставимый].CurrentMember.UniqueName'
    member [Measures].[Единица измерения]
    as '[Продукция].[Сопоставимый].CurrentMember.Properties("Единица измерения")'
    set [Продукты]
    as 'filter
        (
            except 
            (
                [Продукция].[Сопоставимый].[Все виды продукции].Children,
                {
                    {
                        [Продукция].[Сопоставимый].[Все виды продукции].[Несопоставленные данные],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Дизельное топливо],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки А-76 (АИ-80)],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки АИ-92 (АИ-93 и т.п.)],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Бензин автомобильный марки АИ-95 и выше],
                        [Продукция].[Сопоставимый].[Все виды продукции].[Панкреатин],
[Продукция].[Сопоставимый].[Все виды продукции].[Корригирующие очки],
[Продукция].[Сопоставимый].[Все виды продукции].[Медицинский термометр ртутный],
[Продукция].[Сопоставимый].[Все виды продукции].[Аппарат для измерения артериального давления электронный],
[Продукция].[Сопоставимый].[Все виды продукции].[Атенолол, 50 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Эналаприл, 5 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Индапамид, 2,5 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Нитроглицерин, 0,5 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Валидол, 60 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Корвалол, капли],
[Продукция].[Сопоставимый].[Все виды продукции].[Винпоцетин, 5 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Метамизол натрия (Анальгин отечественный), 500 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Комбинированные анальгетики],
[Продукция].[Сопоставимый].[Все виды продукции].[Дротаверин (Но-шпа), 40 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Ацетилсалициловая кислота (Аспирин отечественный), 500 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Диклофенак, раствор для инъекций, 75 мг, ампула],
[Продукция].[Сопоставимый].[Все виды продукции].[Амоксициллин, 500 мг],
 
[Продукция].[Сопоставимый].[Все виды продукции].[Амброксол, 30 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Супрастин, 25 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Ксилометазолин (Галазолин) 0,1%, капли],
[Продукция].[Сопоставимый].[Все виды продукции].[Поливитамины без минералов отечественные],
[Продукция].[Сопоставимый].[Все виды продукции].[Поливитамины с макро- и микроэлементами],
[Продукция].[Сопоставимый].[Все виды продукции].[Йод],
[Продукция].[Сопоставимый].[Все виды продукции].[Адельфан-Эзидрекс],
[Продукция].[Сопоставимый].[Все виды продукции].[Гипотиазид, 25 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Верошпирон, 100 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Троксерутин, гель для наружного применения, 2%],
[Продукция].[Сопоставимый].[Все виды продукции].[Флуоцинолона ацетонид, мазь для наружного применения, 0,025%],
[Продукция].[Сопоставимый].[Все виды продукции].[Лоратадин, 10 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Валокордин, капли],
[Продукция].[Сопоставимый].[Все виды продукции].[Настойка пустырника],
[Продукция].[Сопоставимый].[Все виды продукции].[Сеннозиды А и B],
[Продукция].[Сопоставимый].[Все виды продукции].[Бисакодил, 5 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Лоперамид, 2 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Смекта, порошок для приготовления суспензии, 3 г],
[Продукция].[Сопоставимый].[Все виды продукции].[Активированный уголь, 250 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Алмагель, суспензия],
[Продукция].[Сопоставимый].[Все виды продукции].[Ренни],
[Продукция].[Сопоставимый].[Все виды продукции].[Отинум, капли 20%],
[Продукция].[Сопоставимый].[Все виды продукции].[Сульфацетамид, капли 20%],
[Продукция].[Сопоставимый].[Все виды продукции].[Офтан Катахром, капли глазные],
[Продукция].[Сопоставимый].[Все виды продукции].[Тимолол, капли глазные 0,25%],
[Продукция].[Сопоставимый].[Все виды продукции].[Колдрекс, порошок для приготовления раствора для приема внутрь, 5 г],
[Продукция].[Сопоставимый].[Все виды продукции].[Фалиминт, 25 мг],
[Продукция].[Сопоставимый].[Все виды продукции].[Стрепсилс, таблетки для рассасывания],
[Продукция].[Сопоставимый].[Все виды продукции].[Гепарин натрия, гель для наружного применения 1000 МЕ/г],
[Продукция].[Сопоставимый].[Все виды продукции].[Бинт],
[Продукция].[Сопоставимый].[Все виды продукции].[Вата отечественная]
                    }
                }
            ),
            [Measures].[Цена] > 0 and not IsEmpty([Measures].[Цена])
        )'
select
    {
        [Measures].[MDX имя],
        [Measures].[Единица измерения]
    } on columns,
    {
    filter(
    [Продукты],
    [pr] = "товар")
    } on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
                [Период__Период].[Период__Период].[День]
    )
    ]]>
  </query>

  <query id = "FSGS_0001_0003_grid">
    <![CDATA[ -- Query name: FSGS_0001_0003_grid
with
    set [Строки]
    as '        {
            [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
            <%selected_region%>
        }+
        filter
        (
        <%selected_region%>.children,
                   not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember)'   
    member [Measures].[Территория]
    as '[Территории].[Сопоставимый].CurrentMember.Name'
    member [Measures].[Цена на начало года]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
        (
            [Территории].[Сопоставимый].CurrentMember,
            <%year_date%>,
            [Measures].[Цена]
        ),
        (
            [Территории].[Сопоставимый].CurrentMember.DataMember,
            <%year_date%>,
            [Measures].[Цена]
        ))'
    member [Measures].[Цена за предыдущий период]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
        (
            [Территории].[Сопоставимый].CurrentMember,
            <%previous_date%>,
            [Measures].[Цена]
        ),
        (
            [Территории].[Сопоставимый].CurrentMember.DataMember,
            <%previous_date%>,
            [Measures].[Цена]
        ))'
    member [Measures].[Цена на выбранную дату]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
        (
            [Территории].[Сопоставимый].CurrentMember,
            <%selected_date%>,
            [Measures].[Цена]
        ),
        (
            [Территории].[Сопоставимый].CurrentMember.DataMember,
            <%selected_date%>,
            [Measures].[Цена]
        ))'
    member [Measures].[Динамика к предыдущему отчетному периоду_АО]
    as 'iif
        (
            IsEmpty
            (
                [Measures].[Цена на выбранную дату]
            ) or
            (
                [Measures].[Цена на выбранную дату]
            ) = 0 or IsEmpty
            (
                [Measures].[Цена за предыдущий период]
            ) or
            (
                [Measures].[Цена за предыдущий период]
            ) = 0,
            null,
            [Measures].[Цена на выбранную дату] - [Measures].[Цена за предыдущий период]
        )'
    member [Measures].[Динамика к предыдущему отчетному периоду_ТП]
    as 'iif
        (
            IsEmpty
            (
                [Measures].[Цена на выбранную дату]
            ) or
            (
                [Measures].[Цена на выбранную дату]
            ) = 0 or IsEmpty
            (
                [Measures].[Цена за предыдущий период]
            ) or
            (
                [Measures].[Цена за предыдущий период]
            ) = 0,
            null,
            [Measures].[Цена на выбранную дату] / [Measures].[Цена за предыдущий период] - 1
        )'
    member [Measures].[Динамика за период с начала года_АО]
    as 'iif
        (
            IsEmpty
            (
                [Measures].[Цена на выбранную дату]
            ) or
            (
                [Measures].[Цена на выбранную дату]
            ) = 0 or IsEmpty
            (
                [Measures].[Цена на начало года]
            ) or
            (
                [Measures].[Цена на начало года]
            ) = 0,
            null,
            [Measures].[Цена на выбранную дату] - [Measures].[Цена на начало года]
        )'
    member [Measures].[Динамика за период с начала года_ТП]
    as 'iif
        (
            IsEmpty
            (
                [Measures].[Цена на выбранную дату]
            ) or
            (
                [Measures].[Цена на выбранную дату]
            ) = 0 or IsEmpty
            (
                [Measures].[Цена на начало года]
            ) or
            (
                [Measures].[Цена на начало года]
            ) = 0,
            null,
            [Measures].[Цена на выбранную дату] / [Measures].[Цена на начало года] - 1
        )'
    set [Субъекты РФ]
    as 'filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Субъект РФ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    set [Субъекты ФО]
    as 'filter
        (
            descendants
            (
                <%selected_region%>,
                [Территории].[Сопоставимый].[Субъект РФ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    member [Measures].[Ранг по ФО]
    as 'iif
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ" and
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                [Субъекты ФО],
                -[Measures].[Цена на выбранную дату]
            ),
            iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "РФ",
            max([Субъекты ФО], [Measures].[Ранг по ФО]),
            null)
        )'
        member [Measures].[Ранг по ФО 2]    
    as '1+ filter
        (
            <%selected_region%>.children,
            not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember
            and [Measures].[Цена на выбранную дату] > 0  
        ).count - Rank   
        (
            [Территории__Сопоставимый].[Территории__Сопоставимый].CurrentMember,
            filter    
            (
                <%selected_region%>.children,
                not [Территории__Сопоставимый].[Территории__Сопоставимый].currentmember.is_datamember
                and [Measures].[Цена на выбранную дату] > 0  
            ),
            [Measures].[Цена на выбранную дату]   
        )' 
    set [ФО]
    as 'filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Федеральный округ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    member [Measures].[Ранг по РФ]
    as 'iif
        (
            [Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ" and
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                [Субъекты РФ] ,
                -[Measures].[Цена на выбранную дату]
            ),
            iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Федеральный округ" and
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember,
            Rank
            (
                [Территории].[Сопоставимый].CurrentMember,
                [ФО] ,
                -[Measures].[Цена на выбранную дату]
            ),
            iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "РФ",
            max([Субъекты РФ], [Measures].[Ранг по РФ]),
            null))
        )'
select
    { 
        [Measures].[Территория],
        [Measures].[Цена на начало года],
        [Measures].[Цена за предыдущий период],        
        [Measures].[Цена на выбранную дату],        
        [Measures].[Ранг по РФ],
        [Measures].[Ранг по ФО 2],                
        [Measures].[Динамика за период с начала года_АО],
        [Measures].[Динамика за период с начала года_ТП],
        [Measures].[Динамика к предыдущему отчетному периоду_АО],
        [Measures].[Динамика к предыдущему отчетному периоду_ТП]
        
        
        
    } on columns,
    --[Строки]
        filter([Строки],
    [Measures].[Цена на выбранную дату] > 0)
    on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        <%selected_food%>
    )
    ]]>
  </query>

  <query id="FSGS_0001_0003_chart">
    <![CDATA[ -- Query name: FSGS_0001_0003_chart
with
    /*set [Строки]
    as 'order(filter(except
        (
            {
                <%selected_region%>.Children
            },
            <%selected_region%>.DataMember
        ), not IsEmpty([Measures].[Цена на выбранную дату]) and [Measures].[Цена на выбранную дату] > 0),
        [Measures].[Цена на выбранную дату], ASC)
        
        
        
        '*/
            set [Строки] 
    as '
        
        Filter(
    order
        (
            <%selected_region%>.Children,
            [Measures].[Цена на выбранную дату],
            ASC
        ),
        [Measures].[Цена на выбранную дату] >0
                and
        not([Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.parent.DataMember))
        '
    member [Measures].[Цена на выбранную дату]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
        (
            [Территории].[Сопоставимый].CurrentMember,
            <%selected_date%>,
            [Measures].[Цена]
        ),
        (
            [Территории].[Сопоставимый].CurrentMember.DataMember,
            <%selected_date%>,
            [Measures].[Цена]
        ))'
select
    {
        [Measures].[Цена на выбранную дату]
    } on columns,
    [Строки] on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        <%selected_food%>
    )
    ]]>
  </query>

  <query id="FSGS_0001_0003_map">
    <![CDATA[ -- Query name: FSGS_0001_0003_map
with
    set [Строки] 
    as '
        Filter(
    order
        (
            <%selected_region%>.Children,
            [Measures].[Цена на выбранную дату],
            ASC
        ),
        [Measures].[Цена на выбранную дату] >0
                and
        not([Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.parent.DataMember))
        '
    member [Measures].[Краткое наименование]
    as '[Территории].[Сопоставимый].CurrentMember.Properties("Краткое наименование")'
    member [Measures].[Цена на выбранную дату]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
        (
            [Территории].[Сопоставимый].CurrentMember,
            <%selected_date%>,
            [Measures].[Цена]
        ),
        (
            [Территории].[Сопоставимый].CurrentMember.DataMember,
            <%selected_date%>,
            [Measures].[Цена]
        ))'
    set [Субъекты РФ]
    as 'filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Субъект РФ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    set [Субъекты ФО]
    as 'filter
        (
            descendants
            (
                <%selected_region%>,
                [Территории].[Сопоставимый].[Субъект РФ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    member [Measures].[Ранг по ФО]
    as 'Rank(
                [Территории].[Сопоставимый].CurrentMember,
                [Субъекты ФО],
                -[Measures].[Цена на выбранную дату]
            )'
    set [ФО]
    as 'filter
        (
            descendants
            (
                [Территории].[Сопоставимый].[Все территории].[Российская  Федерация],
                [Территории].[Сопоставимый].[Федеральный округ]
            ),
            not [Территории].[Сопоставимый].CurrentMember is [Территории].[Сопоставимый].CurrentMember.Parent.DataMember and
            [Measures].[Цена на выбранную дату] > 0 and not IsEmpty([Measures].[Цена на выбранную дату])
        )'
    member [Measures].[Ранг по РФ]
    as 'Rank(
                [Территории].[Сопоставимый].CurrentMember,
                [ФО] ,
                -[Measures].[Цена на выбранную дату]
            )'
    member [Measures].[Ранг]
    as 'iif([Территории].[Сопоставимый].CurrentMember.Level.Name = "Субъект РФ",
    [Measures].[Ранг по ФО], [Measures].[Ранг по РФ])'
select
    {
        [Measures].[Краткое наименование],
        [Measures].[Цена на выбранную дату],
        [Measures].[Ранг]
    } on columns,
    [Строки] on rows
from [ФСГС_Цены РФ]
where
    (
        [Организации].[Тип цены].[Все типы цен].[Средняя розничная цена],
        <%selected_food%>
    )
    ]]>
  </query>
  
</root>