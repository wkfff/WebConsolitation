CALCULATE;

//Вычислимые меры
CREATE MEMBER CURRENTCUBE.Measures.[Исполнено за период] AS IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "Год", ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]), IIF(IsEmpty(([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог])), null,
IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.PrevMember, [Measures].[Факт_Нарастающий итог])), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.PrevMember, [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт_Нарастающий итог]),IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт_Нарастающий итог])), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(4), [Measures].[Факт_Нарастающий итог])),  ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(4), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(5), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) -  ([Период__Период].[Период__Период].CurrentMember.Lag(5), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(6), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(6), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(7), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) -  ([Период__Период].[Период__Период].CurrentMember.Lag(7), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(8), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(8), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(9), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(9), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(10), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(10), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(11), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(11), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(12), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(12), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(13), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(13), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(14), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(14), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(15), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(15), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(16), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(16), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(17), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(17), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(18), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(18), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(19), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(19), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(20), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(20), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(21), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(21), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(22), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(22), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(23), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(23), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(24), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(24), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(25), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(25), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(26), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(26), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(27), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(27), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(28), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(28), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(29), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(29), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(30), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(30), [Measures].[Факт_Нарастающий итог]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(31), [Measures].[Факт_Нарастающий итог])) , ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог]) - ([Период__Период].[Период__Период].CurrentMember.Lag(31), [Measures].[Факт_Нарастающий итог]),([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт_Нарастающий итог])))))))))))))))))))))))))))))))))),
FORMAT_STRING = "Currency";

CREATE MEMBER CURRENTCUBE.Measures.[Факт за период] AS IIF([Период__Период].[Период__Период].CurrentMember.Level.Name = "Год" or [Период__Период].[Период__Период].CurrentMember.Level.Name = "Полугодие" or [Период__Период].[Период__Период].CurrentMember.Level.Name = "Квартал", ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]), IIF(IsEmpty(([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт])), null,
IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.PrevMember, [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(1).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.PrevMember, [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(2).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(3).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(4), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(4).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(4), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(5), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(5).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(5), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(6), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(6).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(6), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(7), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(7).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(7), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(8), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(8).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(8), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(9), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(9).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(9), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(10), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(10).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(10), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(11), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(11).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(11), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(12), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(12).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(12), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(13), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(13).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(13), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(14), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(14).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(14), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(15), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(15).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(15), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(16), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(16).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(16), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(17), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(17).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(17), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(18), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(18).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(18), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(19), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(19).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(19), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(20), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(20).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(20), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(21), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(21).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(21), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(22), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(22).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(22), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(23), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(23).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(23), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(24), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(24).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(24), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(25), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(25).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(25), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(26), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(26).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(26), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(27), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(27).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(27), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(28), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(28).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(28), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(29), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(29).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(29), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(30), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(30).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(30), [Measures].[Факт]), IIF(not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(31), [Measures].[Факт])) and ([Период__Период].[Период__Период].CurrentMember.lag(31).Parent.Parent = [Период__Период].[Период__Период].CurrentMember.Parent.Parent), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(31), [Measures].[Факт]),([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт])))))))))))))))))))))))))))))))))), 
FORMAT_STRING = "Currency";

CREATE MEMBER CURRENTCUBE.Measures.[Процент исполнения] AS 
IIF(not IsEmpty(([Measures].[План]) or ([Measures].[План_Нарастающий итог])) and (([Measures].[План], [Период__Период].[Период__Период].CurrentMember) + ([Measures].[План_Нарастающий итог], [Период__Период].[Период__Период].CurrentMember)) <> 0, (([Measures].[Факт], [Период__Период].[Период__Период].CurrentMember) + ([Measures].[Факт_Нарастающий итог], [Период__Период].[Период__Период].CurrentMember)) / (([Measures].[План], [Период__Период].[Период__Период].CurrentMember) + ([Measures].[План_Нарастающий итог], [Период__Период].[Период__Период].CurrentMember)), null), FORMAT_STRING = "Percent"; 

SCOPE([Measures].[Факт]);
    this = IIF(IsLeaf([Период__Период].[Период__Период].CurrentMember), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]), IIF(([Период__Период].[Период__Период].CurrentMember.level.Name = "Полугодие"), Sum([Период__Период].[Период__Период].CurrentMember.Children, [Measures].[Факт]),IIF(([Период__Период].[Период__Период].CurrentMember.level.Name = "Год"), Sum([Период__Период].[Период__Период].CurrentMember.Children, [Measures].[Факт]), Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not IsEmpty([Measures].[Факт])), 1).Item(0))));
END SCOPE;

SCOPE([Measures].[Факт за период]);
    this = IIF(([Период__Период].[Период__Период].CurrentMember.Level.Name = "Месяц"), IIF(IsEmpty(([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт])), null, IIF([Период__Период].[Период__Период].CurrentMember.Parent = [Период__Период].[Период__Период].CurrentMember.Lag(1).Parent and not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(1), [Measures].[Факт])), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(1), [Measures].[Факт]), IIF([Период__Период].[Период__Период].CurrentMember.Parent = [Период__Период].[Период__Период].CurrentMember.Lag(2).Parent and not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт])), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(2), [Measures].[Факт]), IIF([Период__Период].[Период__Период].CurrentMember.Parent = [Период__Период].[Период__Период].CurrentMember.Lag(3).Parent and not IsEmpty(([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт])), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]) - ([Период__Период].[Период__Период].CurrentMember.Lag(3), [Measures].[Факт]), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]))))), ([Период__Период].[Период__Период].CurrentMember, [Measures].[Факт]));
END SCOPE;

SCOPE([Measures].[План]);
    this = IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember), IIF(([Период__Период].[Период__Период].CurrentMember.level.Name = "Полугодие"), Sum([Период__Период].[Период__Период].CurrentMember.Children, [Measures].[План]), IIF(([Период__Период].[Период__Период].CurrentMember.level.Name = "Год"), Sum([Период__Период].[Период__Период].CurrentMember.Children, [Measures].[План]), Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not IsEmpty([Measures].[План])), 1).Item(0))), ([Период__Период].[Период__Период].CurrentMember, [Measures].[План]));
END SCOPE;

SCOPE(DESCENDANTS([Период__Период].[Период__Период].[Данные всех периодов]));    this = IIF(not IsLeaf([Период__Период].[Период__Период].CurrentMember) and ([Measures].CurrentMember is [Measures].[Факт_Нарастающий итог] or [Measures].CurrentMember is [Measures].[План_Нарастающий итог]), IIF(([Период__Период].[Период__Период].CurrentMember.level.Name = "Данные всех периодов"), Sum([Период__Период].[Период__Период].CurrentMember.Children, [Measures].CurrentMember), Tail(Filter([Период__Период].[Период__Период].CurrentMember.Children, not IsEmpty([Measures].CurrentMember)), 1).Item(0)), ([Период__Период].[Период__Период].CurrentMember, [Measures].CurrentMember));
END SCOPE;