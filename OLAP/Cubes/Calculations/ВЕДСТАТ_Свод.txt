CALCULATE;

/* Перекрываю определение итогов */
([Measures].[Значение],{[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Квартал].Members}) = 
IIF (not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)),
  IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember)),
    ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember),
    IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild)),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild),
      IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild.Lag(1))),
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild.Lag(1)),
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild.Lag(2))
        )
      )
    )
  , null
  );

([Measures].[Значение],{[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Полугодие].Members}) = 
IIF (not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)),
  IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember)),
    ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember),
    IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild)),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild.Lag(1))
      )
    )
  , null
  );

([Measures].[Значение],{[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].[Год].Members}) = 
IIF (not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)),
  IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember)),
    ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.DataMember),
    IIF(not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild)),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.LastChild.Lag(1))
      )
    )
  , null
  );

/* расчетные меры */
CREATE MEMBER CURRENTCUBE.Measures.[Прирост цепной] AS IIF (not IsEmpty(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)),
  IIF ([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember is [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.FirstSibling,
    IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Месяц",
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) -
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(4)),
      IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Квартал" or [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Полугодие",
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) -
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(3)),
        IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Год",
          ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) -
          ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.PrevMember),
          null))),
    IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember is [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.FirstSibling.NextMember,
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) -
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(2)),
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) -
      ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.PrevMember))),
null);
CREATE MEMBER CURRENTCUBE.Measures.[Темп роста цепной] AS IIF (([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) >= 0,
  IIF ([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember is [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.FirstSibling,
    IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Месяц",
      IIF(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(4)) > 0,
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)/([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(4)),
        null),
      IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Квартал" or [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Level.Name = "Полугодие",
        IIF(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(3)) > 0,
          ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)/([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(3)),
          null),
        null)),
    IIF([Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember is [Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.FirstSibling.NextMember,
      IIF(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(2)) > 0,
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)/([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.Lag(2)),
        null),
      IIF(([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.PrevMember) > 0,
        ([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)/([Measures].[Значение],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember.PrevMember),
        null)
      )
    ),
null);
CREATE MEMBER CURRENTCUBE.Measures.[Темп прироста цепной] AS IIF(IsEmpty(([Measures].[Темп роста цепной],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember)),
  null,
  ([Measures].[Темп роста цепной],[Период__Год Квартал Месяц].[Период__Год Квартал Месяц].CurrentMember) - 1);